# Version control với Git và Github {#collaboration}

Chương này trình bày tổng quan về việc sử dụng Git để làm việc nhóm với những người khác.
Bạn có thể tìm các hướng dẫn nâng cao hơn ở dưới cùng trong mục Tài liệu tham khảo. 

## Git là gì?

Git là một phần mềm **kiểm soát phiên bản** cho phép theo dõi các thay đổi trong
thư mục. Nó có thể được sử dụng như tùy chọn "track change" trong Word, LibreOffice hoặc
TGoogle docs, nhưng dành cho tất cả các loại tệp. Nó là một trong những công cụ mạnh mẽ nhất
và được sử dụng nhiều nhất để kiểm soát phiên bản. 

**Tại sao tôi chưa bao giờ nghe nói về Git? -** Trong khi hầu hết mọi người phát triển
nền tảng thường xuyên phải học cách sử dụng phần mềm để kiểm soát phiên bản (Git,
Mercurial, Subversion hoặc những người khác), ít người trong chúng ta xuất thân từ
các ngành định lượng được dạy các kỹ năng này. Do đó, hầu hết các nhà dịch tễ học không bao giờ
nghe nói về nó trong các nghiên cứu của họ, và phải tìm hiểu nó một cách nhanh chóng. 

**Chờ đã, tôi có nghe nói về Github, có giống Git không?** - Không giống, nhưng bạn
thường sử dụng chúng cùng nhau và chúng tôi sẽ hướng dẫn bạn cách thực hiện. Nói ngắn gọn như sau: 

-   **Git** là hệ thống kiểm soát phiên bản, một phần của phần mềm. Bạn có thể tải phần mềm để sử dụng trên máy tính      của mình hoặc để đồng bộ hóa một thư mục với một máy chủ trên **trang web**. Theo mặc định, người ta sử dụng một 
    thiết bị đầu cuối để đưa ra hướng dẫn Git trong dòng lệnh. 

-   Bạn có thể sử dụng **ứng dụng người dùng/giao diện Git** để tránh dòng lệnh và thực hiện các hành động tương tự 
    (ít nhất là đối với những hành động đơn giản, rất thường dùng). 
    
-   Nếu bạn muốn lưu trữ thư mục của mình trong **trang web chủ** để cùng làm việc với những người khác, bạn có thể 
    tạo một tài khoản tại Github, Gitlab, Bitbucket hoặc các tài khoản khác. 

Vì vậy, bạn có thể sử dụng máy khách/giao diện **Github Desktop**, sử dụng **Git** trong ổ cứng để quản lý các tệp của bạn, cả cục bộ trên máy tính của bạn và từ xa trên máy chủ **Github**. 

## Tại sao sử dụng kết hợp Git và Github?

Sử dụng **Git** để:

1)  Lưu trữ các phiên bản dạng tài liệu với các thay đổi đã được ghi chú để bạn
    có thể dễ dàng chuyển lại về bất kỳ trạng thái nào trước đó 
2)  Có các *nhánh* song song, tức là các phiên bản đang phát triển/"đang làm việc" với
    các cấu trúc để tích hợp các thay đổi sau khi xem xét 

Điều này có thể được thực hiện cục bộ trên máy tính của bạn, ngay cả khi bạn không cộng tác
với những người khác. Bạn đã từng: 

-   hối tiếc vì đã xóa một đoạn mã, chỉ để nhận ra hai
    vài tháng sau mà bạn thực sự cần nó? 

-   quay lại một dự án đã bị tạm dừng và cố gắng
    nhớ liệu bạn đã thực hiện sửa đổi phức tạp đó ở một trong những
    mô hình? 

-   có một tệp *model_1.R* và một tệp khác *model_1\_test.R * và một tệp
    *model_1\_not_working.R * để thử mọi thứ? 

-   có một tệp *report.Rmd*, tệp *report_full.Rmd*, tệp
    *report_true_final.Rmd*, tệp *report_final_20210304.Rmd*, tệp
    *report_final_20210402.Rmd* và khó chịu với kỹ năng lưu trữ của bạn? 

Git sẽ giúp bạn giải quyết tất cả vấn đề trên, và đây cũng là những thứ rất đáng để học. 

Tuy nhiên, nó thậm chí còn trở nên mạnh mẽ hơn khi được sử dụng với kho lưu trữ trực tuyến
chẳng hạn như Github để hỗ trợ **các dự án hợp tác**. Điều này tạo điều kiện cho việc: 

-   Cộng tác: những người khác có thể đánh giá, nhận xét và
    chấp nhận/từ chối các thay đổi  
-   Chia sẻ mã, dữ liệu và kết quả đầu ra của bạn và mời phản hồi
    từ công chúng (hoặc riêng tư, với nhóm của bạn) 

và tránh: 

-   "Rất tiếc, tôi đã quên gửi phiên bản cuối cùng và bây giờ bạn cần
    làm lại tệp mới này trong hai ngày làm việc" 

-   Mina, Henry và Oumar đều làm việc cùng lúc trên một script và
    cần phải hợp nhất các thay đổi của chúng theo cách thủ công 

-   Hai người cố gắng sửa đổi cùng một tệp trên Dropbox và Sharepoint
    và điều này tạo ra lỗi đồng bộ hóa. 

### Điều này nghe có vẻ phức tạp, tôi không phải là một lập trình viên {-}

Điều này hoàn toàn có thể. Ví dụ về cách sử dụng nâng cao có thể khá đáng sợ. Tuy nhiên, giống với
như R, hoặc thậm chí là Excel, bạn không cần phải trở thành một chuyên gia để tận dụng
lợi ích của công cụ. Học *một số nhỏ các hàm và khái niệm*
cho phép bạn theo dõi các thay đổi của mình, đồng bộ hóa các tệp của bạn trực tuyến
kho lưu trữ và cộng tác với đồng nghiệp của bạn với thời gian ngắn. 
 

Do đường cong học tập, khi bạn cần hoàn thiện một công viêc trong trường hợp khẩn cấp, đó có thể không phải là thời 
điểm tốt nhấtvđể tìm hiểu các công cụ này. Nhưng việc học có thể đạt được theo từng bước. Một khi bạn có được
một vài khái niệm, quy trình làm việc của bạn có thể khá hiệu quả và nhanh chóng.
Nếu bạn chưa làm việc trong một dự án cộng tác với mọi người
và buộc phải sử dụng qua Git, **đó thực sự là thời điểm tốt để có được tự tin để sử dụng Git** trước khi bắt tay vào cộng tác với người khác. 

## Cài đặt

### Cài đặt Git {.unnumbered}

*Git* is the engine behind the scenes on your computer, which tracks
changes, branches (versions), merges, and reverting. **You must first
install *Git* from <https://git-scm.com/downloads>.**
*Git* là công cụ đằng sau hậu trường trên máy tính của bạn, theo dõi
thay đổi, các nhánh (phiên bản), hợp nhất và hoàn nguyên. **Đầi tiên bạn phải
cài đặt *Git* từ đường link sau <https://git-scm.com/downloads>.** 

### Cài đặt giao diện (tùy chọn nhưng được khuyến nghị) {.unnumbered}

Git có ngôn ngữ lệnh riêng, có thể được nhập vào một thiết bị đầu cuối dòng lệnh. Tuy nhiên, có nhiều máy/giao diện và
với tư cách là người không phải là nhà phát triển, trong quá trình sử dụng hàng ngày, bạn sẽ hiếm khi _cần_ tương tác 
trực tiếp với Git và giao diện thường cung cấp các công cụ trực quan hóa đẹp mắt để sửa đổi tệp hoặc các nhánh. 


Có nhiều tùy chọn, trên tất cả các hệ điều hành, từ thân thiện với người mới bắt đầu đến những tùy chọn phức tạp hơn.
Các tùy chọn tốt cho người mới bắt đầu bao gồm ngăn RStudio Git và
[Github Desktop](https://desktop.github.com/), mà chúng tôi sẽ giới thiệu trong
chương này. 
Các tùy chọn trung gian (tiện ích hơn nhưng phức tạp hơn) bao gồm Cây tài liệu,
Gitkracken, Smart Git và những tùy chọn khác. 

Bạn có thể xem giải thích ngắn gọn về Git clients ở đây  [Git clients](-%09https:/happygitwithr.com/git-client.html#git-client).

*Lưu ý: vì thực tế tất cả các giao diện đều sử dụng Git nội bộ, bạn có thể thử một số trong
đó, chuyển từ dạng này sang dạng khác trong một dự án nhất định, sử dụng bảng điều khiển đúng giờ
đối với một hành động mà giao diện của bạn không hỗ trợ hoặc thậm chí thực hiện bất kỳ số
hành động trực tuyến trên Github.* 

Như đã lưu ý bên dưới, đôi khi bạn có thể phải viết các lệnh Git thành một thiết bị đầu cuối
chẳng hạn như cửa sổ cuối RStudio (một tab liền kề với R
Console) hoặc thiết bị đầu cuối Git Bash. 

### Tài khoản Github {.unnumbered}

Đăng ký tài khoản miễn phí tại [github.com](github.com).

Bạn có thể được đề nghị thiết lập xác thực hai yếu tố với một ứng dụng trên
điện thoại của bạn. Đọc thêm trong [tài liệu trợ giúp](https://docs.github.com/en/github/authenticating-to-github/securing-your-account-with-two-factor-authentication-2fa) của Github . 

Nếu bạn sử dụng Github Desktop, bạn có thể nhập thông tin đăng nhập Gitub của mình sau
khi cài đặt [các bước](https://docs.github.com/en/desktop/installing-and-configuring-github-desktop/authenticating-to-github).
Nếu bạn không biết, thông tin đăng nhập sẽ được hỏi sau khi bạn cố gắng
sao chép một dự án từ Github. 

## Từ vựng, khái niệm và các chức năng cơ bản

Như khi học R, có một chút từ vựng cần nhớ để
hiểu Git. Đây là [những điều cơ bản giúp bạn làm việc](https://www.freecodecamp.org/news/an-introduction-to-git-for-absolute-beginners-86fa1d32ff71/)
/[hướng dẫn tương tác](learningngitbranching.js.org). Ở phần tiếp theo, 
chúng tôi sẽ chỉ ra cách sử dụng các giao diện, nhưng tốt hơn là bạn nên
có từ vựng và khái niệm trong đầu, để xây dựng mô hình tinh thần của bạn,
và vì bạn sẽ cần chúng khi sử dụng các giao diện. 

### Kho lưu trữ {.unnumbered}

Kho *lưu trữ Git* ("*repo*") là một thư mục chứa tất cả
các thư mục con và tệp cho dự án của bạn (dữ liệu, mã code, hình ảnh, v.v.) và
lịch sử sửa đổi của chúng, Khi bạn bắt đầu theo dõi những thay đổi trong
kho lưu trữ, Git sẽ tạo một thư mục ẩn chứa
tất cả các thông tin theo dõi. Một kho lưu trữ Git điển hình là
thư mục *R Project* của bạn (xem thêm chương [Dự án R] để biết thêm chi tiết). 

Chúng tôi sẽ hướng dẫn bạn cách tạo (_initialize_) một kho lưu trữ Git
từ Github, Github Desktop hoặc Rstudio trong phần tiếp theo
của chương này. 

### Sự cam kết {.unnumbered}

*Sự cam kết* là một **bức tranh phản ánh** của dự án tại một thời điểm nhất định.
Khi bạn thực hiện một thay đổi đối với một dự án, bạn sẽ thực hiện một cam kết mới
để theo dõi những thay đổi (delta) được thực hiện đối với
các tập tin. Ví dụ: có lẽ bạn đã chỉnh sửa một số dòng mã và cập nhật
tập dữ liệu liên quan. Sau khi các thay đổi của bạn được lưu, bạn có thể nhóm các
thay đổi cùng nhau thành một "cam kết". 

Mỗi cam kết có một ID duy nhất (một *hash*). Đối với mục đích kiểm soát phiên bản,
bạn có thể khôi phục dự án của mình theo thời gian dựa trên các cam kết, vì vậy tốt nhất là
để giữ cho chúng tương đối nhỏ và mạch lạc. Bạn cũng sẽ đính kèm một bản tóm tắt
mô tả về những thay đổi được gọi là "thông báo cam kết". 

*Thay đổi theo giai đoạn*? Đối với các thay đổi theo giai đoạn là thêm chúng vào *khu vực dàn dựng*
để chuẩn bị cho lần cam kết tiếp theo. Ý tưởng là bạn có thể 
quyết định rõ ràng những thay đổi nào sẽ bao gồm trong một cam kết nhất định nào. Ví dụ, nếu bạn
đã làm việc trên đặc tả mô hình trong một tập lệnh và sau đó là một con số trong
một tập lệnh khác, sẽ hợp lý nếu có hai cam kết khác nhau (sẽ dễ dàng hơn
trong trường hợp bạn muốn khôi phục các thay đổi trên hình nhưng không phải mô hình). 

### Nhánh {.unnumbered}

Một nhánh đại diện cho một *dòng độc lập* chứa các thay đổi trong một phiên bản song song (repo) của bạn, 
thay thế của các tệp dự án của bạn. 

Các nhánh rất hữu ích để kiểm tra các thay đổi trước khi chúng được tích hợp vào
nhánh *chính*, thường là phiên bản chính/cuối cùng /"live" của
dự án của bạn. Khi bạn hoàn thành việc thử nghiệm trên một nhánh, bạn có thể *hợp nhất*
những thay đổi đó vào nhánh *chính* của bạn,hoặc xóa những thay đổi, nếu
những thay đổi không tốt. 

*Lưu ý: bạn không phải cộng tác với người khác để sử dụng các nhánh,
cũng như không cần phải có một kho lưu trữ trực tuyến từ xa.* 


### Kho lưu trữ cục bộ và từ xa  {.unnumbered}

*Nhân bản* (clone) là tạo một bản sao của kho lưu trữ Git ở một nơi khác. 

Ví dụ: bạn có thể *nhân bản* một tệp vào kho lưu trữ trực tuyến _từ_ Github cục bộ trên
máy tính của bạn hoặc bắt đầu với một kho lưu trữ cục bộ và sao chép
nó _trên_ Github trực tuyến 

Khi bạn đã nhân bản một kho lưu trữ, các tệp dự án tồn tại trong
hai nơi: 

-   kho lưu trữ *CỤC BỘ* trên máy tính của bạn. Cái này
    là nơi bạn thực hiện các thay đổi thực tế đối với các tệp/mã. 

-   *Từ xa*, kho lưu trữ trực tuyến: các phiên bản của tệp dự án của bạn
    trong kho lưu trữ Github (hoặc trên bất kỳ trang web chủ nào khác).

Để đồng bộ hóa các kho này, chúng ta sẽ sử dụng nhiều chức năng hơn. Thật vậy,
không giống như Sharepoint, Dropbox hoặc phần mềm đồng bộ hóa khác, Git thực hiện
không tự động cập nhật kho lưu trữ cục bộ của bạn dựa trên hoặc những gì trực tuyến,
hoặc ngược lại. Bạn có thể chọn thời điểm và cách thức đồng bộ hóa. 

-   `git fetch` tải xuống các thay đổi mới từ kho lưu trữ từ xa nhưng không tải xuống
     thay đổi kho lưu trữ cục bộ của bạn. Hãy coi như nó giống như việc kiểm tra trạng thái của kho lưu trữ từ xa.

-   `git pull` tải xuống các thay đổi mới từ kho lưu trữ từ xa
     và cập nhật kho lưu trữ cục bộ của bạn. 

-   Khi bạn đã thực hiện một hoặc một số cam kết cục bộ, bạn có thể
    `git push` để cam kết đến kho lưu trữ từ xa. Điều này giúp gửi 
    các thay đổi của bạn trên Github để người khác có thể xem và chấp nhận chúng nếu
    họ muốn. 

## Bắt đầu: tạo một kho lưu trữ mới 

Có nhiều cách để tạo kho lưu trữ mới. Bạn có thể làm điều đó từ
R console, từ Github, hoặc từ một giao diện. 

Hai cách tiếp cận chung để tạo một kho lưu trữ là:

-   Tạo một Dự án R mới từ kho lưu trữ Github hiện có hoặc mới
    (*ưu tiên cho người mới bắt đầu*), hoặc
-   Tạo kho lưu trữ Github cho một dự án R hiện có 

### Tệp khởi động {.unnumbered}

Khi bạn tạo một kho lưu trữ mới, bạn có thể tùy chọn tạo
tất cả các tệp bên dưới hoặc bạn có thể thêm chúng vào kho lưu trữ của mình ở giai đoạn sau.
Chúng thường nằm trong thư mục "gốc" của kho lưu trữ. 

-   Tệp *README* là tệp mà người khác có thể đọc để hiểu tại sao
    dự án của bạn tồn tại và những điều họ nên biết để sử dụng nó. Nó
    lúc đầu sẽ trống, nhưng bạn nên hoàn thành nó sau. 

-   Tệp *.gitignore* là tệp văn bản trong đó mỗi dòng sẽ chứa
    các thư mục hoặc tệp mà Git nên bỏ qua (không theo dõi các thay đổi). Đọc
    thêm về điều này và xem các ví dụ
    [tại đây](https://www.freecodecamp.org/news/gitignore-what-is-it-and-how-to-add-to-repo/). 

-   Bạn có thể chọn *license* cho dự án của mình, để những người khác
    biết họ có thể sử dụng hoặc khôi phục tệp của bạn trong những điều kiện nào. Để biết thêm
    thông tin, hãy xem [Cách tạo các license phổ biến](https://creativecommons.org/licenses/). 

### Tạo một kho lưu trữ mới trong Github {.unnumbered}

Để tạo một kho lưu trữ mới, hãy đăng nhập vào Github và tìm một nút màu xanh lục
để tạo một kho lưu trữ mới. Kho lưu trữ hiện đang trống này có thể được
được sao chép cục bộ vào máy tính của bạn (xem phần tiếp theo để biết thêm chi tiết). 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_new.png"))
```


Bạn phải chọn nếu bạn muốn kho lưu trữ của mình ở dạng **công khai** (hiển thị với
mọi người trên internet) hoặc **riêng tư** (chỉ hiển thị với những người trong sự
sự cho phép của bạn). Điều này có ý nghĩa quan trọng nếu dữ liệu của bạn nhạy cảm.
Nếu kho lưu trữ của bạn là riêng tư, bạn sẽ gặp phải một số giới hạn trong
các trường hợp đặc biệt, chẳng hạn như nếu bạn đang sử dụng *các thao tác* trong Github để
tự động chạy mã của bạn trên ổ lưu trữ đám mây. 
 
### Sao chép từ kho lưu trữ Github {.unnumbered}

Bạn có thể *sao chép* kho lưu trữ Github hiện có để tạo
một dự án R cục bộ mới trên máy tính của bạn. 

Kho lưu trữ của Github có thể là một kho lưu trữ đã tồn tại và chứa
nội dung, hoặc có thể là một kho lưu trữ trống mà bạn vừa tạo. Trong các
trường hợp sau, về cơ bản bạn đang tạo một repo Github và dự án R
cục bộ trên máy tính của bạn cùng một lúc (xem hướng dẫn ở trên) 

_Lưu ý_: nếu bạn không được phép đóng góp trên kho lưu trữ Github,
trước tiên bạn có thể _tách nhánh_ kho lưu trữ đó vào hồ sơ riêng của bạn, và sau đó
tiếp tục với các hành động khác. Tách nhánh được giải thích ở phần cuối của chương này
nhưng chúng tôi khuyên bạn nên đọc các phần khác trước. 

Bước 1: Điều hướng trong Github đến kho lưu trữ, nhấp vào nút màu xanh lá cây "**Code**" 
và sao chép **HTTPS clone URL** (xem hình ảnh minh họa bên dưới) 

```{r echo=F, out.width = '100%', out.height='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_clone.png"))
```

Bước tiếp theo có thể được thực hiện trong bất kỳ giao diện nào. Chúng tôi sẽ minh họa bằng
Rstudio and Github desktop.

#### Trong Rstudio {.unnumbered}

In RStudio, start a new R project by clicking *File \> New Project \>
Version Control \> Git*
Trong RStudio, để bắt đầu một dự án R mới, bạn cần nhấp vào *File \> New Project \>
Version Control \> Git*

-   Khi được yêu cầu nhập "URL của kho lưu trữ", hãy dán URL HTTPS từ
    Github\ 
-   Gán cho dự án R một cái tên ngắn gọn, đầy đủ thông tin\
-   Chọn nơi Dự án R mới sẽ được lưu cục bộ trên máy tính của bạn\
-   Chọn "Open in new session" và click vào mục "Create project"


Bạn hiện đang trong một dự án RStudio mới, cục bộ trên máy tính của bạn, là một bản sao của
Kho lưu trữ online trên Github. Dự án cục bộ này và kho lưu trữ Github hiện
được liên kết. 

#### Trong Github Desktop {.unnumbered}

-   Nhấn vào *File \> Clone a repository*

-   Select the URL tab

-   Dán đường dẫn HTTPS URL từ Github vào hộp đầu tiên 

-   Chọn thư mục mà bạn muốn có kho lưu trữ cục bộ của mình 

-   Nhấn vào "CLONE"

```{r echo=F, out.width = '100%', out.height='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_clone_desktop.png"))
```

### Tạo một Github repo mới từ dự án R đã có sẵn {.unnumbered}

Một kịch bản thiết lập thay thế là bạn có một dự án R hiện tại
có nội dung và bạn muốn tạo một kho lưu trữ Github cho nó. 

1)  Tạo một kho lưu trữ Github mới, trống cho dự án (Xem
    hướng dẫn ở trên)\
2)  Sao chép cục bộ kho lưu trữ này (Xem hướng dẫn về HTTPS ở trên)\
3)  Sao chép tất cả nội dung từ dự án R đã có từ trước của bạn
    (mã, dữ liệu, v.v.) vào kho lưu trữ trống, cục bộ, mới này (ví dụ: sử dụng sao chép và dán).\
4)  Tạo một dự án mới của bạn trong RStudio và chuyển đến cửa sổ Git. Các tệp mới sẽ được đăng ký 
    dưới dạng thay đổi tệp, hiện được theo dõi bởi Git. Do đó, bạn có thể 
    gộp những thay đổi này dưới dạng  *commit* và *đẩy* chúng lên Github.
    Sau khi *được đẩy*, kho lưu trữ trên Github của bạn sẽ theo dõi sự thay đổi của tất cả các tệp. 
    
Xem phần quy trình làm việc Github bên dưới để biết chi tiết về quy trình này. 

### Bây giờ, nó trông như thế nào? {.unnumbered}

#### Trong RStudio {-}

Khi bạn đã cloned kho lưu trữ Github sang một dự án R mới,
bây giờ bạn thấy trong RStudio có một tab "Git". Tab này xuất hiện trong cùng một cửa sổ RStudio
với  cửaa sổ Environment của bạn:

```{r echo=F, out.width = "75%", out.height="75%", fig.align = "center"}
knitr::include_graphics(here::here("images", "Git_console.png"))
```

Vui lòng lưu ý các nút được khoanh tròn trong hình trên, vì chúng sẽ
được giới thiệu dưới đây (từ trái sang phải): 

-   Nút *commit* để lưu tệp đã thay đổi thành chi nhánh 
    cục bộ trong máy tính (điều này sẽ mở ra một cửa sổ mới) 
-   Mũi lên màu xanh lam hướng lên *pull* (cập nhật phiên bản cục bộ của chi nhánh với
    bất kỳ thay đổi nào được thực hiện trên phiên bản từ xa/Github của nhánh đó) 
-   Mũi tên màu xanh lục hướng xuống *push* (gửi bất kỳcommits/bất kỳ thay đổi nào trong tệp cục bộ của bạn
    trong nhánh sang phiên bản từ xa/Github của nhánh đó) 
-   Tab Git trong RStudio 
-   Nút để tạo một nhánh MỚI bằng cách sử dụng bất kỳ nhánh cục bộ nào được hiển thị
    bên phải làm cơ sở. *Bạn hầu như luôn muốn tách khỏi chi nhánh chính (sau khi bạn kéo lần đầu tiên để cập nhật chi nhánh chính)* 
-   Chi nhánh bạn hiện đang làm việc 
-   Những thay đổi bạn đã thực hiện đối với mã hoặc các tệp khác sẽ xuất hiện bên dưới 

#### Trong Github Desktop {-}

Github Desktop là một ứng dụng độc lập trong máy tính của bạn cho phép bạn quản lý
tất cả các kho lưu trữ của bạn. Khi bạn mở nó, giao diện của nó cho phép bạn
chọn kho lưu trữ bạn muốn làm việc và sau đó thực hiện Git thao tác
cơ bản từ đó. 

```{r echo=F, out.width = "75%", out.height="75%", fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_interface.png"))
```


## Quy trình làm việc với Git + Github 

### Tổng quan về quy trình {.unnumbered}

Khi bạn đã hoàn tất các bước thiết lập (được mô tả ở trên), bạn sẽ có một
Github repo được kết nối (*nhân bản*) với một dự án R cục bộ. Các
*nhánh chính* (được tạo theo mặc định) là phiên bản được gọi là "live" của
*tất* cả các tệp tin. Khi bạn muốn sửa đổi, nó là một điều tốt
khi thực hành tạo một *nhánh mới* từ nhánh *chính* (như "Tạo
Sao chép"). Đây là quy trình công việc điển hình trong Git vì việc tạo một nhánh là
dễ dàng và nhanh chóng. 

Quy trình làm việc điển hình như sau:

1.  Đảm bảo rằng kho lưu trữ cục bộ của bạn được cập nhật, hãy cập nhật nó nếu không 

2.  Chuyển đến nhánh mà bạn đã làm việc trước đây hoặc tạo một nhánh làm việc mới
    để thử một số thứ 


3.  Làm việc trên các tệp cục bộ trên máy tính của bạn, tạo một hoặc nhiều tệp
    cam kết với nhánh làm việc này 

4.  Cập nhật phiên bản từ xa của nhánh làm việc với các thay đổi của bạn (push) 

5.  Khi bạn hài lòng với nhánh cục bộ của mình, bạn có thể hợp nhất với phiên bản trực tuyến
    thành nhánh "chính" trực tuyến để hợp nhất những thay đổi vào nhánh chính

Các thành viên khác trong nhóm có thể đang làm điều tương tự với các nhánh cục bộ của riêng họ,
hoặc có thể đóng góp commits vào nhánh làm việc của bạn. 

Chúng ta sẽ đi qua một cách chi tiết hơn từng bước trong quá trình trên ở dưới đây.
Đây là một giản đồ mà chúng tôi đã phát triển - nó ở định dạng hai chiều
vì vậy nó sẽ giúp các nhà dịch tễ học dễ dàng hiểu được. 

```{r echo=F, out.height='150%', out.width='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_table.png"))
```

Dây là [một sơ đồ khác](https://build5nines.com/introduction-to-git-version-control-workflow/).

*Lưu ý: cho đến gần đây, thuật ngữ nhánh "chủ" đã được sử dụng, nhưng bây giờ thuật ngữ này
được gọi là nhánh "chính".* 

```{r echo=F, out.width = '100%', out.height='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "GitHub-Flow.png"))
```

Tài liệu tham khảo cho [hình ảnh](https://build5nines.com/introduction-to-git-version-control-workflow/)

## Tạo một chi nhánh mới 

Khi bạn chọn một nhánh để làm việc, **Git đặt lại thư mục làm việc của bạn
như lần cuối cùng bạn ở trên chi nhánh này**. 

### Trong cửa sổ Rstudio Git {.unnumbered}

Đảm bảo bạn đang ở trong nhánh "chính", sau đó nhấp vào biểu tượng màu tím để
tạo một nhánh mới (xem hình trên). 

-   Bạn sẽ được yêu cầu đặt tên chi nhánh của mình với mô tả một từ
    (có thể sử dụng dấu gạch dưới nếu cần). 
-   Bạn sẽ thấy rằng về cục bộ, bạn vẫn đang ở trong cùng một dự án R, nhưng
    bạn không còn làm việc trên nhánh "chính". 
-   Sau khi được tạo, chi nhánh mới cũng sẽ xuất hiện trên trang web Github
    như một chi nhánh. 

Bạn có thể hình dung các nhánh trong Git Pane trong Rstudio sau khi nhấp vào "History" (lịch sử)

```{r echo=F, out.width = '100%', out.height='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_rstudio_branchs.png"))
```


### Trong Github Desktop {.unnumbered}

Quá trình này rất giống nhau, bạn được yêu cầu cung cấp cho nhánh làm việc của mình
một cái tên. Sau đó, bạn sẽ được yeu cầu "Xuất bản nhánh làm việc của bạn lên Github" để
làm cho nhánh mới cũng xuất hiện trong repo từ xa. 


```{r echo=F, out.width = '100%', out.height='100%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_new_branch.png"))
```

### Trong console {.unnumbered}

Điều thực sự đang xảy ra đằng sau màn hình làm việc của bạn là bạn tạo ra một
nhánh với `git branch`, sau đó chuyển đến nhánh với
`git checkout` (_i.e._ cho Git biết rằng các cam kết tiếp theo của bạn sẽ xảy ra ở đó).
Từ kho lưu trữ git của bạn: 

```{bash, eval = FALSE}
git branch my-new-branch  # Create the new branch branch
git checkout my-new-branch # Go to the branch
git checkout -b my-new-branch # Both at once (shortcut)
```

Để biết thêm thông tin về cách sử dụng bảng console, hãy xem phần
Lệnh Git ở cuối. 

## Commit các thay đổi 

Giờ đây, bạn có thể chỉnh sửa mã, thêm tệp mới, cập nhật bộ dữ liệu, v.v. 

Mọi thay đổi của bạn đều được theo dõi, *sau khi tệp tương ứng được
lưu*. Các tệp đã thay đổi sẽ xuất hiện trong tab RStudio Git, trong Github
Desktop hoặc sử dụng lệnh `git status` trong terminal (xem bên dưới). 

Bất cứ khi nào bạn thực hiện các thay đổi quan trọng (ví dụ: thêm hoặc cập nhật một phần của
mã), bạn hãy tạm dừng việc thay đổi và *commit* những thay đổi đó. Bạn có thể nghĩ mỗi lần commit như vậy là một "lần"
gửi các thay đổi mà bạn chỉnh sửa đến file tổng hợp các thay đổi. Bạn sẽ luôn có thể tiếp tục
sửa đổi tệp sau khi đã commit các thay đổi trên đó. 


*Lời khuyên về cách commit*: nói chung, tốt hơn là bạn nên thực hiện các commit nhỏ, điều đó
có thể dễ dàng khôi phục các chỉnh sửa nếu có vấn đề phát sinh, cùng commit
sửa đổi liên quan đến một mục đích chung. Để đạt được điều này, bạn sẽ
thấy rằng *bạn nên commit thường xuyên*. Khi bắt đầu, bạn có thể phải nhớ để
thường xuyên quên commit, nhưng sau đó thói quen commit thường xuyên bắt đầu xuất hiện. 

### Trong Rstudio {.unnumbered}

Ví dụ dưới đây cho thấy rằng, kể từ lần commit cuối cùng, tập lệnh R Markdown "collab.Rmd" đã thay đổi,
và một số hình ảnh PNG đã được thêm vào. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_tracking2.png"))
```

Bạn có thể tự hỏi những hình vuông màu vàng, xanh lam, xanh lá cây và đỏ bên cạnh
tên tệp đại diện có ý nghĩa gì. Đây là ảnh chụp nhanh từ [RStudio cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf)
trong đó giải thích ý nghĩa của chúng. Lưu ý rằng các thay đổi với màu vàng "?" có thể còn
được trình bày, commit và đẩy lên nhánh chính. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_tracking.png"))
```

-   Nhấn vào nút "Commit" trong tab Git tab, nút này sẽ mở ra
    một cửa sổ (hiển thị bên dưới) 

-   Nhấp vào tên tệp trong hộp phía trên bên trái

-   Xem lại những thay đổi bạn đã thực hiện đối với tệp đó (được đánh dấu màu xanh lục bên dưới
    hoặc đỏ) 

-   "Trình bày" các tệp, sẽ bao gồm những thay đổi đó trong commit. Bạn có thể
    thực hiện việc này bằng cách chọn hộp bên cạnh tên tệp. Ngoài ra, bạn
    có thể đánh dấu nhiều tên tệp và sau đó nhấp vào "Stage" 

-   Viết một thông điệp commit ngắn gọn nhưng mang tính mô tả (bắt buộc) 

-   Ấn vào nút "Commit". Một hộp sẽ xuất hiện cho biết lệnh commit được thực hiện thành công
    hoặc một thông báo về thực hiện lỗi.


Giờ đây, bạn có thể thực hiện nhiều thay đổi hơn và nhiều lần commit hơn, bao nhiêu lần tùy ý 

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_commit.png"))
```

### Trong Github Desktop {.unnumbered}

Bạn có thể xem danh sách các tệp đã được thay đổi ở bên trái. Nếu như
bạn chọn một tệp văn bản, bạn sẽ thấy một bản tóm tắt về các sửa đổi đã được thực hiện
trong ngăn bên phải (chế độ xem sẽ không hoạt động trên các tệp phức tạp hơn như .docs hoặc .xlsx). 

To stage the changes, just tick the little box near file names. When you
have selected the files you want to add to this commit, give the commit
a name, optionally a description and then click on the **commit**
button.
Để trình bày các thay đổi, chỉ cần đánh dấu vào ô nhỏ gần tên tệp. Khi bạn
đã chọn các tệp bạn muốn thêm vào lần commit này, hãy cung cấp cho lần commit một cái
tên, tùy chọn mô tả và sau đó nhấp vào **nút commit**. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_commit.png"))
```

### Trong cửa sổ console {.unnumbered}

Hai chức năng được sử dụng đằng sau màn hình làm việc của bạn là `git add` để chọn/theo dõi
tệp và `git commit` để lưu các thay đổi. 

```{bash, eval = FALSE}
git status # see the changes 

git add new_pages/collaboration.Rmd  # select files to commit (= stage the changes)

git commit -m "Describe commit from Github Desktop" # commit the changes with a message

git log  # view information on past commits
```


### Sửa đổi lần commit trước đó {.unnumbered}

Điều gì sẽ xảy ra nếu bạn đã commit một số thay đổi, tiếp tục làm việc và nhận ra
rằng bạn đã thực hiện các thay đổi mà lẽ ra "thuộc về" lần commit trong quá khứ (theo ý kiến của bạn).
Đừng sợ! Bạn có thể nối những thay đổi này vào lần commit trước đó của mình. 

Trong Rstudio, nó sẽ khá rõ ràng vì có một "Sửa đổi lần commit trước"
trên cùng dòng với nút COMMIT. 

For some unclear reason, the functionality has not been implemented 
as such in Github Desktop, but there is a (conceptually awkward but easy)
way around. If you have committed **but not pushed** your changes yet, 
an "UNDO" button appears just under the COMMIT button. Click on it and 
it will revert your commit (but keep your staged files and your commit message). 
Save your changes, add new files to the commit if necessary and commit again.

Vì một số lý do không rõ ràng, chức năng commit đã không được thực hiện
chẳng hạn như trong Github Desktop, nhưng có cách (khó hiểu về mặt khái niệm nhưng dễ dàng).
Nếu bạn đã commit **nhưng chưa đẩy** các thay đổi của bạn lên nhánh chính,
nút "UNDO" xuất hiện ngay dưới nút COMMIT. Nhấp vào nó và
nó sẽ khôi phục commit của bạn (nhưng vẫn giữ các tệp theo giai đoạn và thông báo commit của bạn).
Lưu các thay đổi của bạn, thêm tệp mới vào commit nếu cần và commit lại. 

Trong cửa số console:  

```{bash, eval = FALSE}
git add [YOUR FILES] # Stage your new changes

git commit --amend  # Amend the previous commit

git commit --amend -m "An updated commit message"  # Amend the previous commit AND update the commit message
```


_Lưu ý: hãy suy nghĩ trước khi sửa đổi các commit đã được công khai và chia sẻ với các cộng tác viên của bạn_. 

## Pull and push các thay đổi lên Github

"Đầu tiên là PULL, sau đó PUSH"

Tốt hơn là bạn nên thực hành *tìm* và *pull* trước khi bạn bắt đầu làm việc
dự án của bạn, để cập nhật phiên bản nhánh trên máy tính cục bộ của bạn với
bất kỳ thay đổi nào đã được thực hiện đối với nó trong phiên bản từ xa/Github. 

Thường xuyên PULL often.Đừng chần chừ. *Luôn nhớ pull trước khi pushing*.

Khi các thay đổi của bạn được thực hiện và commit và bạn hài lòng với
trạng thái dự án của bạn, bạn có thể *push* (đẩy) commit của mình lên
sang phiên bản từ xa/Github của nhánh làm việc của bạn. 

Kiểm tra và lặp lại trong khi bạn đang làm việc trên kho lưu trữ. 

**Lưu ý:** việc khôi phục các thay đổi đã được commit nhưng push lên Github (tức là vẫn còn cục bộ) dễ dàng hơn nhiều
nếu đã được push lên kho lưu trữ từ xa (và có lẽ đã được người khác sử dụng), vì vậy tốt hơn là
bạn nên push những thay đổi khi bạn hoàn thành việc giới thiệu các thay đổi về nhiệm vụ
bạn đã làm việc trên. 


#### Trong Rstudio {.unnumbered}

*PULL* - Đầu tiên, ấn vào icon "Pull" (mũi tên hướng xuống) tìm và
pulls cùng một lúc.

*PUSH* - Ấn vào icon màu xanh "Pull" (mũi tên hướng lên). Bạn có thể được hỏi
để nhập tên người dùng và mật khẩu Github của bạn. Lần đầu tiên bạn
được hỏi, bạn có thể cần nhập hai dòng lệnh Git vào *Terminal*: 

-   **git config --global user.email
    "[you\@example.com](mailto:you@example.com){.email}"** (Địa chỉ email Github
    mà bạn sử dụng), và\
-   **git config --global user.name "Tên đăng nhập Github của bạn"**

Để tìm hiểu thêm về cách nhập các lệnh này, hãy xem phần bên dưới
trên các lệnh Git. 

***TIP:*** Nếu bạn cảm thấy bị yêu cầu cung cấp mật khẩu của bạn quá thường xuyên? Xem các chương 
10 & 11 trong
[hướng dẫn này](https://happygitwithr.com/credential-caching.html#credential-caching)
để kết nối với kho lưu trữ bằng khóa SSH (phức tạp hơn) 


#### Trong Github Desktop {.unnumbered}

Nhấp vào nút "Fetch origin" để kiểm tra xem có commit mới trên
kho lưu trữ từ xa. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_fetch_button.png"))
```


Nếu Git tìm thấy các commit mới trên kho lưu trữ từ xa, nút commit sẽ
thay đổi thành nút "Push". Bởi vì cùng một nút được sử dụng để push và
pull, bạn không thể push các thay đổi của mình nếu bạn không pull trước đó. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_pull_button.png"))
```

Bạn có thể chuyển đến tab "History" (gần tab "Changes") để xem tất cả những thay đổi được
commits (của bạn và những người khác). Đây là một cách tốt để tự làm quen
với những gì cộng tác viên của bạn đã làm. Bạn có thể đọc thông báo commit,
mô tả nếu có và so sánh mã của hai tệp bằng cách sử dụng
cửa sổ *diff*. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_history.png"))
```


Khi tất cả các thay đổi từ xa đã được pull và ít nhất một thay đổi cục bộ
đã được commit, bạn có thể push bằng cách nhấp vào cùng một nút. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_push_button.png"))
```

#### Cửa sổ Console {.unnumbered}

Không có gì ngạc nhiên, các lệnh là *fetch*, *pull* và *push*.

```{bash, eval = FALSE}
git fetch  # are there new commits in the remote directory?
git pull   # Bring remote commits into your local branch
git push   # Puch local commits of this branch to the remote branch
```


### Tôi muốn pull các chỉnh sửa nhưng tôi vẫn cần làm việc với các chỉnh sửa trong máy tính cục bộ {.unnumbered}

Điều này đôi khi có thể xảy ra:
khi bạn đã thực hiện một số thay đổi trên kho lưu trữ cục bộ của mình, nhưng kho lưu trữ từ xa
có các cam kết mà bạn đã không pull.  


Git sẽ từ chối pull vì nó có thể ghi đè các thay đổi của bạn.
Có một số chiến lược để lưu các thay đổi của bạn,
được mô tả tốt trong trang [Happy Git with R](https://happygitwithr.com/pull-tricky.html),
trong đó hai điều chính như sau:
- commit các thay đổi của bạn, tìm nạp các thay đổi từ xa, pull chúng vào, giải quyết xung đột
nếu cần (xem phần bên dưới) và push mọi thứ lên mạng
- `cất giữ` các thay đổi của bạn, loại lưu trữ chúng sang một bên, pull, unstash
(khôi phục), và sau đó commit, giải quyết mọi xung đột và thúc đẩy. 



Nếu các tệp được quan tâm bởi các thay đổi từ xa và các tệp có liên quan
bởi các thay đổi cục bộ của bạn không trùng lặp, Git có thể tự động giải quyết các xung đột. 

Trong Github Desktop, điều này có thể được thực hiện với các nút. Để lưu trữ, hãy truy cập  _Branch > Stash all changes_.

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_stash.png"))
```



## Hợp nhất chi nhánh vào Nhánh chính  

Nếu bạn đã thực hiện xong các thay đổi, bạn có thể bắt đầu quá trình
hợp nhất những thay đổi đó vào nhánh chính. Tùy thuộc vào tình huống của bạn,
điều này có thể nhanh hoặc bạn có thể có sự xem xét và phê duyệt có chủ ý
liên quan đến các thành viên trong nhóm. 

### Cục bộ trong Github Desktop {.unnumbered}

Người ta có thể hợp nhất các chi nhánh cục bộ bằng Github Desktop. Đầu tiên, hãy truy cập
(thanh toán) chi nhánh sẽ là người nhận các commit, nói cách khác,
chi nhánh bạn muốn cập nhật. Sau đó vào menu *Branch \> Merge into
current branch* và nhấp vào. Một hộp sẽ cho phép bạn chọn chi nhánh bạn
muốn nhập vào. 

```{r echo=F, fig.align = "center"}
knitr::include_graphics(here::here("images", "github_desktop_merge.png"))
```

### Trong cửa sổ console {.unnumbered}

Đầu tiên hãy quay lại chi nhánh sẽ nhận các thay đổi.
Đây thường là nhánh *master*, nhưng nó cũng có thể là một nhánh khác. Sau đó hợp nhất các chi nhánh làm việc
của bạn thành một file tổng thể. 

```{bash, eval = FALSE}
git checkout master  # Go back to master (or to the branch you want to move your )
git merge this_fancy_new_branch
```

[Tài liệu này](https://git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging)
hiển thị một ví dụ nâng cao hơn về phân nhánh và giải thích một chút
quá trình diễn ra sau màn hình của bạn. 

### Trong Github: gửi một pull requests {.unnumbered}

Mặc dù hoàn toàn có thể hợp nhất hai chi nhánh cục bộ mà không
thông báo cho bất kỳ ai, hoặc việc hợp nhất có thể được thảo luận hoặc điều tra bởi một số
người trước khi được tích hợp vào nhánh chủ. Để giúp đỡ với
quá trình này, Github cung cấp một số tính năng thảo luận xung quanh việc hợp nhất có tên là:
**pull request**. 


Một pull request (một "PR") là một yêu cầu hợp nhất một nhánh vào một nhánh khác
(nói cách khác, một yêu cầu _nhánh làm việc của bạn được kéo vào nhánh "chính"_).
Một pull request thường bao gồm nhiều lần commit. Một pull request thường bắt đầu một cuộc thảo luận và xem xét
xử lý trước khi nó được chấp nhận và được hợp nhất vào chi nhánh chính. Ví dụ,
bạn có thể đọc các cuộc thảo luận về pull request trên [dplyr's github](https://github.com/tidyverse/dplyr/pulls).


Bạn có thể submit một pull request (PR) trực tiếp từ trang web (như
minh họa bên dưới) hoặc từ Github Desktop. 

-   Đi tới kho lưu trữ Github (trực tuyến) 
-   Xem tab "Pull Requests" và ấn vào nút "New pull request" 
-   Chọn từ menu thả xuống để hợp nhất chi nhánh của bạn thành chính 
-   Viết chi tiết bình luận cho Pull Request và ấn vào "Create Pull
    Request".

Trong hình ảnh dưới đây, các nhánh "phụ" (forest) đã được chọn để hợp nhất
thành "chính" (main):

```{r echo=F, out.width = '100%', out.height='150%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_pull_request2.png"))
```

Now you should be able to see the pull request (example image below):

-   Review the tab "Files changed" to see how the "main" branch would
    change if the branch were merged.\
-   On the right, you can request a review from members of your team by
    tagging their Github ID. If you like, you can set the repository
    settings to require one approving review in order to merge into
    main.\
-   Once the pull request is approved, a button to
    "Merge pull request" will become active. Click this.\
-   Once completed, delete your branch as explained below.

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_pull_request.png"))
```

### Resolving conflicts {.unnumbered}

When two people modified the same line(s) at the same time, a
merge conflict arises. Indeed, Git refuses to make a decision about
which version to keep, but it helps you find where the
conflict is. **DO NOT PANIC**. Most of the time, it is pretty straightforward
to resolve.

For example, on Github:

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_conflict2.png"))
```


After the merge raised a conflict, open the file in your favorite editor.
The conflict will be indicated by series of characters:

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_conflict3.png"))
```

The text between *\<\<\<\<\<\<\< HEAD* and *=======* comes from your
local repository, and the one between *=======* and *\>\>\>\>\>\>\>* from the
the other branch (which may be origin, master or any branch of
your choice).

You need to decide which version of the code you prefer (or even write a
third, including changes from both sides if pertinent), delete the rest
and remove all the marks that Git added *(\<\<\<\<\<\<\< HEAD, =======,
\>\>\>\>\>\>\> origin/master/your_branch_name*). 

Then, save the file, stage it and commit it : this is the commit 
that makes the merged version "official". Do not forget to push afterwards.

The more often you and your collaborators pull and push, the smaller the
conflicts will be.


*Note: If you feel at ease with the console, there are more [advanced
merging
options](https://git-scm.com/book/en/v2/Git-Tools-Advanced-Merging)
(e.g. ignoring whitespace, giving a collaborator priority etc.).*

### Delete your branch {.unnumbered}

Once a branch was merged into master and is no longer needed, you can
delete it.

#### Github + Rstudio

Go to the repository on Github and click the button to view all the
branches (next to the drop-down to select branches). Now find your
branch and click the trash icon next to it. Read more detail on deleting
a branch
[here](https://docs.github.com/en/free-pro-team@latest/github/collaborating-with-issues-and-pull-requests/creating-and-deleting-branches-within-your-repository#deleting-a-branch).

Be sure to also delete the branch locally on your computer. This will
not happen automatically.

-   From RStudio, make sure you are in the Main branch
-   Switch to typing Git commands in the RStudio "Terminal" (the tab
    adjacent to the R console), and type: **git branch -d
    branch_name**, where "branch_name" is the name of your branch to be
    deleted
-   Refresh your Git tab and the branch should be gone


#### In Github Desktop

Just checkout the branch you want to delete, and go to the menu
*Branch \> Delete*.


### Forking {.unnumbered}

You can fork a project if you would like to contribute to it but 
do not have the rights to do so, or if you just 
want to modify it for your personal use. A 
short description of forking can be found [here](https://guides.github.com/activities/forking/).

On Github, click on the "Fork" button:  

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_fork_1.png"))
```

This will clone the original repository, but in your own profile. So now, 
there are two versions of the repository **on Github**: the original one,
that you cannot modify, and the cloned version in your profile.

Then, you can proceed to clone your version of the online repository locally 
on your computer, using any of the methods described in previous sections. 
Then, you can create a new branch, make changes, commit and push them 
_to your remote repository_.

Once you are happy with the result you can create a Pull Request 
from Github or Github Desktop to begin the conversation with the 
owners/maintainers of the original repository.


**What if you need some newer commits from the official repository?**

Imagine that someone makes a critical modification to the official repository,
which you want to include to your cloned version.
It is possible to synchronize your fork with the official repository. 
It involves using the terminal, but it is not too complicated. 
You mostly need to remember that:
- _upstream_ = the official repository, the one that you could not modify
- _origin_ = your version of the repository on your Github profile


You can read [this tutorial](https://docs.github.com/en/github/collaborating-with-issues-and-pull-requests/syncing-a-fork) or follow along below: 


First, type in your Git terminal (inside your repo):  

```{bash, eval = FALSE}
git remote -v
```
 
If you have not yet configured the upstream repository you should 
see two lines, beginning by _origin_. They show the remote repo 
that `fetch` and `push` point to. Remember, _origin_ is the conventional
nickname for your own version of the repository on Github. For example:  

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_fork_2.png"))
```

Now, add a new remote repository:  

```{bash, eval = FALSE}
git remote add upstream https://github.com/appliedepi/epirhandbook_eng.git
```
 
Here the address is the address that Github generates when you clone
a repository (see section on cloning). Now you will have four remote pointers:

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_fork_3.png"))
```

Now that the setup is done, whenever you want to get the changes from 
the original (_upstream_) repository, you just have to go (_checkout_) to 
the branch you want to update and type:

```{bash, eval = FALSE}
git fetch upstream # Get the new commits from the remote repository
git checkout the_branch_you_want_to_update
git merge upstream/the_branch_you_want_to_update  # Merge the upstream branch into your branch.
git push # Update your own version of the remote repo
```

If there are conflicts, you will have to solve them, as explained 
in the Resolving conflicts section. 


**Summary**: forking is cloning, but on the Github server side. 
The rest of the actions are typical collaboration workflow actions 
(clone, push, pull, commit, merge, submit pull requests...).

_Note: while forking is a concept, not a Git command, it also exist on other Web hosts, like [Bitbucket](https://www.atlassian.com/git/tutorials/comparing-workflows/forking-workflow)._


```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_fork_4.png"))
```


## What we learned

You have learned how to:  

- setup Git to track modifications in your folders,  
- connect your local repository to a remote online repository,  
- commit changes,  
- synchronize your local and remote repositories.  

All this should get you going and be enough for most of your needs as 
epidemiologists. We usually do not have as advanced usage as developers. 

However, know that should you want (or need) to go further, Git offers more power to simplify 
commit histories, revert one or several commits, cherry-pick commits, etc. 
Some of it may sound like pure wizardry, but now that you have the basics, 
it is easier to build on it.


Note that while the Git pane in Rstudio and Github Desktop are good for 
beginners / day-to-day usage in our line of work, they do not offer an 
interface to some of the intermediate / advanced Git functions. 
Some more complete interfaces allows you to do more with point-and-click 
(usually at the cost of a more complex layout). 

Remember that since you can use any tool at any point to track your repository, 
you can very easily install an interface to try it out sometimes, 
or to perform some less common complex task occasionally, 
while preferring a simplified interface for the rest of time (e.g. using 
Github Desktop most of the time, and switching to SourceTree or Gitbash for some specific tasks).


## Git commands {#git}


### Recommended learning {.unnumbered}

To learn Git commands in an interactive tutorial, see [this
website](https://learngitbranching.js.org/).

### Where to enter commands {.unnumbered}

You enter commands in a Git shell.

*Option 1* You can open a new Terminal in RStudio. This tab is next to
the R Console. If you cannot type any text in it, click on the
drop-down menu below "Terminal" and select "New terminal". Type the
commands at the blinking space in front of the dollar sign "\$".

```{r echo=F, out.width = '100%', out.height='200%', fig.align = "center"}
knitr::include_graphics(here::here("images", "github_terminal.png"))
```

*Option 2* You can also open a *shell* (a terminal to enter commands) by
clicking the blue "gears" icon in the Git tab (near the RStudio
Environment). Select "Shell" from the drop-down menu. A new window will
open where you can type the commands after the dollar sign "\$".

*Option 3* Right click to open "Git Bash here" which will open the same
sort of terminal, or open *Git Bash* form your application list.
[More beginner-friendly informations on Git Bash](https://happygitwithr.com/shell.html), 
how to find it and some bash commands you will need.

### Sample commands {.unnumbered}

Below we present a few common git commands. When you use them, keep in mind
which branch is active (checked-out), as that will change the action!

In the commands below, <name> represents a branch name. 
<commit_hash> represents the hash ID of a specific
commit. <num> represents a number. Do not type the
\< or \> symbols.

| Git command              | Action                                                                   |
|--------------------------|--------------------------------------------------------------------------|
| `git branch <name>`      | Create a new branch with the name <name>                                 |
| `git checkout <name>`    | Switch current branch to <name>                                          |
| `git checkout -b <name>` | Shortcut to create new branch *and* switch to it                         |
| `git status`             | See untracked changes                                                    |
| `git add <file>`         | Stage a file                                                             |
| `git commit -m <message>`| Commit currently staged changes to current branch with message |
| `git fetch`              | Fetch commits from remote repository                                     |
| `git pull`               | Pull commits from remote repository in current branch                    |
| `git push`               | Push local commits to remote directory                          |
| `git switch`             | An alternative to `git checkout` that is being phased in to Git |
| `git merge <name>`       | Merge <name> branch into current branch                         |
| `git rebase <name>`      | Append commits from current branch on to <name> branch          |



<!-- ======================================================= -->

## Resources

Much of this page was informed by [this "Happy Git with R"
website](https://happygitwithr.com/) by Jenny Bryan. There is a very helpful
section of this website that helps you troubleshoot common Git and
R-related errors.

The [Github.com documentation and start
guide](https://docs.github.com/en/github).

The RStudio ["IDE"
cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf)
which includes tips on Git with RStudio.

<https://ohi-science.org/news/github-going-back-in-time>

**Git commands for beginners**

An [interactive
tutorial](learngitbranching.js.org) to learn
Git commands.

<https://www.freecodecamp.org/news/an-introduction-to-git-for-absolute-beginners-86fa1d32ff71/>:
good for learning the absolute basics to track changes in one folder on
you own computer.

Nice schematics to understand branches:
<https://speakerdeck.com/alicebartlett/git-for-humans>


**Tutorials covering both basic and more advanced subjects**

<https://tutorialzine.com/2016/06/learn-git-in-30-minutes>

<https://dzone.com/articles/git-tutorial-commands-and-operations-in-git>
<https://swcarpentry.github.io/git-novice/> (short course)
<https://rsjakob.gitbooks.io/git/content/chapter1.html>

The [Pro Git book](https://git-scm.com/book/en/v2) is considered an official reference. 
While some chapters are ok, it is usually a bit _technical_. It is probably a good resource 
once you have used Git a bit and want to learn a bit more precisely 
what happens and how to go further.