---
knit: "bookdown::render_book"
title: "Cẩm nang dịch tễ học với R"  
description: "The Epi R Handbook is a R reference manual for applied epidemiology and public health."
author: "the handbook team"
date: "`r Sys.Date()`"
#url: 'https://github.com/nsbatra/Epi_R_handbook'
#twitter-handle: 
#cover-image: images/R_Handbook_Logo.png
site: bookdown::bookdown_site
# output: bookdown::gitbook:
#      config:
#           sharing:
#                twitter: yes
#                facebook: yes
#                whatsapp: yes
#                github: yes
documentclass: book
---

# output: bookdown::gitbook:

Placeholder


## Dịch tễ học ứng dụng và y tế công cộng với R {.unnumbered}
## Sổ tay này được sử dụng như thế nào {.unnumbered}
## Lời cảm ơn {.unnumbered}
### Những người đóng góp {.unnumbered}
### Tài trợ và hỗ trợ {.unnumbered}
### Cảm hứng {.unnumbered}
## Điều khoản sử dụng và đóng góp {.unnumbered}
### Giấy phép {.unnumbered}
### Trích dẫn {.unnumbered}
### Đóng góp {.unnumbered}

<!--chapter:end:index.Rmd-->

# (PART) Về cuốn sách này {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_about_book.Rmd-->


# Biên tập và ghi chú kỹ thuật {#editorial-style}

Placeholder


## Cách tiếp cận và phong cách
### R packages {.unnumbered}
### Phong cách viết code {.unnumbered}
### Danh pháp {.unnumbered}
### Lưu ý {.unnumbered}
## Quyết định biên tập
## Các bản sửa đổi chính
## Thông tin phiên làm việc (R, RStudio, packages)

<!--chapter:end:new_pages/editorial_style.Rmd-->


# Tải sách và dữ liệu {#data-used}

Placeholder


## Tải sách ngoại tuyến
### Sử dụng link download {.unnumbered}
### Sử dụng package của chúng tôi {.unnumbered}
## Tải dữ liệu xuống để tiện theo dõi
### Sử dụng package của chúng tôi {.unnumbered}
### Tải từng thứ một {.unnumbered}
#### Dữ liệu linelist {.unnumbered}
#### Dữ liệu số trường hợp sốt rét {#data_malaria .unnumbered}
#### Dữ liệu thang đo Likert {.unnumbered}
#### Flexdashboard {.unnumbered}
#### Truy vết tiếp xúc {.unnumbered}
#### GIS {.unnumbered}
#### Cây phả hệ {.unnumbered}
#### Chuẩn hóa {.unnumbered}
#### Chuỗi thời gian và phát hiện ổ dịch {#data_outbreak .unnumbered}
#### Phân tích sống còn {#data_survey .unnumbered}
#### Shiny {#data_shiny .unnumbered}

<!--chapter:end:new_pages/data_used.Rmd-->

# (PART) Nhập môn về R {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_basics.Rmd-->


# R Cơ bản {#basics}

Placeholder


## Tại sao sử dụng R?
## Các thuật ngữ chính
## Tài nguyên học liệu {#learning}
### Tài nguyên trong RStudio {.unnumbered}
### Cheatsheets {.unnumbered}
### Twitter {.unnumbered}
### Nguồn tài nguyên trực tuyến miễn phí {.unnumbered}
### Các ngôn ngữ khác ngoài Tiếng Anh {.unnumbered}
## Cài đặt
### R và RStudio {.unnumbered}
### Những phần mềm khác bạn *có thể* cần cài đặt {.unnumbered}
#### TinyTex {.unnumbered}
#### Pandoc {.unnumbered}
#### RTools {.unnumbered}
#### phantomjs {.unnumbered}
## RStudio {#rstudio}
### Làm quen {.unnumbered}
### Các cài đặt của RStudio {.unnumbered}
### Các phím tắt {.unnumbered}
## Hàm {#functions}
### Các hàm cơ bản {.unnumbered}
### Hàm với nhiều đối số {.unnumbered}
### Viết hàm {.unnumbered}
## Packages {#packages}
### Cài đặt và Gọi {.unnumbered}
#### Thư viện của bạn {.unnumbered}
#### Cài đặt từ CRAN {.unnumbered}
#### Làm thế nào để cài đặt và gọi {.unnumbered}
### Cú pháp code {.unnumbered}
### Trợ giúp về hàm {.unnumbered}
### Cập nhật packages {.unnumbered}
### Xóa packages {.unnumbered}
### Sự phụ thuộc {.unnumbered}
### Hàm bị che giấu {.unnumbered}
### Gỡ package {.unnumbered}
### Cài đặt phiên bản cũ hơn {.unnumbered}
### Packages đề xuất {.unnumbered}
## Scripts {#scripts}
### Bình luận {.unnumbered}
### Phong cách viết code {.unnumbered}
### Ví dụ về Script {.unnumbered}
### R markdown {.unnumbered}
### R notebooks {.unnumbered}
### Shiny {.unnumbered}
### Thu gọn Code {.unnumbered}
## Thư mục làm việc
### Gợi ý cách tiếp cận {.unnumbered}
### Thiết lập bằng lệnh {.unnumbered}
### Thiết lập thủ công {.unnumbered}
### Thiết lập bên trong một dự án R {.unnumbered}
### Thư mục làm việc với R markdown {.unnumbered}
### Cung cấp đường dẫn tệp {.unnumbered}
## Đối tượng {#objects}
### Mọi thứ đều là một đối tượng {.unnumbered}
### Định nghĩa một đối tượng (`<-`) {.unnumbered}
### Cấu trúc đối tượng {#objectstructure}
### Kiểu đối tượng {.unnumbered}
### Cột / Biến số (`$`) {.unnumbered}
### Truy cập / indexing đối tượng bằng dấu ngoặc vuông (`[ ]`) {.unnumbered}
### Xóa đối tượng {.unnumbered}
## Piping (`%>%`)
### **Pipes** {.unnumbered}
### Định nghĩa đối tượng trung gian {.unnumbered}
## Các toán tử và hàm chính {#operators}
### Toán tử gán {.unnumbered}
### Toán tử quan hệ và logic {.unnumbered}
### Giá trị Missing {.unnumbered}
### Toán học và thống kê
#### Toán tử toán học {.unnumbered}
#### Các hàm toán học {.unnumbered}
#### Ký hiệu khoa học {.unnumbered}
#### Làm tròn {.unnumbered}
#### Các hàm thống kê {.unnumbered}
#### Một số hàm hữu ích khác {.unnumbered}
### `%in%` {.unnumbered}
## Lỗi và cảnh báo
### Lỗi và Cảnh báo {.unnumbered}
### Mẹo cú pháp chung {.unnumbered}
### Trợ giúp viết code {.unnumbered}

<!--chapter:end:new_pages/basics.Rmd-->


# Chuyển đổi sang R {#transition-to-R}

Placeholder


## Từ Excel
### Lợi ích {.unnumbered}
### Tidy data {.unnumbered}
### Hàm {.unnumbered}
### Script {.unnumbered}
### Tài liệu liên quan đến chuyển đổi từ Excel-sang-R {.unnumbered}
### Tương tác giữa R và Excel {.unnumbered}
## Từ Stata
## Từ SAS
## Khả năng tương tác dữ liệu

<!--chapter:end:new_pages/transition_to_R.Rmd-->


# Package đề xuất {#packages-suggested}

Placeholder


## Packages từ CRAN  
## Packages từ Github  

<!--chapter:end:new_pages/packages_suggested.Rmd-->


# Dự án R {#r-projects}  

Placeholder


## Gợi ý sử dụng  
## Tạo một dự án R {}
### Di chuyển giữa các dự án {.unnumbered}
### Thiết lập {.unnumbered}  
### Tổ chức {.unnumbered}  
### Kiểm soát phiên bản {.unnumbered}  
## Các ví dụ  
## Nguồn {}

<!--chapter:end:new_pages/r_projects.Rmd-->


# Nhập xuất dữ liệu {#importing}

Placeholder


## Tổng quan
## Package **rio**
## Package **here** {#here}
## Đường dẫn tệp
### Đường dẫn tệp "tương đối" {.unnumbered}
### Đường dẫn tệp "tuyệt đối" {.unnumbered}
### Chọn tệp theo cách thủ công {.unnumbered}
## Nhập dữ liệu
### Trang tính Excel cụ thể {.unnumbered}
### Giá trị missing {#import_missing .unnumbered}
### Bỏ qua một số hàng {.unnumbered}
### Quản lý hàng tiêu đề thứ hai {.unnumbered}
### Xóa hàng tiêu đề thứ hai {.unnumbered}
#### Tạo từ điển dữ liệu {.unnumbered}
#### Kết hợp hai hàng tiêu đề {.unnumbered}
### Trang tính Google {.unnumbered}
## Nhập, xuất, tách, kết hợp - nhiều tệp
## Nhập từ Github {#import_github}
### Tệp CSV {.unnumbered}
### Tệp XLSX {.unnumbered}
### Shapefiles {.unnumbered}
## Nhập dữ liệu thủ công
### Nhập theo hàng {.unnumbered}
### Nhập theo cột {.unnumbered}
### Dán từ clipboard {.unnumbered}
## Nhập tệp gần đây nhất
### Ngày trong tên tệp {.unnumbered}
### Sử dụng thông tin tệp {.unnumbered}
## API {#import_api}
### Yêu cầu HTTP (HTTP request) {.unnumbered}
### Package {.unnumbered}
### Dữ liệu công khai {.unnumbered}
### Yêu cầu xác thực {.unnumbered}
## Xuất dữ liệu
### Với package **rio** {.unnumbered}
### Tới clipboard {.unnumbered}
## Tệp RDS {#import_rds}
## Tệp và danh sách Rdata {#import_rdata}
## Lưu biểu đồ
## Tài nguyên học liệu

<!--chapter:end:new_pages/importing.Rmd-->

# (PART) Quản lý dữ liệu {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_data_management.Rmd-->


# Làm sạch số liệu và các hàm quan trọng {#cleaning}

Placeholder


### Các hàm quan trọng {.unnumbered}
### Thuật ngữ {.unnumbered}
## Quy trình làm sạch
## Gọi package
## Nhập dữ liệu
### Nhập {.unnumbered}
### Đánh giá {.unnumbered}
## Tên cột
### Làm sạch tự động {.unnumbered}
### Làm sạch tên cột thủ công {.unnumbered}
#### Thay đối tên cột theo vị trí {.unnumbered}
#### Đổi tên bằng hàm `select()` và `summarise()` {.unnumbered}
### Các thách thức khác {.unnumbered}
#### Cột trống tên trên file Excel {.unnumbered}
#### Hợp nhất tên cột và ô Excel {.unnumbered}
## Chọn hoặc đổi vị trí cột
### Giữ cột {.unnumbered}
### Hàm trợ giúp "tidyselect" {#clean_tidyselect .unnumbered}
### Xóa cột {.unnumbered}
### Hoạt động độc lập {.unnumbered}
#### Thêm vào quy trình làm sạch {.unnumbered}
## Loại bỏ trùng lặp
## Tạo và biến đổi cột
### Tạo cột mới {.unnumbered}
### Chuyển đổi kiểu dữ liệu của cột {.unnumbered}
### Dữ liệu được nhóm {.unnumbered}
### Biến đổi nhiều cột {#clean_across .unnumbered}
#### Lựa chọn cột với hàm `across()` {.unnumbered}
#### Hàm `across()` {.unnumbered}
### Hàm `coalesce()` {.unnumbered}
### Toán lũy tích {.unnumbered}
### Sử dụng **base** R {.unnumbered}
### Thêm vào chuỗi pipe {.unnumbered}
## Mã hóa lại giá trị
### Giá trị cụ thể {.unnumbered}
### Theo logic {.unnumbered}
### Logic đơn giản {.unnumbered}
#### `replace()` {.unnumbered}
#### `ifelse()` và `if_else()` {.unnumbered}
### Logic phức tạp {#clean_case_when .unnumbered}
### Giá trị missing {.unnumbered}
### Từ điển làm sạch {.unnumbered}
#### Thêm vào chuỗi làm sạch {.unnumbered}
## Biến danh mục số {#num_cats}
### Đánh giá phân phối {.unnumbered}
### `age_categories()` {.unnumbered}
### `cut()` {.unnumbered}
### Chia khoảng phân vị {.unnumbered}
### Nhóm có khoảng đều {.unnumbered}
### `case_when()` {.unnumbered}
### Thêm vào chuỗi làm sạch {.unnumbered}
## Thêm hàng
### Thêm từng hàng một {.unnumbered}
### Nối các hàng {.unnumbered}
## Lọc hàng
### Lọc đơn giản {.unnumbered}
### Lọc bỏ các giá trị missing {.unnumbered}
### Lọc bằng số thứ tự của hàng {.unnumbered}
### Lọc phức tạp {.unnumbered}
#### Kiểm tra dữ liệu {.unnumbered}
#### Cách lọc và xử lý các giá trị số và ngày bị missing {.unnumbered}
#### Thiết kế bộ lọc {.unnumbered}
### Độc lập {.unnumbered}
### Xem nhanh các bản ghi {.unnumbered}
#### Thêm vào chuỗi làm sạch {.unnumbered}
## Tính toán theo hàng
## Sắp xếp

<!--chapter:end:new_pages/cleaning.Rmd-->


# Làm việc với ngày tháng {#dates}

Placeholder


## Chuẩn bị
### Gọi packages {.unnumbered}  
### Nhập dữ liệu {.unnumbered}  
## Ngày hiện tại  
## Chuyển đổi sang Ngày  
### **base** R {.unnumbered}  
### **lubridate** {.unnumbered}  
### Kết hợp các cột {.unnumbered}  
## Ngày tháng trong Excel
## Ngày lộn xộn  
## Làm việc với kiểu dữ liệu ngày-giờ  
### Chuyển đổi ngày giờ {.unnumbered}  
### Chỉ chuyển đổi thời gian {.unnumbered}  
### Thời gian chính xác {.unnumbered}  
## Làm việc với ngày   
### Trích xuất các cấu phần của ngày {.unnumbered}  
### Tính toán ngày {.unnumbered}  
### Khoảng ngày {.unnumbered}  
## Hiển thị ngày  
### `format()` {.unnumbered}  
### Tháng-Năm {.unnumbered}  
## Tuần dịch tễ học {#dates_epi_wks}
### **lubridate** {.unnumbered}  
### Đếm theo tuần {.unnumbered}  
### Các thay thế cho tuần dịch tễ học {.unnumbered}  
## Chuyển đổi múi ngày giờ
## Phép toán về khoảng thời gian  
## Nguồn  

<!--chapter:end:new_pages/dates.Rmd-->


# Ký tự và chuỗi {#characters-strings}  

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data  {.unnumbered}  
## Unite, split, and arrange { }
### Combine strings {.unnumbered}
### Dynamic strings {.unnumbered}
### Unite columns  {#str_unite .unnumbered}
### Split {.unnumbered}  
### Split columns {.unnumbered}  
### Arrange alphabetically {.unnumbered} 
### base R functions {.unnumbered}
## Clean and standardise  
### Change case {.unnumbered}
### Pad length  {#str_pad .unnumbered}
### Truncate {.unnumbered} 
### Standardize length {.unnumbered}
### Remove leading/trailing whitespace {.unnumbered}  
### Remove repeated whitespace within {.unnumbered}  
### Wrap into paragraphs {.unnumbered}  
## Handle by position { }
### Extract by character position {.unnumbered}  
### Extract by word position {.unnumbered} 
### Replace by character position {.unnumbered} 
### Evaluate length  {.unnumbered}
## Patterns { }
### Detect a pattern {.unnumbered}
#### Convert commas to periods {.unnumbered}  
### Replace all {.unnumbered}  
### Detect within logic {.unnumbered}
### Locate pattern position {.unnumbered}  
### Extract a match {.unnumbered}  
### Subset and count {.unnumbered}  
### Regex groups {.unnumbered}
## Special characters  
## Regular expressions (regex) 
## Regex and special characters { } 
## Resources { }

<!--chapter:end:new_pages/characters_strings.Rmd-->


# Factors {#factors}

Placeholder


## Chuẩn bị
### Gọi packages {.unnumbered}
### Nhập dữ liệu {.unnumbered}
### Thêm biến danh mục mới {#fct_newcat .unnumbered}
#### Tạo biến {.unnumbered}
#### Thứ tự mặc định của các giá trị {.unnumbered}
## Chuyển đổi sang factor
## Thêm hoặc xóa thứ bậc
### Thêm thứ bậc {#fct_add .unnumbered}
### Xóa thứ bậc {.unnumbered}
## Thay đổi trật tự của các thứ bậc {#fct_adjust}
### Thay đổi thủ công {.unnumbered}
### Đối với biểu đồ {.unnumbered}
### Đảo ngược thứ tự {.unnumbered}
### Theo tần suất {.unnumbered}
### Theo sự xuất hiện {.unnumbered}
### Theo thống kê tóm tắt của một cột khác {.unnumbered}
### Theo giá trị cuối {.unnumbered}
## Giá trị Missing {#fct_missing}
## Kết hợp các thứ bậc trong biến factor
### Kết hợp thủ công {.unnumbered}
### Rút gọn thành "Other" {.unnumbered}
### Rút gọn theo tần suất {.unnumbered}
## Hiển thị tất cả thứ bậc
### Trong biểu đồ {.unnumbered}
### Trong bảng {.unnumbered}
## Tuần dịch tễ
### Tuần dịch tễ trong biểu đồ {.unnumbered}
### Tuần dịch tễ trong dữ liệu {.unnumbered}
## Nguồn tham khảo

<!--chapter:end:new_pages/factors.Rmd-->


# Xoay trục dữ liệu {#pivoting}

Placeholder


## Chuẩn bị
### Gọi package {.unnumbered}
### Nhập dữ liệu {.unnumbered}
### Dữ liệu số trường hợp sốt rét {.unnumbered}
### Bộ dữ liệu các trường hợp `linelist` {.unnumbered}
## Định dạng dữ liệu "ngang-sang-dọc"
### Định dạng "ngang" {.unnumbered}
### `pivot_longer()` {.unnumbered}
### Xoay trục tiêu chuẩn {.unnumbered}
### Xoay trục dữ liệu trên nhiều định dạng cột {.unnumbered}
## Dọc-thành-ngang
### Dữ liệu {.unnumbered}
### Xoay trục ngang {.unnumbered}
## Điền
### Dữ liệu {.unnumbered}
### `fill()` {.unnumbered}
## Tài liệu tham khảo

<!--chapter:end:new_pages/pivoting.Rmd-->


# Nhóm dữ liệu {#grouping}

Placeholder


## Chuẩn bị
### Gọi package {.unnumbered}
### Nạp dữ liệu {.unnumbered}
## Nhóm
### Nhóm duy nhất {.unnumbered}
### Cột mới {.unnumbered}
### Thêm/bỏ cột-nhóm {.unnumbered}
## Giữ tất cả các nhóm
## Loại bỏ nhóm
## Tổng hợp (Summarise) {#group_summarise}
## Counts and tallies
### `tally()` {.unnumbered}
### `count()` {.unnumbered}
### Thêm giá trị đếm {.unnumbered}
### Thêm giá trị tổng {.unnumbered}
## Nhóm theo ngày
### Ngày trong bộ số liệu `linelist` {.unnumbered}
### Tuần trong bộ số liệu `linelist` {.unnumbered}
### Tháng trong bộ số liệu `linelist` {.unnumbered}
### Đếm ngày trong tuần {.unnumbered}
### Đếm ngày trong tháng {.unnumbered}
## Sắp xếp dữ liệu đã nhóm
## Lọc trên nhóm dữ liệu đã nhóm
### `filter()` {.unnumbered}
### Cắt hàng theo nhóm {.unnumbered}
### Lọc trên quy mô nhóm {#group_filter_grp_size .unnumbered}
## Thay đổi trên dữ liệu được nhóm
## Chọn trên dữ liệu được nhóm
## Tham khảo

<!--chapter:end:new_pages/grouping.Rmd-->


# Nối dữ liệu {#joining-matching}

Placeholder


## Chuẩn bị
### Gọi package {.unnumbered}
### Nhập dữ liệu {.unnumbered}
### Bộ dữ liệu mẫu {.unnumbered}
#### Dữ liệu linelist "thu nhỏ" {#joins_llmini .unnumbered}
#### Data frame thông tin bệnh viện {#joins_hosp_info .unnumbered}
### Làm sạch trước {.unnumbered}
## **Nối bằng dplyr**
### Cú pháp chung {.unnumbered}
### Nối trái và phải {.unnumbered}
#### "Tôi nên sử dụng phép nối phải hay phép nối trái?" {.unnumbered}
### Nối hoàn toàn {.unnumbered}
### Nối bên trong {.unnumbered}
### Nối một phần {.unnumbered}
### Anti join {.unnumbered}
#### Ví dụ `anti_join()` đơn giản {.unnumbered}
#### Ví dụ `anti_join()` phức tạp {.unnumbered}
## Khớp theo xác suất
### Khớp theo xác suất {.unnumbered}
### Loại bỏ trùng lặp theo xác suất {.unnumbered}
## Gắn vào và căn chỉnh
### Gắn các hàng {.unnumbered}
### Gắn các cột {.unnumbered}
#### Sử dụng `match()` để sắp xếp thứ tự {.unnumbered}
## Tài nguyên học liệu

<!--chapter:end:new_pages/joining_matching.Rmd-->


# Loại bỏ trùng lặp {#deduplication}

Placeholder


## Chuẩn bị
### Gọi package {.unnumbered}
### Nhập dữ liệu {.unnumbered}
#### Đây là data frame {#dedup_data .unnumbered}
## Loại bỏ trùng lặp
### Kiểm tra hàng trùng lặp {.unnumbered}
### Chỉ giữ lại các hàng duy nhất {.unnumbered}
### Loại bỏ phần tử trùng lặp trong một vectơ {.unnumbered}
### Sử dụng **base** R {.unnumbered}
## Cắt dòng
### Cắt theo nhóm {.unnumbered}
### Giữ lại tất cả nhưng đánh dấu các dòng {.unnumbered}
### Tính toán độ hoàn chỉnh của hàng {.unnumbered}
## Gộp các giá trị {#str_rollup}
### Gộp các giá trị thành một hàng {.unnumbered}
### Ghi đè các giá trị/hệ thống phân cấp {.unnumbered}
## Loại bỏ trùng lặp theo xác suất
## Tài nguyên học liệu

<!--chapter:end:new_pages/deduplication.Rmd-->


# Lặp, vòng lặp, và danh sách {#iteration}  

Placeholder


## Chuẩn bị {  }
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## *for loops* {  }
### *for loops* in R {#iter_loops .unnumbered}  
### Core components {.unnumbered}   
### Sequence {.unnumbered}  
### Operations  {.unnumbered}  
### Container {.unnumbered}
### Printing {.unnumbered}  
### Testing your for loop {.unnumbered}
### Looping plots {.unnumbered}
### Tracking progress of a loop {.unnumbered} 
## **purrr** and lists {#iter_purrr}
### Load packages {.unnumbered}  
### `map()` {.unnumbered}  
#### Example - import and combine Excel sheets {#iter_combined .unnumbered}  
### Split dataset and export {.unnumbered}  
#### Split dataset {.unnumbered}  
##### More than one `group_split()` column {.unnumbered}  
#### Export as Excel sheets {.unnumbered}  
#### Export as CSV files {.unnumbered}  
### Custom functions {.unnumbered}  
### Mapping a function across columns {.unnumbered}  
### Extract from lists {.unnumbered}  
#### Names of elements {.unnumbered}  
#### Elements by name or position {.unnumbered}  
#### `pluck()` {.unnumbered}  
### Convert list to data frame {.unnumbered}  
### Discard, keep, and compact lists {.unnumbered}  
### `pmap()` {.unnumbered}
## Apply functions  
## Resources { }

<!--chapter:end:new_pages/iteration.Rmd-->

# (PART) Phân tích dữ liệu {.unnumbered}

```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_analysis.Rmd-->


# Bảng mô tả {#tables-descriptive}

Placeholder


## Chuẩn bị
### Gọi packages {.unnumbered}
### Nhập dữ liệu {.unnumbered}
## Duyệt dữ liệu
### **skimr** package {.unnumbered}
### Thống kê tóm tắt {.unnumbered}
## **janitor** package {#tbl_janitor}
### tabyl đơn giản {.unnumbered}
### Bảng chéo {.unnumbered}
### "Tô điểm" cho tabyl {#tbl_adorn .unnumbered}
### In với tabyl {.unnumbered}
### Sử dụng trên các bảng khác {.unnumbered}
### Lưu với tabyl {.unnumbered}
### Thống kê {#janitor_age_out_stats .unnumbered}
### Các mẹo khác {.unnumbered}
## **dplyr** package
### Lấy số lượng {.unnumbered}
### Hiện tất cả các cấp độ {.unnumbered}
### Tỷ lệ {#tbl_dplyr_prop .unnumbered}
### Vẽ biểu đồ {.unnumbered}
### Tổng hợp thống kê {.unnumbered}
### Thống kê có điều kiện {.unnumbered}
### Gắn với nhau {.unnumbered}
#### Bách phân vị {.unnumbered}
### Tóm tắt dữ liệu tổng hợp {.unnumbered}
### `across()` trên nhiều cột {.unnumbered}
### Xoay trục ngang (Pivot wider) {#tbls_pivot_wider .unnumbered}
### Tổng các hàng {#tbl_dplyr_totals .unnumbered}
#### **janitor**'s `adorn_totals()` {.unnumbered}
#### `summarise()` trên dữ liệu "tổng" rồi sau đó `bind_rows()` {.unnumbered}
## **gtsummary** package {#tbl_gt}
### Bảng tổng hợp {.unnumbered}
### Các điều chỉnh {.unnumbered}
### Thống kê nhiều dòng cho các biến liên tục {.unnumbered}
## **base** R
### Tỷ lệ {.unnumbered}
### Tổng {.unnumbered}
### Chuyển đổi thành data frame {.unnumbered}
## Nguồn

<!--chapter:end:new_pages/tables_descriptive.Rmd-->


# Các kiểm định thống kê cơ bản {#stat-tests}

Placeholder


## Các bước chuẩn bị {  }
### Gọi các packages {.unnumbered}
### Nhập số liệu {.unnumbered}
## Các kiểm định trong **base** R {}
### Kiểm định t {.unnumbered} 
### Kiểm định Shapiro-Wilk {.unnumbered}  
### Kiểm định tổng thứ hạng Wilcoxon {.unnumbered}
### Kiểm định Kruskal-Wallis {.unnumbered}
### Kiểm định Chi bình phương {.unnumbered} 
## **rstatix** package {}
### Tóm tắt thống kê {.unnumbered}  
### Kiểm định t {.unnumbered}  
### Kiểm định Shapiro-Wilk {.unnumbered}  
### Kiểm định tổng thứ hạng Wilcoxon {.unnumbered}  
### Kiểm định Kruskal-Wallis {.unnumbered}  
### Kiểm định Chi bình phương {.unnumbered}  
## `gtsummary` package {#stats_gt}
### Kiểm định Chi bình phương {.unnumbered}
### Kiểm định t {.unnumbered} 
### Kiểm định tổng thứ hạng Wilcoxon {.unnumbered}
### Kiểm định Kruskal-wallis {.unnumbered}
## Tương quan 
## Nguồn {  }

<!--chapter:end:new_pages/stat_tests.Rmd-->


# Hồi quy đơn và đa biến {#regression}

Placeholder


## Chuẩn bị
### Gọi packages {.unnumbered}
### Nhập số liệu {.unnumbered}
### Làm sạch số liệu {.unnumbered}
#### Lưu trữ các biến giải thích {.unnumbered}
#### Chuyển đổi sang số 1 và số 0 {.unnumbered}
#### Loại bỏ các hàng có giá trị missing {.unnumbered}
## Phân tích đơn biến
### **base** R {.unnumbered}
#### Hồi quy tuyến tính {.unnumbered}
#### Hồi quy Logistic {.unnumbered}
#### Phân tích đơn biến sử dụng `glm()` {.unnumbered}
#### In kết quả {.unnumbered}
#### Vòng lặp cho nhiều mô hình đơn biến {.unnumbered}
### **gtsummary** package {#reg_gt_uni .unnumbered}
## Phân tích phân tầng
## Phân tích đa biến
### Thực hiện phân tích đa biến {.unnumbered}
#### Xây dựng mô hình {.unnumbered}
### Gộp kết quả phân tích đơn biến và đa biến {.unnumbered}
#### Gộp bằng package **gtsummary** {.unnumbered}
#### Gộp bằng package **dplyr** {.unnumbered}
## Biểu đồ Forest plot
### **ggplot2** package {.unnumbered}
### **easystats** packages {.unnumbered}
## Nguồn

<!--chapter:end:new_pages/regression.Rmd-->


# Dữ liệu Missing {#missing-data}

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Convert missing on import {.unnumbered}  
## Missing values in R { }
### `NA` {.unnumbered}  
### Versions of `NA` {.unnumbered}  
### `NULL` {.unnumbered}  
### `NaN` {.unnumbered}  
### `Inf` {.unnumbered}  
### Examples {.unnumbered}  
## Useful functions { }
### `is.na()` and `!is.na()` {.unnumbered}  
### `na.omit()` {.unnumbered}  
### `drop_na()` {.unnumbered}  
### `na.rm = TRUE` {.unnumbered}  
## Assess missingness in a data frame { }
### Quantifying missingness {.unnumbered}
### Visualizing missingness {.unnumbered}  
### Explore and visualize missingness relationships {.unnumbered} 
### "Shadow" columns {.unnumbered}
## Using data with missing values  
### Filter out rows with missing values {.unnumbered}
### Handling `NA` in `ggplot()` {.unnumbered}
### `NA` in factors {.unnumbered}
## Imputation { }
### Types of missing data {.unnumbered}
### Useful packages {.unnumbered}
### Mean Imputation {.unnumbered}
### Regression imputation {.unnumbered}
### LOCF and BOCF {.unnumbered}
### Multiple Imputation {.unnumbered}
## Resources { }

<!--chapter:end:new_pages/missing_data.Rmd-->


# Tỷ suất chuẩn hóa {#standardization}  

Placeholder


## Tổng quan  
## Chuẩn bị {  }
### Gọi packages {.unnumbered}
### Tải số liệu dân số {.unnumbered}  
### Tải số liệu tử vong {.unnumbered}  
### Làm sạch số liệu dân số và tử vong {.unnumbered}  
### Tải dân số tham chiếu {.unnumbered}  
### Làm sach dân số tham chiếu {.unnumbered}
### Tạo bộ số liệu với dân số chuẩn {#standard_all .unnumbered}  
## Package **dsr** {  }
### Tỷ suất chuẩn hóa {.unnumbered}
### Tỷ số của các tỷ suất chuẩn hóa {.unnumbered}
### Khác biệt của các tỷ suất chuẩn hóa {.unnumbered}
## Package **PHEindicatormethods** {#standard_phe  }
### Tỷ suất chuẩn hóa trực tiếp {.unnumbered}
### Tỷ suất chuẩn hóa gián tiếp {#standard_indirect .unnumbered}
## Tài nguyên học liệu {  }

<!--chapter:end:new_pages/standardization.Rmd-->

# Đường trung bình động {#moving-average}

```{r, out.width=c("100%"), echo=F}
knitr::include_graphics(here::here("images", "moving_avg_epicurve.png"))
```

Chương này bao gồm hai phương pháp tính toán và biểu diễn đường trung bình động:

1)  Tính toán với package **slider**\
2)  Tính toán *bên trong* lệnh `ggplot()` với package **tidyquant**

<!-- ======================================================= -->

## Chuẩn bị

### Gọi package {.unnumbered}

Đoạn code này hiển thị những package cần tải cho các phân tích. Trong sổ tay này, chúng tôi nhấn mạnh đến hàm `p_load()` từ **pacman**, hàm sẽ cài đặt package nếu cần *và* gọi nó ra để sử dụng. Bạn cũng có thể gọi các package đã cài đặt với `library()` từ **base** R. Xem chương [R cơ bản] để có thêm thông tin về các R package.

```{r}
pacman::p_load(
  tidyverse,      # for data management and viz
  slider,         # for calculating moving averages
  tidyquant       # for calculating moving averages within ggplot
)
```

### Nhập dữ liệu {.unnumbered}

Chúng ta nhập các trường hợp trong linelist đã được làm sạch từ một vụ dịch Ebola mô phỏng. Nếu bạn muốn theo dõi, [bấm để tải xuống linelist "đã được làm sạch"](https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds) (tệp .rds). Nhập dữ liệu với hàm `import()` từ package **rio** (hàm này xử lý nhiều loại tệp như .xlsx, .csv, .rds - xem chương [Nhập xuất dữ liệu] để biết thêm chi tiết).

```{r, echo=F}
# import the linelist into R
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))
```

```{r, eval=F}
# import the linelist
linelist <- import("linelist_cleaned.xlsx")
```

50 hàng đầu tiên của linelist được hiển thị dưới đây.

```{r, message=FALSE, echo=F}
# display the linelist data as a table
DT::datatable(head(linelist, 50), rownames = FALSE, filter="top", options = list(pageLength = 5, scrollX=T), class = 'white-space: nowrap' )
```

<!-- ======================================================= -->

## Tính toán với **slider**

**Sử dụng cách tiếp cận này để tính toán đường trung bình động trong một data frame trước khi vẽ biểu đồ.**

Package **slider** cung cấp một số hàm tạo "cửa sổ trượt" giúp tính toán trung bình động, tổng tích lũy, hồi quy động (rolling regression), v.v. Nó coi data frame như một vectơ của các hàng, cho phép lặp lại hàng qua một data frame.

Dưới đây là một số hàm phổ biến:

-   `slide_dbl()` - lặp qua một cột dạng *số* (từ "\_dbl") để thực hiện thao tác sử dụng cửa sổ trượt

    -   `slide_sum()` - hàm tắt tính tổng động (rolling sum) cho `slide_dbl()`\
    -   `slide_mean()` - hàm tắt tính trung bình động (rolling average) cho `slide_dbl()`

-   `slide_index_dbl()` - áp dụng cửa sổ cuộn trên một cột dạng số bằng cách sử dụng một cột riêng biệt để *lập chỉ mục* cửa sổ tiến trình (hữu ích nếu cuộn theo ngày mà một số ngày bị thiếu)

    -   `slide_index_sum()` - hàm tắt tính tổng động với chỉ mục\
    -   `slide_index_mean()` - hàm tắt tính trung bình động với chỉ mục

Package **slider** có nhiều hàm khác được đề cập đến trong phần Tài nguyên học liệu của chương này. Ở đây, chúng tôi sẽ đề cập ngắn gọn đến những điểm thông dụng nhất.

**Những đối số chính**

-   `.x`, đối số đầu tiên theo mặc định, là vectơ để lặp lại và để áp dụng hàm\

-   `.i =` cho các phiên bản "chỉ mục (index)" của hàm **slider** - cung cấp một cột để "lập chỉ mục" khi cuộn (xem phần [dưới đây](#roll_index))\

-   `.f =`, đối số thứ hai theo mặc định, có thể dùng theo một trong hai cách:

    -   Một hàm, được viết không có dấu ngoặc đơn, như `mean` hoặc\
    -   Một công thức, mà sẽ được chuyển đổi thành một hàm. Ví dụ `~ .x - mean(.x)` sẽ trả về kết quả của giá trị hiện tại trừ đi giá trị trung bình của cửa sổ giá trị

-   Để biết thêm chi tiết xem [tài liệu tham khảo](https://davisvaughan.github.io/slider/reference/slide.html) này

**Kích thước cửa sổ**

Xác định kích thước của cửa sổ bằng cách sử dụng một trong hai đối số `.before`, `.after`, hoặc cả hai đối số:

-   `.before =` - Cung cấp một số nguyên\
-   `.after =` - Cung cấp một số nguyên\
-   `.complete =` - Đặt giá trị này thành `TRUE` nếu bạn chỉ muốn tính toán được thực hiện trên các cửa sổ hoàn chỉnh

Ví dụ: Để có cửa sổ 7 ngày liên tục bao gồm giá trị hiện tại và sáu giá trị trước đó, hãy sử dụng `.before = 6`. Để có cửa sổ "trung tâm", hãy cung cấp cùng một giá trị số cho cả `.before =` và `.after =`.

Theo mặc định, `.complete =` sẽ nhận giá trị FALSE nên nếu cửa sổ hoàn chỉnh của các hàng không tồn tại, các hàm sẽ sử dụng các hàng sẵn có để thực hiện phép tính. Thiết lập giá trị thành TRUE giúp hạn chế việc các phép tính chỉ được thực hiện trên các cửa sổ hoàn chỉnh.

**Mở rộng cửa sổ**

Để có các tính toán *tích lũy*, hãy thiết lập đối số `.before =` thành `Inf`. Điều này giúp tiến hành tính toán cả trên giá trị hiện tại và tất cả các giá trị trước đó.

### Cuộn theo ngày {#roll_index .unnumbered}

Trường hợp sử dụng có khả năng xảy ra nhất của tính toán biến động trong dịch tễ học ứng dụng là kiểm tra một số liệu *theo thời gian*. Ví dụ: đo lường động các ca mới mắc, dựa trên số lượng trường hợp hàng ngày.

Nếu bạn có dữ liệu chuỗi thời gian đã được làm sạch với đủ giá trị cho tất cả các ngày, bạn có thể sử dụng hàm `slide_dbl()`, như đã được trình bày trong chương [Chuỗi thời gian và phát hiện ổ dịch](#timeseries_moving).

Tuy nhiên, trong nhiều trường hợp dịch tễ học ứng dụng, bạn có thể gặp những ngày trống trong dữ liệu của mình, những ngày mà không có sự kiện nào được ghi lại. Trong những trường hợp này, tốt nhất là sử dụng các phiên bản "chỉ mục" của các hàm **slider**.

### Dữ liệu được lập chỉ mục {.unnumbered}

Dưới đây, chúng tôi trình bày một ví dụ sử dụng `slide_index_dbl()` đối với các trường hợp của bộ dữ liệu linelist. Giả sử rằng mục tiêu của chúng ta là tính toán tỷ lệ mới mắc liên tục trong 7 ngày - tính tổng các trường hợp bằng cách sử dụng cửa sổ 7 ngày luân phiên. Nếu bạn đang tìm kiếm ví dụ về trung bình động, hãy xem phần bên dưới về [cuộn theo nhóm](#roll_slider_group).

Để bắt đầu, bộ dữ liệu `daily_counts` được tạo ra để phản ánh số lượng ca mắc hàng ngày từ `linelist`, như đã được tính toán với hàm `count()` trong **dplyr**.

```{r}
# make dataset of daily counts
daily_counts <- linelist %>% 
  count(date_hospitalisation, name = "new_cases")
```

Dưới đây là data frame `daily_counts` - bao gồm `nrow(daily_counts)` hàng, mỗi hàng đại diện cho một ngày, nhưng đặc biệt trong giai đoạn đầu của dịch, *có một số ngày không xuất hiện (không có ca mắc nào được tiếp nhận vào những ngày đó)*.

```{r, echo=F}
DT::datatable(daily_counts, rownames = FALSE, options = list(pageLength = 6, scrollX=T) )
```

Điều quan trọng là phải nhận ra rằng một hàm cuộn tiêu chuẩn (như `slide_dbl()` sẽ sử dụng cửa sổ của 7 *hàng*, không phải 7 *ngày*. Vì vậy, nếu có bất kỳ ngày nào trống, một số cửa sổ sẽ thực sự kéo dài hơn 7 ngày theo lịch!

Một cửa sổ động "thông minh" có thể được tạo với hàm `slide_index_dbl()`. "Chỉ mục" có nghĩa là hàm sử dụng một *cột riêng biệt* làm "chỉ mục" cho cửa sổ động. Cửa sổ đó không chỉ đơn giản dựa trên các hàng của data frame.

Nếu cột chỉ mục là ngày, bạn có thêm khả năng xác định phạm vi cửa sổ cho `.before =` và/hoặc `.after =` theo đơn vị `days()` và `months()` của **lubridate**. Nếu bạn thực hiện những điều này, hàm sẽ bao gồm những ngày trống trong cửa sổ như thể chúng ở đó (dưới dạng giá trị `NA`).

Hãy đưa ra một so sánh. Dưới đây, chúng tôi tính toán số trường hợp mới mắc biến động trong 7 ngày với các cửa sổ thông thường và được lập chỉ mục.

```{r}
rolling <- daily_counts %>% 
  mutate(                                # create new columns
    # Using slide_dbl()
    ###################
    reg_7day = slide_dbl(
      new_cases,                         # calculate on new_cases
      .f = ~sum(.x, na.rm = T),          # function is sum() with missing values removed
      .before = 6),                      # window is the ROW and 6 prior ROWS
    
    # Using slide_index_dbl()
    #########################
    indexed_7day = slide_index_dbl(
        new_cases,                       # calculate on new_cases
        .i = date_hospitalisation,       # indexed with date_onset 
        .f = ~sum(.x, na.rm = TRUE),     # function is sum() with missing values removed
        .before = days(6))               # window is the DAY and 6 prior DAYS
    )

```

Quan sát trong cột thông thường cho 7 hàng đầu tiên, cách số lượng ca mắc tăng đều đặn *mặc dù các hàng không cách nhau 7 ngày*! Cột "được lập chỉ mục" liền kề tính cho những ngày lịch trống này, vì vậy tổng 7 ngày của nó thấp hơn nhiều, ít nhất là khi khoảng thời gian các ca mắc cách nhau xa hơn trong thời kỳ dịch bệnh này.

```{r, echo=F}
DT::datatable(rolling, rownames = FALSE, options = list(pageLength = 12, scrollX=T) )
```

Bây giờ bạn có thể vẽ biểu đồ những dữ liệu này bằng cách sử dụng `ggplot()`:

```{r}
ggplot(data = rolling)+
  geom_line(mapping = aes(x = date_hospitalisation, y = indexed_7day), size = 1)
```

<!-- ### Biến động theo tháng {.unnumbered} -->

<!-- Nếu bạn muốn tính toán thống kê theo tháng (ví dụ: tổng, trung bình, max), bạn có thể thực hiện điều này với **dplyr** như đã được mô tả trong chương [Nhóm dữ liệu]. Chỉ cần tạo cột "tháng", nhóm dữ liệu và chạy các phép tính của bạn với `summarise()`. -->

<!-- Tuy nhiên, nếu bạn muốn tính toán thống kê động trong vài tháng (ví dụ: cửa sổ động 2 tháng), bạn có thể sử dụng hàm `slide_period()` từ **slider**. -->

<!-- ```{r} -->
<!-- monthly_mean = function(data){ -->
<!--   summarise(data, mean = mean(new_cases, na.rm=T)) -->
<!-- } -->
<!-- linelist %>% -->
<!--   count(date_hospitalisation, name = "new_cases") %>% -->
<!--   mutate( -->
<!--     slide_period_dfr( -->
<!--       new_cases,  -->
<!--       .i = date_hospitalisation, -->
<!--       .period = "month", -->
<!--       .f = monthly_mean))  #~mean(.x, na.rm=T))) -->
<!--      #values_col = new_cases, -->
<!--       #index_col = date_hospitalisation -->
<!--     )) -->

<!-- ``` -->

### Biến động theo nhóm {.unnumbered}

Nếu bạn nhóm dữ liệu của mình trước khi sử dụng hàm **slider**, các cửa sổ trượt sẽ được áp dụng theo nhóm. Hãy cẩn thận để sắp xếp các hàng của bạn với thứ tự mong muốn *theo nhóm*.

Mỗi khi một nhóm mới được tạo, cửa sổ trượt sẽ bắt đầu lại. Do đó, một điều cần lưu ý là nếu dữ liệu của bạn được nhóm lại và bạn đã thiết lập `.complete = TRUE`, bạn sẽ có các giá trị trống ở mỗi lần dịch chuyển giữa các nhóm. Khi hàm di chuyển xuống dưới qua các hàng, mọi dịch chuyển trong cột được nhóm sẽ bắt đầu lại việc cộng dồn kích thước cửa sổ tối thiểu để cho phép tính toán.

Xem chương [Nhóm dữ liệu] trong sổ tay này để biết thêm chi tiết về nhóm dữ liệu.

Dưới đây, chúng tôi đếm các ca mắc trong linelist theo ngày *và* theo bệnh viện. Sau đó, chúng tôi sắp xếp các hàng theo thứ tự tăng dần, thứ tự đầu tiên theo bệnh viện và sau đó là theo ngày. Tiếp theo, chúng tôi đặt `group_by()`. Cuối cùng, chúng tôi có thể tạo trung bình động mới của mình.

```{r}
grouped_roll <- linelist %>%
     
  count(hospital, date_hospitalisation, name = "new_cases") %>% 
     
  arrange(hospital, date_hospitalisation) %>%   # arrange rows by hospital and then by date
     
  group_by(hospital) %>%              # group by hospital 
     
  mutate(                             # rolling average  
    mean_7day_hosp = slide_index_dbl(
      .x = new_cases,                 # the count of cases per hospital-day
      .i = date_hospitalisation,      # index on date of admission
      .f = mean,                      # use mean()                  
      .before = days(6)               # use the day and the 6 days prior
      )
  )

```

Đây là bộ dữ liệu mới:

```{r, echo=F}
DT::datatable(grouped_roll, rownames = FALSE, options = list(pageLength = 12, scrollX=T) )
```

Bây giờ chúng ta có thể vẽ các đường trung bình động, hiển thị dữ liệu theo nhóm bằng cách chỉ định `~ hospital` tới `facet_wrap()` trong `ggplot()`. Để giải trí, chúng tôi vẽ hai biểu đồ - một biểu đồ cột `geom_col()` thể hiện số lượng ca mắc hàng ngày và một biểu đồ đường `geom_line()` thể hiện đường trung bình động của 7 ngày.

```{r, warning=F, message=F}
ggplot(data = grouped_roll)+
  geom_col(                       # plot daly case counts as grey bars
    mapping = aes(
      x = date_hospitalisation,
      y = new_cases),
    fill = "grey",
    width = 1)+
  geom_line(                      # plot rolling average as line colored by hospital
    mapping = aes(
      x = date_hospitalisation,
      y = mean_7day_hosp,
      color = hospital),
    size = 1)+
  facet_wrap(~hospital, ncol = 2)+ # create mini-plots per hospital
  theme_classic()+                 # simplify background  
  theme(legend.position = "none")+ # remove legend
  labs(                            # add plot labels
    title = "7-day rolling average of daily case incidence",
    x = "Date of admission",
    y = "Case incidence")
```

[***NGUY HIỂM:*** Nếu bạn gặp lỗi cho biết *"slide() was deprecated in tsibble 0.9.0 and is now defunct. Please use slider::slide() instead."*, điều đó có nghĩa là hàm `slide()` từ package **tsibble** đang đè lên hàm `slide()` từ package **slider**. Khắc phục lỗi này bằng cách cụ thể tên package trong lệnh, ví dụ `slider::slide_dbl()`.]{style="color: red;"}

<!-- Bạn có thể nhóm dữ liệu trước khi sử dụng hàm **slider**. Ví dụ: nếu bạn muốn tính tổng động trong 7 ngày tương tự như trên, nhưng theo bệnh viện, trên trung bình động thời gian chậm trễ từ khi bắt đầu có triệu chứng cho đến khi nhập viện (cột `days_onset_hosp`). -->

<!-- Bạn có thể nhóm dữ liệu theo tháng khởi phát triệu chứng bằng cách sử dụng `floor_date()` của **lubridate** như đã được mô tả trong chương [Nhóm dữ liệu]. Sau đó, sử dụng `slide_index_dbl()` như trên nhưng thiết lập phạm vi cửa sổ của bạn bằng cách sử dụng `months()` (cũng từ **lubridate**). -->

<!-- Nếu bạn muốn tính trung bình động theo *tháng*, bạn có thể sử dụng **lubridate** để nhóm dữ liệu theo tháng và sau đó áp dụng `slide_index_dbl()` như được trình bày dưới đây cho giá trị trung bình động trong ba tháng: -->

<!-- ```{r} -->
<!-- months_delay <- linelist %>% -->
<!--   arrange(date_onset) %>%    # drop rows missing date of onset -->

<!--   group_by(hospital) %>%  -->

<!--   #group_by(month_onset = floor_date(date_onset, "month")) %>% # create and group by month of onset -->

<!--   mutate( -->
<!--      delay_7d = slide_index_dbl( -->
<!--       days_onset_hosp,                  # calculate avg based on value in new_cases column -->
<!--       .i = date_onset,                 # index column is date_onset, so non-present dates are included in 7day window -->
<!--       .f = ~mean(.x, na.rm = TRUE),     # function is mean() with missing values removed -->
<!--       .before = days(7)), -->

<!--      delay_month = slide_index_dbl( -->
<!--       days_onset_hosp,                  # calculate avg based on value in new_cases column -->
<!--       .i = date_onset,                 # index column is date_onset, so non-present dates are included in 7day window  -->
<!--       .f = ~mean(.x, na.rm = TRUE),     # function is mean() with missing values removed -->
<!--       .before = months(1)))               # window is the month and the prior month -->

<!-- # window is the month and the prior month -->

<!-- ``` -->

<!-- ```{r} -->
<!-- ggplot(data = months_delay, mapping = aes(x = month_onset))+ -->
<!--   geom_line(mapping = aes(y = )) -->
<!-- ``` -->

<!-- ======================================================= -->

## Tính toán với **tidyquant** trong `ggplot()`

Package **tidyquant** cung cấp một cách tiếp cận khác để tính toán đường trung bình động - lần này chính là từ *bên trong* lệnh `ggplot()`.

Dữ liệu `linelist` dưới đây được đếm theo ngày khởi phát và được vẽ dưới dạng một đường mờ (`alpha` \<1). Được phủ lên trên là một đường được tạo bằng hàm `geom_ma()` từ package **tidyquant**, với cửa sổ được thiết lập là 7 ngày (`n = 7`) với màu sắc và độ dày được chỉ định.

Theo mặc định, `geom_ma()` sử dụng một đường trung bình động đơn giản (`ma_fun = "SMA"`), tuy nhiên, hàm này cũng có thể sử dụng các loại đường trung bình khác, chẳng hạn như:

-   "EMA" - đường trung bình động lũy thừa (exponential moving average) (thêm trọng số cho các quan sát gần đây)\
-   "WMA" - đường trung bình động có trọng số (weighted moving average) (`wts` được sử dụng để đánh trọng số các quan sát trong đường trung bình động)\
-   Các loại đường trung bình động khác có thể được tìm thấy trong tài liệu về hàm

```{r}
linelist %>% 
  count(date_onset) %>%                 # count cases per day
  drop_na(date_onset) %>%               # remove cases missing onset date
  ggplot(aes(x = date_onset, y = n))+   # start ggplot
    geom_line(                          # plot raw values
      size = 1,
      alpha = 0.2                       # semi-transparent line
      )+             
    tidyquant::geom_ma(                 # plot moving average
      n = 7,           
      size = 1,
      color = "blue")+ 
  theme_minimal()                       # simple background
```

Xem [tài liệu](https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ04-charting-with-tidyquant.html) này để biết thêm chi tiết về các tùy chọn sẵn có trong **tidyquant**.

<!-- ## Hồi quy động -->

<!-- ```{r} -->
<!-- a <- linelist %>%  -->
<!--   separate(time_admission, into = c("hour", "minute"), sep = ":") %>%  -->

<!--   count(days_onset_hosp, hour) %>%  -->

<!--   mutate(reg_admit_hour = slide(., ~lm(days_onset_hosp ~ hour), .before = 3, .complete = T)) %>%  -->

<!--   mutate(coeff = reg_admit_hour[[1]]) -->

<!-- ggplot()+ -->
<!--   geom_point(aes(x = hour, y = days_onset_hosp)) -->

<!-- ``` -->

<!-- ```{r} -->
<!-- linelist %>% -->
<!--   mutate( -->
<!--   ) -->
<!-- ``` -->

<!-- ======================================================= -->

## Tài nguyên học liệu

Xem thông tin trực tuyến hữu ích về [vignette for the **slider** package](https://cran.r-project.org/web/packages/slider/vignettes/slider.html)

[Trang github](https://github.com/DavisVaughan/slider) về **Slider**

Một [vignette](https://davisvaughan.github.io/slider/articles/slider.html) **slider**

[tidyquant vignette](https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ04-charting-with-tidyquant.html)

Nếu tình huống sử dụng của bạn yêu cầu "bỏ qua" các ngày cuối tuần và thậm chí là những ngày lễ, bạn có thể quan tâm đến package **almanac**.
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/moving_average.Rmd-->


# Chuỗi thời gian và phát hiện ổ dịch {#time-series}  

Placeholder


## Overview {  }
## Preparation {  }
### Packages {.unnumbered}
### Load data {.unnumbered}
### Clean data {.unnumbered}
### Download climate data {.unnumbered} 
### Load climate data {.unnumbered}
## Time series data {  }
### Duplicates {.unnumbered}
### Missings {.unnumbered}
## Descriptive analysis {  }
### Moving averages {#timeseries_moving .unnumbered}
### Periodicity {.unnumbered}
### Decomposition {.unnumbered}
### Autocorrelation {.unnumbered}
## Fitting regressions {  }
### Fourier terms {.unnumbered}
### Negative binomial {.unnumbered}
### Residuals {.unnumbered}
## Relation of two time series {  }
### Merging datasets {.unnumbered}
### Descriptive analysis {.unnumbered}
### Lags and cross-correlation {.unnumbered}
### Negative binomial with two variables {.unnumbered}
#### Residuals {.unnumbered}
## Outbreak detection {  }
### **trending** package {.unnumbered}
#### Cut-off date { -}
#### Add rows {.unnumbered}
#### Fourier terms {.unnumbered}
#### Split data and fit regression {.unnumbered}
#### Prediction validation {.unnumbered}
### **surveillance** package {.unnumbered}
#### Farrington method {.unnumbered}
#### GLRNB method {.unnumbered}
## Interrupted timeseries {  }
## Resources {  }

<!--chapter:end:new_pages/time_series.Rmd-->


# Mô hình hóa dịch bệnh {#epidemic-models}  

Placeholder


## Overview {  }
## Preparation {  }
## Estimating R<sub>t</sub> {  }
### EpiNow2 vs. EpiEstim {.unnumbered}
### EpiNow2 {.unnumbered}
#### Estimating delay distributions {.unnumbered}
#### Running **EpiNow2** {.unnumbered}
#### Analysing outputs {.unnumbered}
### EpiEstim {.unnumbered}
#### Using serial interval estimates from the literature {.unnumbered}
#### Using serial interval estimates from the data {.unnumbered}
#### Specifying estimation time windows {.unnumbered}
#### Analysing outputs {.unnumbered}
## Projecting incidence {  }
### EpiNow2 {.unnumbered}
### projections {.unnumbered}
#### Using serial interval estimates from the literature {.unnumbered}
#### Using serial interval estimates from the data {.unnumbered}
#### Projecting incidence {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/epidemic_models.Rmd-->


# Truy vết tiếp xúc {#contact-tracing}

Placeholder


## Preparation
### Load packages {.unnumbered}  
### Import data {.unnumbered}
#### Case data {.unnumbered}  
#### Contacts data {.unnumbered}  
#### Follow-up data {.unnumbered}  
#### Relationships data {.unnumbered}  
## Descriptive analyses  
### Demographics {.unnumbered}  
#### Age and Gender of contacts {.unnumbered}  
### Contacts per case {.unnumbered}  
## Contact Follow Up  
### Data cleaning {.unnumbered}  
### Plot over time {.unnumbered}  
### Daily individual tracking  {.unnumbered}  
### Analyse by group {.unnumbered}  
## KPI Tables  
## Transmission Matrices  
## Resources  

<!--chapter:end:new_pages/contact_tracing.Rmd-->


# Phân tích khảo sát {#survey-analysis}  

Placeholder


## Overview {  }
## Preparation {  }
### Packages {.unnumbered}
### Load data {.unnumbered}
### Clean data {.unnumbered}
## Survey data {  }
## Observation time {  }
## Weighting {  }
## Survey design objects {  }
### **Survey** package  
### **Srvyr** package  
## Descriptive analysis {  }
### Sampling bias 
### Demographic pyramids 
### Alluvial/sankey diagram
## Weighted proportions {  }
### **Survey** package 
### **Srvyr** package 
### **Sitrep** package 
### **Gtsummary** package
## Weighted ratios {  }
### **Survey** package 
### **Srvyr** package 
## Resources {  }

<!--chapter:end:new_pages/survey_analysis.Rmd-->


# Phân tích sống còn {#survival-analysis}  

Placeholder


## Tổng quan {}
## Chuẩn bị {  }
### Gọi packages {.unnumbered}  
### Nhập bộ số liệu {.unnumbered}  
### Quản lý và chuyển đổi số liệu {.unnumbered}
## Cơ bản về phân tích sống còn {}
### Tạo ra đối tượng kiểu surv {.unnumbered}
### Thực hiện các phân tích ban đầu {.unnumbered}
### Mối nguy tích lũy {.unnumbered}  
### Vẽ đường cong Kaplan-Meir  {.unnumbered}
## So sánh các đường cong sống sót 
### Kiểm định Log rank {.unnumbered}
## Phân tích bằng hồi quy Cox {}
### Fitting một mô hình Cox {.unnumbered}
### Biểu đồ Forest plot {.unnumbered}
## Các hiệp biến phụ thuộc vào thời gian trong mô hình sống còn {}
### Thiết lập hiệp biến phụ thuộc vào thời gian {.unnumbered} 
#### Thêm mã nhận dạng bệnh nhân {.unnumbered}  
#### Mở rộng hàng của các bệnh nhân {.unnumbered}  
### Hồi quy Cox với hiệp biến phụ thuộc vào thời gian {.unnumbered} 
## Tài nguyên học liệu {  }

<!--chapter:end:new_pages/survival_analysis.Rmd-->


# GIS cơ bản {#gis}

Placeholder


## Tổng quan
## Các thuật ngữ chính
### Phần mềm GIS {.unnumbered}
### Dữ liệu không gian {.unnumbered}
### Trực quan hóa dữ liệu không gian {.unnumbered}
## Bắt đầu với GIS
### Các loại bản đồ để trực quan hóa dữ liệu {.unnumbered}
## Chuẩn bị
### Gọi package {.unnumbered}
### Dữ liệu trường hợp mẫu {.unnumbered}
### Shapefiles phân cấp hành chính {.unnumbered}
### Dữ liệu dân số {.unnumbered}
### Các cơ sở y tế {.unnumbered}
## Vẽ đồ thị tọa độ
## Phép nối theo không gian
### Điểm trong đa giác {.unnumbered}
### Hàng xóm gần nhất {.unnumbered}
### Vùng đệm {.unnumbered}
### Các hàm nối theo không gian khác {.unnumbered}
## Bản đồ Choropleth
## Vẽ bản đồ với ggplot2
## Bản đồ cơ sở
### OpenStreetMap {.unnumbered}
## Bản đồ nhiệt mật độ đường viền 
### Bản đồ nhiệt chuỗi thời gian {.unnumbered}
## Thống kê không gian
### Mối quan hệ không gian {.unnumbered}
### Tự tương quan không gian {.unnumbered}
### Hồi quy không gian {.unnumbered}
## Tài nguyên học liệu

<!--chapter:end:new_pages/gis.Rmd-->

# (PART) Trực quan hóa dữ liệu {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_data_viz.Rmd-->


# Trình bày bảng {#tables-presentation}  

Placeholder


## Chuẩn bị {  }
### Gọi packages {.unnumbered} 
### Nhập dữ liệu {.unnumbered}  
### Chuẩn bị bảng {.unnumbered}  
## Cơ bản về flextable {  }
### Tạo một flextable {.unnumbered}  
### Độ rộng cột {.unnumbered}
### Tiêu đề cột {.unnumbered}
### Đường viền và nền {.unnumbered}  
### Phông chữ và căn chỉnh {.unnumbered}
### Hợp nhất ô {.unnumbered}  
### Màu nền {.unnumbered}
## Định dạng có điều kiện {  }
## Kết hợp tất cả các code {#tbl_pres_all}  
## Lưu bảng của bạn {  }
### Lưu bảng đơn {.unnumbered}
### In bảng trong R markdown {.unnumbered}  
## Nguồn {  }

<!--chapter:end:new_pages/tables_presentation.Rmd-->


# ggplot cơ bản {#ggplot-basics}

Placeholder


## Chuẩn bị
### Gọi packages {.unnumbered}
### Nhập dữ liệu {.unnumbered}
### Làm sạch chung {.unnumbered}
### Xoay trục dài hơn {.unnumbered}
## Các khái niệm cơ bản của ggplot
## `ggplot()`
## Geoms
## Chọn dữ liệu cho biểu đồ {#ggplot_basics_mapping}
### Thẩm mỹ đồ thị {.unnumbered}
### Gán một giá trị tĩnh {.unnumbered}
### Vẽ theo tỷ lệ giá trị của cột {.unnumbered}
### Thực hiện phép gán ở đâu {#ggplot_basics_map_loc .unnumbered}
### Nhóm {#ggplotgroups .unnumbered}
## Facets / Chia nhỏ biểu đồ {#ggplot_basics_facet}
### `facet_wrap()` {.unnumbered}
### `facet_grid()` {.unnumbered}
### Giới hạn trục tự do hoặc cố định {.unnumbered}
### Trật tự thức bậc của Factor trong facets {.unnumbered}
## Lưu trữ biểu đồ
### Lưu biểu đồ {.unnumbered}
### Chỉnh sửa biều đồ đã lưu {.unnumbered}
### Xuất biểu đồ {.unnumbered}
## Nhãn
## Chủ đề {#ggplot_basics_themes}
### Chủ đề hoàn chỉnh {.unnumbered}
### Tùy chỉnh chủ đề {.unnumbered}
## Màu sắc
## Piping tới **ggplot2**
## Vẽ biểu đồ dữ liệu liên tục
### Histograms {.unnumbered}
### Box plots {.unnumbered}
### Violin, jitter, và sina plots {.unnumbered}
### Hai biến liên tục {.unnumbered}
### Ba biến liên tục {.unnumbered}
## Vẽ biểu đồ cho biến danh mục
### Chuẩn bị {.unnumbered}
#### Cấu trúc dữ liệu {.unnumbered}
#### Kiểu của cột và thứ tự các giá trị {.unnumbered}
### `geom_bar()` {#ggplot_basics_bars .unnumbered}
### `geom_col()` {.unnumbered}
### `geom_histogram()` {.unnumbered}
## Tài nguyên học liệu

<!--chapter:end:new_pages/ggplot_basics.Rmd-->


# Các tips với ggplot {#ggplot-tips}

Placeholder


## Chuẩn bị {}
### Gọi packages {.unnumbered}
### Nhập dữ liệu {.unnumbered}  
## Thang đo đối với màu sắc, tô màu, trục, v.v. {#ggplot_tips_colors}
### Phối màu
### Thang đo {#ggplot_tips_scales .unnumbered}  
### Các đối số của hàm Scale {.unnumbered}  
### Điều chỉnh thủ công {.unnumbered}  
### Thang đo liên tục trên trục {.unnumbered}  
#### Hiển thị phần trăm {.unnumbered}  
#### Thang đo Log {.unnumbered}  
### Thang đo Gradient {.unnumbered}  
### Bảng màu {.unnumbered}  
#### Colorbrewer và Viridis {.unnumbered}
## Thay đổi thứ tự của biến rời rạc {}  
#### **ggthemr** {.unnnumbered}  
## Đường đồng mức 
## Phân phối biên 
## Dán nhãn thông minh {}  
## Trục thời gian {}
## Làm nổi bật {}
## Vẽ nhiều tập dữ liệu  
## Ghép các biểu đồ {}
### `plot_grid()` {.unnumbered}
### Ghép các chú giải {.unnumbered}  
### Thêm biểu đồ phụ {.unnumbered} 
## Trục kép {}
## Packages giúp đỡ bạn  
### Giao diện kéo thả **ggplot2** với package **equisse**  {.unnumbered}
## Tổng hợp  
### Hiển thị số {.unnumbered}  
## Nguồn

<!--chapter:end:new_pages/ggplot_tips.Rmd-->


# Đường cong dịch bệnh {#epicurves}  

Placeholder


## Preparation
### Packages {.unnumbered}  
### Import data {.unnumbered}
### Set parameters {.unnumbered}
### Verify dates {.unnumbered}
## Epicurves with **incidence2** package { }
### Simple example {.unnumbered}
### Change time interval of case aggregation {.unnumbered}  
### Groups {.unnumbered}
### Filtered data {.unnumbered}
### Aggregated counts {.unnumbered}
### Facets/small multiples {.unnumbered}  
### Modifications with `plot()` {.unnumbered} 
### Modifications with ggplot2 {.unnumbered}
### Change colors  {.unnumbered}  
#### Specify a palette {.unnumbered}  
#### Specify manually {.unnumbered}  
### Adjust level order {.unnumbered}  
### Vertical gridlines {.unnumbered}  
### Cumulative incidence {.unnumbered}  
### Rolling average  {.unnumbered}
## Epicurves with ggplot2 { }
### Specify case bins {.unnumbered}  
### Weekly epicurve example {.unnumbered}  
#### Sunday weeks {.unnumbered}  
### Group/color by value {.unnumbered}
### Adjust colors {.unnumbered}  
### Adjust level order {.unnumbered}  
### Adjust legend {.unnumbered}
### Bars side-by-side {.unnumbered}  
### Axis limits {.unnumbered}  
### Date-axis labels/gridlines {.unnumbered} 
#### Demonstrations {.unnumbered}
### Aggregated data {.unnumbered} 
#### Plotting daily counts {.unnumbered}  
#### Plotting weekly counts {.unnumbered}
### Moving averages {.unnumbered}
### Faceting/small-multiples {.unnumbered}
#### Total epidemic in facet background {.unnumbered}
#### One facet with data {.unnumbered}  
## Tentative data  
### Using `annotate()` {.unnumbered}
### Bars color {.unnumbered}  
## Multi-level date labels  
## Dual-axis { }  
## Cumulative Incidence {}
## Resources { }

<!--chapter:end:new_pages/epicurves.Rmd-->


# Tháp dân số và thang đo Likert {#age-pyramid}  

Placeholder


## Chuẩn bị {}
### Gọi package {.unnumbered}
### Nhập dữ liệu {.unnumbered}  
### Làm sạch {.unnumbered}  
## **apyramid** package {}
### Dữ liệu Linelist {.unnumbered}  
#### Giá trị Missing {.unnumbered}  
#### Tỷ lệ, màu sắc, & thẩm mỹ {.unnumbered}  
### Dữ liệu được tổng hợp {.unnumbered}  
## `ggplot()` {#demo_pyr_gg}
### Chuẩn bị {.unnumbered}
### Xây dựng biểu đồ {.unnumbered} 
### So sánh với đường cơ sở  {.unnumbered} 
## Thang đo Likert {}
## Nguồn {}

<!--chapter:end:new_pages/age_pyramid.Rmd-->


# Biểu đồ nhiệt {#heatmaps}  

Placeholder


## Chuẩn bị { }
### Gọi packages {.unnumbered}  
## Ma trận lây truyền 
### Chuẩn bị dữ liệu {.unnumbered}  
#### Tạo data frame các trường hợp {.unnumbered} 
#### Tạo data frame nguồn lây nhiễm {.unnumbered}  
### Tạo biểu đồ nhiệt {.unnumbered}  
## Các chỉ số báo cáo theo thời gian { }
### Chuẩn bị dữ liệu {.unnumbered}
#### Tổng hợp và tóm tắt {.unnumbered}
### Tạo biểu đồ nhiệt {.unnumbered}
### Cơ bản {.unnumbered}  
### Làm sạch biểu đồ nhiệt {.unnumbered}
### Sắp xếp thứ tự trục y {.unnumbered}  
### Biểu diễn các giá trị {.unnumbered}  
## Nguồn { }

<!--chapter:end:new_pages/heatmaps.Rmd-->


# Sơ đồ và biểu đồ {#diagrams}  

Placeholder


## Chuẩn bị { }
### Gọi packages {.unnumbered}  
### Nhập dữ liệu {.unnumbered}  
## Sơ đồ flow { }
### Ví dụ đơn giản {.unnumbered} 
### Cú pháp  {.unnumbered}
### Ví dụ phức tạp  {.unnumbered}
### Kết quả đầu ra {.unnumbered}
### Đồ thị được tham số hóa {.unnumbered} 
## Sơ đồ Alluvial/Sankey { }
### Gọi packages {.unnumbered}  
### Vẽ đồ thị từ một tập dữ liệu {.unnumbered} 
## Chuỗi sự kiện trong thời gian { }
## Sơ đồ DAGs { }
## Tài nguyên học liệu { }

<!--chapter:end:new_pages/diagrams.Rmd-->


# Biểu đồ kết hợp {#combination-analysis}  

Placeholder


## Chuẩn bị {  }
### Gọi package {.unnumbered}
### Nhập dữ liệu {.unnumbered}  
### Định dạng lại giá trị {.unnumbered}  
## **ggupset** {  }
## `UpSetR` {  }
## Nguồn {  }

<!--chapter:end:new_pages/combination_analysis.Rmd-->


# Chuỗi lây nhiễm {#transmission-chains}

Placeholder


## Overview {  }
## Preparation {  }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Creating an epicontacts object {.unnumbered}
## Handling {  }
### Subsetting {.unnumbered}
### Accessing IDs {.unnumbered}
## Visualization {  }
### Basic plotting {.unnumbered}
#### Visualising node attributes {.unnumbered}
#### Visualising edge attributes {.unnumbered}
### Temporal axis {.unnumbered}
#### Specifying transmission tree shape {.unnumbered}
#### Saving plots and figures {.unnumbered}
### Timelines {.unnumbered}
## Analysis {  }
### Summarising {.unnumbered}
### Pairwise characteristics {.unnumbered}
### Identifying clusters {.unnumbered}
### Calculating degrees {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/transmission_chains.Rmd-->


# Cây phả hệ {#phylogenetic-trees}  

Placeholder


## Overview {}
## Preparation {}
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
### Clean and inspect {.unnumbered}  
## Simple tree visualization {}
### Different tree layouts {.unnumbered}  
### Simple tree plus sample data {.unnumbered}  
## Tree manipulation {}
### Zoom in {.unnumbered}  
### Collapsing branches {.unnumbered} 
### Subsetting a tree {.unnumbered} 
### Rotating nodes in a tree {.unnumbered} 
### Example subtree with sample data annotation {.unnumbered} 
## More complex trees: adding heatmaps of sample data {.unnumbered}
## Resources {}

<!--chapter:end:new_pages/phylogenetic_trees.Rmd-->


# Biểu đồ tương tác {#interactive-plots}  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}  
### Start with a `ggplot()` {.unnumbered}  
### Import data {.unnumbered}
## Plot with `ggplotly()` {  }
## Modifications {  }
### File size {.unnumbered}  
### Buttons {.unnumbered}  
## Heat tiles {  }
## Resources {  }

<!--chapter:end:new_pages/interactive_plots.Rmd-->

# (PART) Báo cáo và dashboards {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_reports_dashboards.Rmd-->


# Báo cáo với R Markdown {#rmarkdown}  

Placeholder


## Chuẩn bị {  }
## Bắt đầu {  }
### Cài đặt package rmarkdown  {.unnumbered}
### Bắt đầu một tệp Rmd mới {.unnumbered}
### Điều quan trọng cần phải biết {.unnumbered}
## Các cấu phần của R Markdown {  }
### YAML metadata {.unnumbered}
### Văn bản {.unnumbered}
#### Dòng mới {.unnumbered}  
#### Định dạng {.unnumbered}  
#### Màu sắc {.unnumbered}  
#### Tiêu đề và đầu mục {.unnumbered}  
#### Dấu đầu dòng và đánh số {.unnumbered}  
#### Chữ chú giải {.unnumbered}
### Đoạn Code {.unnumbered}
#### Code R trong văn bản {.unnumbered}  
### Ảnh {.unnumbered}  
### Bảng {.unnumbered}  
### Các phần được chia thẻ {.unnumbered}  
## Cấu trúc tệp {}
### Rmd khép kín {.unnumbered}  
#### Nguồn từ các tệp khác {.unnumbered}
### Runfile {.unnumbered}  
### Cấu trúc thư mục {.unnumbered}  
## Tạo tài liệu  
### Cách 1: Nút "Knit" {.unnumbered}  
### Cách 2: Lệnh `render()` {.unnumbered}
###  Cách 3: **reportfactory**  package {.unnumbered}  
## Báo cáo được tham số hóa {  }
### Cài đặt tham số {.unnumbered}
#### Cách 1: Đặt tham số trong YAML {.unnumbered}
#### Cách 2: Đặt tham số trong `render()` {.unnumbered}  
#### Cách 3:  Đặt tham số sử Giao diện Người dùng (GUI) {.unnumbered}  
### Ví dụ tham số hóa {.unnumbered} 
### Tham số hóa không có `params` {.unnumbered}
## Tạo vòng lặp nhiều báo cáo   {  }
## Mẫu  
### Tài liệu Word {.unnumbered}
### Tài liệu Powerpoint {.unnumbered}
### Tích hợp các mẫu vào YAML {.unnumbered}
### Định dạng tệp HTML {.unnumbered}
## Nội dung động 
### Bảng {.unnumbered}  
### Tiện ích HTML {.unnumbered}
## Tài nguyên {  }

<!--chapter:end:new_pages/rmarkdown.Rmd-->


# Tổ chức báo cáo định kỳ {#reportfactory}  

Placeholder


## Chuẩn bị
### Tải packages {.unnumbered}  
## Nhà máy mới  
## Tạo báo cáo  
## Biên soạn
### Biên soạn theo tên {.unnumbered}  
### Biên soạn theo số {.unnumbered}
### Biên soạn tất cả {.unnumbered}
### Biên soạn từ thư mục con {.unnumbered}  
### Tham số hóa {.unnumbered}
### Dùng "run-file" {.unnumbered}  
## Kết quả đầu ra 
## Mục khác  
### Knit {.unnumbered} 
### Scripts {.unnumbered}  
### Thêm {.unnumbered} 
## Tài nguyên {  }

<!--chapter:end:new_pages/reportfactory.Rmd-->


# Dashboards với R Markdown {#flexdashboard}

Placeholder


## Chuẩn bị  
### Gọi các packages {.unnumbered}  
### Nhập dữ liệu {.unnumbered}  
## Tạo R Markdown mới  
## Script  
### YAML {.unnumbered}  
### Đoạn Code {.unnumbered}  
### Văn bản tường thuật {.unnumbered}  
### Đầu mục {.unnumbered}  
## Thuộc tính mục  
## Bố cục {#layout}  
### Trang {.unnumbered}  
### Hướng {.unnumbered}  
### Tabs {.unnumbered} 
## Thêm nội dung  
### Chữ {.unnumbered}  
### Bảng {.unnumbered}  
### Đồ thị {.unnumbered}  
### Đồ thị tương tác {.unnumbered}  
### Tiện ích HTML {.unnumbered}
## Tổ chức Code 
## Shiny  
### Cài đặt {.unnumbered}  
### Ví dụ đã làm việc {.unnumbered}  
### Các ví dụ khác {.unnumbered}  
## Chia sẻ  
## Tài nguyên học liệu  

<!--chapter:end:new_pages/flexdashboard.Rmd-->


# Dashboards với Shiny {#shiny-basics}  

Placeholder


## Preparation  
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## The structure of a shiny app {  }
### Basic file structures {.unnumbered}  
### The server and the ui {.unnumbered}
### Before you start to build an app {.unnumbered}
## Building a UI 
## Loading data into our app
## Developing an app server
## Adding more functionality
### Adding static text {.unnumbered}  
### Adding a link {.unnumbered}
### Adding a download button {.unnumbered}
### Adding a facility selector {.unnumbered}  
### Adding another tab with a table {.unnumbered}
## Sharing shiny apps
## Further reading
## Recommended extension packages
## Recommended resources

<!--chapter:end:new_pages/shiny_basics.Rmd-->

# (PART) Tổng hợp {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_misc.Rmd-->


# Viết hàm {#writing-functions} 

Placeholder


## Chuẩn bị {  }
### Gọi packages {-}
### Nhập dữ liệu {-}
## Hàm  
## Tại sao chúng ta sử dụng hàm? 
## Cách viết hàm trong R
## Cấu trúc và cú pháp cơ bản
## Các ví dụ  
### Trả về các bảng tỷ lệ cho một số cột {.unnumbered}  
## Sử dụng **purrr**: viết các hàm với vòng lặp
### Sửa đổi kiểu biến trên nhiều cột trong một bộ số liệu {.unnumbered}  
### Vòng lặp tạo biểu đồ cho nhiều giá trị khác nhau của biến {.unnumbered}
### Vòng lặp tạo bảng cho nhiều giá trị khác nhau của biến {.unnumbered}
## Mẹo và thực hành tốt để các hàm hoạt động tốt
### Đặt tên và cú pháp {.unnumbered}
### Tên cột và lượng giá tính gọn gàng {.unnumbered}  
### Kiểm tra và xử lý lỗi {.unnumbered}
## Nguồn

<!--chapter:end:new_pages/writing_functions.Rmd-->


# Tương tác với thư mục làm việc {#directories}  

Placeholder


## Chuẩn bị  
### **fs** package {.unnumbered}  
### In thư mục dưới dạng cây biểu đồ dendrogram {.unnumbered}  
## Liệt kê các tập tin trong một thư mục 
## Thông tin tệp  
## Kiểm tra sự tồn tại  
### Đối tượng R {.unnumbered}  
### Thư mục {.unnumbered}  
### Tệp {.unnumbered}  
## Tạo mới  
### Thư mục {.unnumbered}  
### Tệp {.unnumbered}  
### Tạo nếu không tồn tại {.unnumbered}  
## Xóa
### Đối tượng R {.unnumbered}  
### Thư mục {.unnumbered}  
### Tệp {.unnumbered}  
## Chạy các tệp khác  
### `source()` {.unnumbered}  
### `render()` {.unnumbered}  
### Chạy các tệp trong một thư mục {.unnumbered}
### Nhập tệp vào một thư mục  {.unnumbered}
## **base** R  
## Nguồn {  }

<!--chapter:end:new_pages/directories.Rmd-->


# Version control với Git và Github {#collaboration}

Placeholder


## What is Git?
## Why use the combo Git and Github?
### This sounds complicated, I am not a programmer {-}
## Setup
### Install Git {.unnumbered}
### Install an interface (optional but recommended) {.unnumbered}
### Github account {.unnumbered}
## Vocabulary, concepts and basic functions
### Repository {.unnumbered}
### Commits {.unnumbered}
### Branches {.unnumbered}
### Local and remote repositories {.unnumbered}
## Get started: create a new repository
### Start-up files {.unnumbered}
### Create a new repository in Github {.unnumbered}
### Clone from a Github repository {.unnumbered}
#### In Rstudio {.unnumbered}
#### In Github Desktop {.unnumbered}
### New Github repo from existing R project {.unnumbered}
### What does it look like now? {.unnumbered}
#### In RStudio {-}
#### In Github Desktop {-}
## Git + Github workflow
### Process overview {.unnumbered}
## Create a new branch
### In Rstudio Git pane {.unnumbered}
### In Github Desktop {.unnumbered}
### In console {.unnumbered}
## Commit changes
### In Rstudio {.unnumbered}
### In Github Desktop {.unnumbered}
### In console {.unnumbered}
### Amend a previous commit {.unnumbered}
## Pull and push changes up to Github
#### In Rstudio {.unnumbered}
#### In Github Desktop {.unnumbered}
#### Console {.unnumbered}
### I want to pull but I have local work {.unnumbered}
## Merge branch into Main 
### Locally in Github Desktop {.unnumbered}
### In console {.unnumbered}
### In Github: submitting pull requests {.unnumbered}
### Resolving conflicts {.unnumbered}
### Delete your branch {.unnumbered}
#### Github + Rstudio
#### In Github Desktop
### Forking {.unnumbered}
## What we learned
## Git commands {#git}
### Recommended learning {.unnumbered}
### Where to enter commands {.unnumbered}
### Sample commands {.unnumbered}
## Resources

<!--chapter:end:new_pages/collaboration.Rmd-->


# Các lỗi thường gặp {#errors}  

Placeholder


## Phiên giải thông báo lỗi  
## Các lỗi thường gặp 
### Lỗi đánh máy {.unnumbered}  
### Các lỗi liên quan đến Package {.unnumbered}  
### Các lỗi liên quan tới đối tượng {.unnumbered}  
### Các lỗi liên quan tới cú pháp hàm {.unnumbered}
### Các lỗi logic {.unnumbered}  
### Các lỗi liên quan tới Factor {.unnumbered}  
### Lỗi khi vẽ biểu đồ {.unnumbered}  
### Lỗi R Markdown {.unnumbered}  
### Tổng hợp {.unnumbered}  
## Nguồn { }

<!--chapter:end:new_pages/errors.Rmd-->


# Nhờ sự trợ giúp {#help}

Placeholder


## Đăng vấn đề lên Github 
## Ví dụ giả lập 
### Package **reprex**  {.unnumbered}  
### Bộ dữ liệu tối giản {.unnumbered}  
## Đăng lên diễn đàn   
## Tài liệu tham khảo { }

<!--chapter:end:new_pages/help.Rmd-->


# R trên ổ cứng mạng {#network-drives}  

Placeholder


## Tổng quan {  }
## RStudio với tư cách quản trị viên  
## Các lệnh hữu ích  
## Khắc phục các lỗi thường gặp {  }

<!--chapter:end:new_pages/network_drives.Rmd-->


# Data Table {#data-table}

Placeholder


## Giới thiệu về data table
## Gọi package và nhập dữ liệu
### Gọi package {.unnumbered}
### Nhập dữ liệu {.unnumbered}
## Đối số i: chọn và lọc hàng
### Sử dụng hàm trợ giúp để lọc {.unnumbered}
## Đối số j: chọn và tính toán trên cột
### Chọn cột {.unnumbered}
### Tính toán trên cột {.unnumbered}
## Đối số by: tính toán theo nhóm
## Thêm và cập nhật dữ liệu vào data table
## Tài nguyên học liệu

<!--chapter:end:new_pages/data_table.Rmd-->

