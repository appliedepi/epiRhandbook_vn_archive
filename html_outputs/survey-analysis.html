<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>26 Phân tích khảo sát | Cẩm nang dịch tễ học với R</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6.4/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.16/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.0.0/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.52.2/plotly-basic-1.52.2.min.js"></script><script src="libs/plotly-cartesian-1.52.2/plotly-cartesian-1.52.2.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-8.1.2/highcharts.js"></script><script src="libs/highcharts-8.1.2/highcharts-3d.js"></script><script src="libs/highcharts-8.1.2/highcharts-more.js"></script><script src="libs/highcharts-8.1.2/modules/stock.js"></script><script src="libs/highcharts-8.1.2/modules/map.js"></script><script src="libs/highcharts-8.1.2/modules/annotations.js"></script><script src="libs/highcharts-8.1.2/modules/data.js"></script><script src="libs/highcharts-8.1.2/modules/drilldown.js"></script><script src="libs/highcharts-8.1.2/modules/item-series.js"></script><script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script><script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-8.1.2/modules/exporting.js"></script><script src="libs/highcharts-8.1.2/modules/export-data.js"></script><script src="libs/highcharts-8.1.2/modules/funnel.js"></script><script src="libs/highcharts-8.1.2/modules/heatmap.js"></script><script src="libs/highcharts-8.1.2/modules/treemap.js"></script><script src="libs/highcharts-8.1.2/modules/sankey.js"></script><script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script><script src="libs/highcharts-8.1.2/modules/organization.js"></script><script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script><script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script><script src="libs/highcharts-8.1.2/modules/sunburst.js"></script><script src="libs/highcharts-8.1.2/modules/vector.js"></script><script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script><script src="libs/highcharts-8.1.2/modules/xrange.js"></script><script src="libs/highcharts-8.1.2/modules/tilemap.js"></script><script src="libs/highcharts-8.1.2/modules/venn.js"></script><script src="libs/highcharts-8.1.2/modules/gantt.js"></script><script src="libs/highcharts-8.1.2/modules/timeline.js"></script><script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script><script src="libs/highcharts-8.1.2/modules/bullet.js"></script><script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script><script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script><script src="libs/highcharts-8.1.2/modules/lollipop.js"></script><script src="libs/highcharts-8.1.2/modules/series-label.js"></script><script src="libs/highcharts-8.1.2/plugins/motion.js"></script><script src="libs/highcharts-8.1.2/custom/reset.js"></script><script src="libs/highcharts-8.1.2/modules/boost.js"></script><script src="libs/highchart-binding-0.8.2/highchart.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Về cuốn sách này</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Biên tập và ghi chú kỹ thuật</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Tải sách và dữ liệu</a></li>
<li class="book-part">Nhập môn về R</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R Cơ bản</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Chuyển đổi sang R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Package đề xuất</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Dự án R</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Nhập xuất dữ liệu</a></li>
<li class="book-part">Quản lý dữ liệu</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Làm sạch số liệu và các hàm quan trọng</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Làm việc với ngày tháng</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Ký tự và chuỗi</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factors</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Xoay trục dữ liệu</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Nhóm dữ liệu</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Nối dữ liệu</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Loại bỏ trùng lặp</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Lặp, vòng lặp, và danh sách</a></li>
<li class="book-part">Phân tích dữ liệu</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Bảng mô tả</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Các kiểm định thống kê cơ bản</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Hồi quy đơn và đa biến</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Dữ liệu Missing</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Tỷ suất chuẩn hóa</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Đường trung bình động</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> Chuỗi thời gian và phát hiện ổ dịch</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> Mô hình hóa dịch bệnh</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> Truy vết tiếp xúc</a></li>
<li><a class="active" href="survey-analysis.html"><span class="header-section-number">26</span> Phân tích khảo sát</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Phân tích sống còn</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS cơ bản</a></li>
<li class="book-part">Trực quan hóa dữ liệu</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> Trình bày bảng</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot cơ bản</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Các tips với ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Đường cong dịch bệnh</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> Tháp dân số và thang đo Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Biểu đồ nhiệt</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Sơ đồ và biểu đồ</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> Biểu đồ kết hợp</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Chuỗi lây nhiễm</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Cây phả hệ</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Biểu đồ tương tác</a></li>
<li class="book-part">Báo cáo và dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Báo cáo với R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Tổ chức báo cáo định kỳ</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> Dashboards với R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Dashboards với Shiny</a></li>
<li class="book-part">Tổng hợp</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> Viết hàm</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Tương tác với thư mục làm việc</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Version control với Git và Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Các lỗi thường gặp</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Nhờ sự trợ giúp</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> R trên ổ cứng mạng</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="survey-analysis" class="section level1" number="26">
<h1>
<span class="header-section-number">26</span> Phân tích khảo sát<a class="anchor" aria-label="anchor" href="#survey-analysis"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="tổng-quan-4" class="section level2" number="26.1">
<h2>
<span class="header-section-number">26.1</span> Tổng quan<a class="anchor" aria-label="anchor" href="#t%E1%BB%95ng-quan-4"><i class="fas fa-link"></i></a>
</h2>
<p>Chương này trình bày việc sử dụng một số packages để phân tích khảo sát.</p>
<p>Hầu hết các packages R dùng để phân tích khảo sát đều dựa trên <a href="https://cran.r-project.org/web/packages/survey/index.html"><strong>survey</strong> package</a> cho phân tích có trọng số. Chúng tôi sẽ sử dụng <strong>survey</strong> cũng như <a href="https://cran.r-project.org/web/packages/srvyr/index.html"><strong>srvyr</strong></a> (cho phép <strong>survey</strong> mã hóa theo kiểu tidyverse) và <a href="https://cran.r-project.org/web/packages/gtsummary/index.html"><strong>gtsummary</strong></a> (cho phép <strong>survey</strong> tạo các bảng sẵn sàng cho xuất bản). Trong khi package <strong>survey</strong> ban đầu không cho phép mã hóa theo kiểu tidyverse, nhưng nó có điểm cộng là cho phép khảo sát được trọng số hóa mô hình tuyến tính tổng quát (sẽ được thêm vào chương này sau). Chúng tôi cũng sẽ minh họa bằng cách sử dụng một hàm từ package <a href="https://github.com/R4EPI/sitrep"><strong>sitrep</strong></a> để tạo mẫu trọng số (<em>lưu ý</em> package này hiện chưa có trên CRAN, nhưng có thể được cài đặt từ github).</p>
<p>Hầu hết chương này dựa trên công việc đã hoàn thành của <a href="https://r4epis.netlify.app/">dự án “R4Epis”</a>; để biết code chi tiết và mẫu R-markdown xem <a href="https://github.com/R4EPI/sitrep">trang github của “R4Epis”</a>. Một số package <strong>survey</strong> dựa trên các phiên bản đầu tiên của <a href="https://github.com/EPIET/RapidAssessmentSurveys">các nghiên cứuu trường hợp EPIET</a>.</p>
<p>Hiện tại, chương này không đề cập đến các phép tính cỡ mẫu hoặc lấy mẫu. Để tính cỡ mẫu đơn giản, hãy xem <a href="https://www.openepi.com/Menu/OE_Menu.htm">OpenEpi</a>. Chương <a href="data-used.html#gis">GIS cơ bản</a> trong sổ tay này sẽ có một phần về lấy mẫu ngẫu nhiên theo không gian và chương này cũng sẽ đề cập một phần về khung lấy mẫu cũng như tính toán cỡ mẫu.</p>
<ol style="list-style-type: decimal">
<li>Dữ liệu khảo sát</li>
<li>Thời gian quan sát</li>
<li>Áp dụng trọng số</li>
<li>Đối tượng thiết kế nghiên cứu</li>
<li>Phân tích mô tả</li>
<li>Tỷ lệ được áp dụng trọng số</li>
<li>Tỷ suất được áp dụng trọng số</li>
</ol>
<!-- ======================================================= -->
</div>
<div id="chuẩn-bị-16" class="section level2" number="26.2">
<h2>
<span class="header-section-number">26.2</span> Chuẩn bị<a class="anchor" aria-label="anchor" href="#chu%E1%BA%A9n-b%E1%BB%8B-16"><i class="fas fa-link"></i></a>
</h2>
<div id="packages-2" class="section level3 unnumbered">
<h3>Packages<a class="anchor" aria-label="anchor" href="#packages-2"><i class="fas fa-link"></i></a>
</h3>
<p>Đoạn code này hiển thị việc gọi các package cần thiết cho các phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh việc sử dụng hàm <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> từ package <strong>pacman</strong>, giúp cài đặt các package cần thiết <em>và</em> gọi chúng ra để sử dụng. Bạn cũng có thể gọi các packages đã cài đặt với hàm <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> của <strong>base</strong> R. Xem thêm chương <a href="basics.html#basics">R cơ bản</a> để có thêm thông tin về các packages trong R. Ở đây chúng tôi cũng minh họa việc sử dụng hàm <code><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh()</a></code> từ <strong>pacman</strong> để cài đặt một package tải từ github mà chưa được công bố trên CRAN.</p>
<div class="sourceCode" id="cb1234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load packages from CRAN</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rio</span>,          <span class="co"># File import</span>
               <span class="va">here</span>,         <span class="co"># File locator</span>
               <span class="va">tidyverse</span>,    <span class="co"># data management + ggplot2 graphics</span>
               <span class="va">tsibble</span>,      <span class="co"># handle time series datasets</span>
               <span class="va">survey</span>,       <span class="co"># for survey functions</span>
               <span class="va">srvyr</span>,        <span class="co"># dplyr wrapper for survey package</span>
               <span class="va">gtsummary</span>,    <span class="co"># wrapper for survey package to produce tables</span>
               <span class="va">apyramid</span>,     <span class="co"># a package dedicated to creating age pyramids</span>
               <span class="va">patchwork</span>,    <span class="co"># for combining ggplots</span>
               <span class="va">ggforce</span>       <span class="co"># for alluvial/sankey plots</span>
               <span class="op">)</span> 

<span class="co">## load packages from github</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh</a></span><span class="op">(</span>
     <span class="st">"R4EPI/sitrep"</span>          <span class="co"># for observation time / weighting functions</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="nạp-dữ-liệu" class="section level3 unnumbered">
<h3>Nạp dữ liệu<a class="anchor" aria-label="anchor" href="#n%E1%BA%A1p-d%E1%BB%AF-li%E1%BB%87u"><i class="fas fa-link"></i></a>
</h3>
<p>Bộ dữ liệu ví dụ được sử dụng trong phần này:</p>
<ul>
<li>dữ liệu điều tra tỷ lệ tử vong mô phỏng.</li>
<li>số lượng dân cư mô phỏng cho khu vực khảo sát.</li>
<li>từ điển dữ liệu cho dữ liệu khảo sát tử vong mô phỏng.</li>
</ul>
<p>Bộ này dựa trên khảo sát đã được phê duyệt trước của hội đồng đạo đức MSF OCA. Các tập dữ liệu mô phỏng được tạo như một phần của <a href="https://r4epis.netlify.app/">Dự án “R4Epis”</a>. Tất cả đều dựa trên dữ liệu được thu thập bằng <a href="https://www.kobotoolbox.org/">KoboToolbox</a>, đây là một phần mềm thu thập dữ liệu dựa trên <a href="https://opendatakit.org/">Open Data Kit</a>.</p>
<p>Kobo cho phép bạn xuất cả dữ liệu đã thu thập, cũng như từ điển dữ liệu cho tập dữ liệu đó. Chúng tôi thực sự khuyên bạn nên làm điều này vì nó đơn giản hóa việc làm sạch dữ liệu và hữu ích cho việc tra cứu các biến/câu hỏi.</p>
<p><span style="color: darkgreen;"><strong><em>MẸO:</em></strong> Từ điển dữ liệu Kobo có tên biến trong cột “name” của sheet “survey” (khảo sát). Các giá trị có thể có cho mỗi biến được chỉ định trong sheet “choices” (lựa chọn). Trong tab lựa chọn, “name” có giá trị rút gọn và các cột “label::english” và “label::french” chứa các nhãn mô tả đầy đủ. Sử dụng hàm <code>msf_dict_survey()</code> của package <strong>epidict</strong> để nhập tệp excel từ điển Kobo sẽ định dạng lại tệp này cho bạn để bạn có thể dễ dàng sử dụng để code lại.</span></p>
<p><span style="color: orange;"><strong><em>THẬN TRỌNG:</em></strong> Bộ dữ liệu ví dụ không giống nhau dưới dạng xuất (như trong Kobo, bạn xuất từng cấp bảng câu hỏi khác nhau) - xem phần dữ liệu khảo sát bên dưới để hợp nhất các cấp độ khác nhau.</span></p>
<p>Bộ dữ liệu được nhập bằng hàm <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> từ package <strong>rio</strong>. Xem chương về <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết các cách nhập dữ liệu khác nhau.</p>
<div class="sourceCode" id="cb1235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the survey data</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_data.xlsx"</span><span class="op">)</span>

<span class="co"># import the dictionary into R</span>
<span class="va">survey_dict</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_dict.xlsx"</span><span class="op">)</span> </code></pre></div>
<p>10 hàng đầu tiên của khảo sát được hiển thị bên dưới.</p>
<div id="htmlwidget-1f0fb8d14bff5cd9314c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f0fb8d14bff5cd9314c">{"x":{"filter":"none","data":[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["2018-04-15T00:00:00Z","2018-03-04T00:00:00Z","2018-04-16T00:00:00Z","2018-01-23T00:00:00Z","2018-01-09T00:00:00Z","2018-03-07T00:00:00Z","2018-02-18T00:00:00Z","2018-04-12T00:00:00Z","2018-04-17T00:00:00Z","2018-01-05T00:00:00Z"],[null,null,null,null,null,null,null,null,null,null],["village_1","village_1","village_10","village_5","village_3","village_8","other","village_7","village_4","village_2"],[null,null,null,null,null,null,null,null,null,null],[1,1,10,5,3,8,11,7,4,2],[9,1,15,6,18,14,17,16,13,14],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["yes","no","no","yes","no","yes","no","yes","yes","yes"],[null,"no_benefit","neg_experience",null,"other",null,"no_benefit",null,null,null],[null,null,null,null,null,null,null,null,null,null],[6,null,null,8,null,5,null,6,5,5],["female",null,null,"female",null,"male",null,"male","male","female"],[26,null,null,3,null,22,null,33,96,18],[null,null,null,36,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no",null,null,"no",null,"yes",null,"yes","yes","yes"],["yes",null,null,null,null,"yes",null,"no","no","no"],["secondary",null,null,null,null,"secondary",null,null,null,null],["no",null,null,"no",null,"yes",null,"no","yes","yes"],[null,null,null,null,null,"yes",null,null,"no","no"],["yes",null,null,null,null,null,null,null,null,"yes"],["no",null,null,"no",null,"yes",null,"yes","no","yes"],["yes",null,null,"no",null,"no",null,"no","yes","yes"],["no",null,null,null,null,null,null,null,"no","no"],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"no",null,"no",null,"yes","no","no"],["no",null,null,null,null,null,null,"no",null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no","no","no","no","no","no","no","no","yes","no"],[null,null,null,null,null,null,null,null,"no",null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,"dont_know",null],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"yes",null,"no",null,"yes","no","no"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["sexual",null,null,"sexual",null,null,null,"shot",null,null],["0",null,null,"0",null,null,null,"0",null,null],["1",null,null,"1",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"1",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],[9,1,183,83,58,146,205,130,72,33],[1,1,1,1,1,1,1,1,1,1],["9_1","1_1","183_1","83_1","58_1","146_1","205_1","130_1","72_1","33_1"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>start<\/th>\n      <th>end<\/th>\n      <th>today<\/th>\n      <th>deviceid<\/th>\n      <th>date<\/th>\n      <th>team_number<\/th>\n      <th>village_name<\/th>\n      <th>village_other<\/th>\n      <th>cluster_number<\/th>\n      <th>household_number<\/th>\n      <th>households_building<\/th>\n      <th>random_hh<\/th>\n      <th>random_hh_note<\/th>\n      <th>consent<\/th>\n      <th>no_consent_reason<\/th>\n      <th>no_consent_other<\/th>\n      <th>member_number<\/th>\n      <th>sex<\/th>\n      <th>age_years<\/th>\n      <th>age_months_calc<\/th>\n      <th>age_months<\/th>\n      <th>bednet<\/th>\n      <th>read_write<\/th>\n      <th>education_level<\/th>\n      <th>measles_vaccination<\/th>\n      <th>vaccination_card<\/th>\n      <th>pregnant<\/th>\n      <th>malaria_treatment<\/th>\n      <th>arrived<\/th>\n      <th>remember_arrival<\/th>\n      <th>arrived_date<\/th>\n      <th>left<\/th>\n      <th>remember_departure<\/th>\n      <th>left_date<\/th>\n      <th>born<\/th>\n      <th>remember_dob<\/th>\n      <th>birthday_date<\/th>\n      <th>died<\/th>\n      <th>remember_death<\/th>\n      <th>death_date<\/th>\n      <th>cause<\/th>\n      <th>cause_other<\/th>\n      <th>violent_episode<\/th>\n      <th>violent_episodes_number<\/th>\n      <th>violence_nature_other<\/th>\n      <th>violence_nature<\/th>\n      <th>violence_nature/beaten<\/th>\n      <th>violence_nature/sexual<\/th>\n      <th>violence_nature/shot<\/th>\n      <th>violence_nature/detained_kidnapped<\/th>\n      <th>violence_nature/other<\/th>\n      <th>violence_nature/no_response<\/th>\n      <th>index<\/th>\n      <th>index_y<\/th>\n      <th>uid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[8,9,16,18,19,20,52,53]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Chúng ta cũng muốn nhập dữ liệu về quần thể lấy mẫu để có thể tạo ra các trọng số thích hợp. Dữ liệu này có thể ở các định dạng khác nhau, tuy nhiên chúng tôi khuyên bạn nên định dạng như hình bên dưới (dữ liệu này có thể chỉ cần nhập vào excel).</p>
<div class="sourceCode" id="cb1236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the population data</span>
<span class="va">population</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"population.xlsx"</span><span class="op">)</span></code></pre></div>
<p>10 hàng đầu tiên của khảo sát được hiển thị bên dưới.</p>
<div id="htmlwidget-a844a12e279368a3f80c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a844a12e279368a3f80c">{"x":{"filter":"none","data":[["0-2","3-14","15-29","30-44","45+","0-2","3-14","15-29","30-44","45+"],["male","male","male","male","male","female","female","female","female","female"],[0.034,0.1811,0.138,0.0808,0.0661,0.034,0.1811,0.138,0.0808,0.0661],[340,1811,1380,808,661,340,1811,1380,808,661],["district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_group<\/th>\n      <th>sex<\/th>\n      <th>proportions<\/th>\n      <th>population<\/th>\n      <th>health_district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Đối với khảo sát theo cụm, bạn có thể muốn thêm trọng số khảo sát ở cấp cụm. Bạn có thể đọc dữ liệu này như trên. Ngoài ra, nếu số lượng ít, chúng có thể được nhập như dưới đây dưới dạng một tibble. Trong mọi trường hợp, bạn sẽ cần có một cột với mã định danh cụm khớp với dữ liệu khảo sát của bạn và một cột khác với số lượng hộ gia đình ở từng cụm.</p>
<div class="sourceCode" id="cb1237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## define the number of households in each cluster</span>
<span class="va">cluster_counts</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"village_1"</span>, <span class="st">"village_2"</span>, <span class="st">"village_3"</span>, <span class="st">"village_4"</span>, 
                                     <span class="st">"village_5"</span>, <span class="st">"village_6"</span>, <span class="st">"village_7"</span>, <span class="st">"village_8"</span>,
                                     <span class="st">"village_9"</span>, <span class="st">"village_10"</span><span class="op">)</span>, 
                         households <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">500</span>, <span class="fl">300</span>, 
                                        <span class="fl">800</span>, <span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="làm-sạch-dữ-liệu-2" class="section level3 unnumbered">
<h3>Làm sạch dữ liệu<a class="anchor" aria-label="anchor" href="#l%C3%A0m-s%E1%BA%A1ch-d%E1%BB%AF-li%E1%BB%87u-2"><i class="fas fa-link"></i></a>
</h3>
<p>Dưới đây đảm bảo rằng cột ngày ở định dạng thích hợp. Có một số cách khác để thực hiện việc này (xem chương <a href="dates.html#dates">Làm việc với ngày tháng</a> để biết chi tiết), tuy nhiên sử dụng từ điển để xác định ngày sẽ nhanh chóng và dễ dàng.</p>
<p>Chúng tôi cũng tạo một biến nhóm tuổi bằng cách sử dụng hàm <code>age_categories()</code> từ <strong>epikit</strong> - xem phần <a href="cleaning.html#cleaning">Làm sạch dữ liệu</a> của sổ tay để biết chi tiết. Ngoài ra, chúng tôi tạo một biến ký tự xác định các cụm khác nhau nằm trong khu vực nào.</p>
<p>Cuối cùng, chúng tôi mã hóa lại tất cả các biến yes/no thành các biến TRUE/FALSE - nếu không, các biến này không thể được sử dụng bởi các hàm tính tỷ lệ trong package <strong>survey</strong>.</p>
<div class="sourceCode" id="cb1238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## select the date variable names from the dictionary </span>
<span class="va">DATEVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"date"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## filter to match the column names of your data</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># select date vars</span>
  
<span class="co">## change to dates </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">DATEVARS</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span>


<span class="co">## add those with only age in months to the year variable (divide by twelve)</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_years</span><span class="op">)</span>, 
                             <span class="va">age_months</span> <span class="op">/</span> <span class="fl">12</span>, 
                             <span class="va">age_years</span><span class="op">)</span><span class="op">)</span>

<span class="co">## define age group variable</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span><span class="va">age_years</span>, 
                                    breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">45</span><span class="op">)</span>
                                    <span class="op">)</span><span class="op">)</span>


<span class="co">## create a character variable based off groups of a different variable </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>health_district <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="va">cluster_number</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="st">"district_a"</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"district_b"</span>
  <span class="op">)</span><span class="op">)</span>


<span class="co">## select the yes/no variable names from the dictionary </span>
<span class="va">YNVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"yn"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## filter to match the column names of your data</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># select yn vars</span>
  
<span class="co">## change to dates </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">YNVARS</span><span class="op">)</span>, 
                <span class="va">str_detect</span>, 
                pattern <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="dữ-liệu-khảo-sát" class="section level2" number="26.3">
<h2>
<span class="header-section-number">26.3</span> Dữ liệu khảo sát<a class="anchor" aria-label="anchor" href="#d%E1%BB%AF-li%E1%BB%87u-kh%E1%BA%A3o-s%C3%A1t"><i class="fas fa-link"></i></a>
</h2>
<p>Có rất nhiều thiết kế lấy mẫu khác nhau có thể được sử dụng cho các khảo sát. Ở đây chúng tôi sẽ trình bày code cho: - Phân tầng - Cụm - Cụm phân tầng</p>
<p>Như đã mô tả ở trên (tùy thuộc vào cách bạn thiết kế bảng câu hỏi của mình), dữ liệu cho mỗi cấp độ sẽ được xuất dưới dạng bộ dữ liệu riêng biệt từ Kobo. Trong ví dụ của chúng tôi, có một cấp cho các hộ gia đình và một cấp cho các cá nhân trong các hộ gia đình đó.</p>
<p>Hai cấp độ này được liên kết bởi một mã định danh duy nhất. Đối với bộ dữ liệu Kobo, biến này là “_index” ở cấp hộ gia đình, khớp với “_parent_index” ở cấp cá nhân. Thao tác này sẽ tạo các hàng mới cho hộ gia đình với mỗi cá nhân phù hợp, hãy xem chương <a href="joining-matching.html#joining-matching">Nối dữ liệu</a> để biết chi tiết.</p>
<div class="sourceCode" id="cb1239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## join the individual and household data to form a complete data set</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">survey_data_hh</span>, 
                         <span class="va">survey_data_indiv</span>,
                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_index"</span> <span class="op">=</span> <span class="st">"_parent_index"</span><span class="op">)</span><span class="op">)</span>


<span class="co">## create a unique identifier by combining indeces of the two levels </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span>uid <span class="op">=</span> <span class="fu">str_glue</span><span class="op">(</span><span class="st">"{index}_{index_y}"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="thời-gian-quan-sát" class="section level2" number="26.4">
<h2>
<span class="header-section-number">26.4</span> Thời gian quan sát<a class="anchor" aria-label="anchor" href="#th%E1%BB%9Di-gian-quan-s%C3%A1t"><i class="fas fa-link"></i></a>
</h2>
<p>Đối với các cuộc khảo sát về tỷ lệ tử vong, chúng ta muốn biết mỗi cá nhân đã có mặt tại địa điểm trong bao lâu để có thể tính toán tỷ lệ tử vong thích hợp trong khoảng thời gian nghiên cứu. Điều này không áp dụng đối với tất cả các cuộc điều tra, nhưng đặc biệt rất quan trọng đối với các cuộc điều tra tử vong vì chúng thường được khảo sát ở các quần thể di động hoặc di cư.</p>
<p>Để làm điều này, trước tiên chúng ta xác định khoảng thời gian quan tâm, còn được gọi là khoảng thời gian hồi cứu (tức là thời gian mà những người tham gia được yêu cầu báo cáo khi trả lời câu hỏi). Sau đó, chúng ta có thể sử dụng khoảng thời gian này để đặt các ngày không thích hợp thành giá trị missing, vd: các trường hợp tử vong được báo cáo ngoài khoảng thời gian quan tâm.</p>
<div class="sourceCode" id="cb1240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set the start/end of recall period</span>
<span class="co">## can be changed to date variables from dataset </span>
<span class="co">## (e.g. arrival date &amp; date questionnaire)</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>recall_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>, 
         recall_end   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-05-01"</span><span class="op">)</span>
  <span class="op">)</span>


<span class="co"># set inappropriate dates to NA based on rules </span>
<span class="co">## e.g. arrivals before start, departures departures after end</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
      <span class="fu">mutate</span><span class="op">(</span>
           arrived_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">arrived_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>, 
                                 <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                                  <span class="va">arrived_date</span><span class="op">)</span>,
           birthday_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">birthday_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>,
                                  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                                  <span class="va">birthday_date</span><span class="op">)</span>,
           left_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">left_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                               <span class="va">left_date</span><span class="op">)</span>,
           death_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">death_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,
                               <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                               <span class="va">death_date</span><span class="op">)</span>
           <span class="op">)</span></code></pre></div>
<p>Sau đó, chúng ta có thể sử dụng các biến ngày của mình để xác định ngày bắt đầu và ngày kết thúc cho từng cá nhân. Chúng ta có thể sử dụng hàm <code>find_start_date()</code> từ <strong>sitrep</strong> để xác định ngày bắt đầu và sau đó sử dụng hàm đó để tính toán sự khác biệt giữa các ngày (người-thời gian).</p>
<p>Ngày bắt đầu: Sự kiện phù hợp tới sớm nhất trong khoảng thời gian hồi cứu của bạn. Hoặc là ngày bắt đầu thời gian hồi cứu của bạn (mà bạn xác định trước) hoặc ngày sau khi bắt đầu hồi cứu nếu có (ví dụ: đi đến hoặc sinh ra)</p>
<p>Ngày kết thúc: Sự kiện dừng lại thích hợp sớm nhất trong thời gian hồi cứu của bạn. Hoặc là ngày kết thúc thời gian hồi cứu hoặc ngày trước khi kết thúc hồi cứu nếu có (ví dụ: rời đi, tử vong)</p>
<div class="sourceCode" id="cb1241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## create new variables for start and end dates/causes</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="co">## choose earliest date entered in survey</span>
     <span class="co">## from births, household arrivals, and camp arrivals </span>
     <span class="fu">find_start_date</span><span class="op">(</span><span class="st">"birthday_date"</span>,
                  <span class="st">"arrived_date"</span>,
                  period_start <span class="op">=</span> <span class="st">"recall_start"</span>,
                  period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,
                  datecol      <span class="op">=</span> <span class="st">"startdate"</span>,
                  datereason   <span class="op">=</span> <span class="st">"startcause"</span> 
                 <span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="co">## choose earliest date entered in survey</span>
     <span class="co">## from camp departures, death and end of the study</span>
     <span class="fu">find_end_date</span><span class="op">(</span><span class="st">"left_date"</span>,
                <span class="st">"death_date"</span>,
                period_start <span class="op">=</span> <span class="st">"recall_start"</span>,
                period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,
                datecol      <span class="op">=</span> <span class="st">"enddate"</span>,
                datereason   <span class="op">=</span> <span class="st">"endcause"</span> 
               <span class="op">)</span>


<span class="co">## label those that were present at the start/end (except births/deaths)</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span>
       <span class="co">## fill in start date to be the beginning of recall period (for those empty) </span>
       startdate <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span>, <span class="va">recall_start</span>, <span class="va">startdate</span><span class="op">)</span>, 
       <span class="co">## set the start cause to present at start if equal to recall period </span>
       <span class="co">## unless it is equal to the birth date </span>
       startcause <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">startdate</span> <span class="op">==</span> <span class="va">recall_start</span> <span class="op">&amp;</span> <span class="va">startcause</span> <span class="op">!=</span> <span class="st">"birthday_date"</span>,
                              <span class="st">"Present at start"</span>, <span class="va">startcause</span><span class="op">)</span>, 
       <span class="co">## fill in end date to be end of recall period (for those empty) </span>
       enddate <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span>, <span class="va">recall_end</span>, <span class="va">enddate</span><span class="op">)</span>, 
       <span class="co">## set the end cause to present at end if equall to recall end </span>
       <span class="co">## unless it is equal to the death date</span>
       endcause <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">enddate</span> <span class="op">==</span> <span class="va">recall_end</span> <span class="op">&amp;</span> <span class="va">endcause</span> <span class="op">!=</span> <span class="st">"death_date"</span>, 
                            <span class="st">"Present at end"</span>, <span class="va">endcause</span><span class="op">)</span><span class="op">)</span>


<span class="co">## Define observation time in days</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>obstime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">enddate</span> <span class="op">-</span> <span class="va">startdate</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="áp-dụng-trọng-số" class="section level2" number="26.5">
<h2>
<span class="header-section-number">26.5</span> Áp dụng trọng số<a class="anchor" aria-label="anchor" href="#%C3%A1p-d%E1%BB%A5ng-tr%E1%BB%8Dng-s%E1%BB%91"><i class="fas fa-link"></i></a>
</h2>
<p>Điều quan trọng là bạn phải loại bỏ các đối tượng có lỗi trước khi thêm trọng số khảo sát. Ví dụ: nếu bạn có các quan sát với thời gian theo dõi âm, bạn sẽ cần kiểm tra các đối tượng đó (bạn có thể thực hiện việc này với hàm <code>assert_positive_timespan()</code> từ <strong>sitrep</strong>. Một điều khác là nếu bạn muốn bỏ các hàng trống (ví dụ: với <code>drop_na(uid)</code>) hoặc xóa các bản ghi trùng lặp (xem chương <a href="deduplication.html#lo%E1%BA%A1i-b%E1%BB%8F-tr%C3%B9ng-l%E1%BA%B7p-1">Loại bỏ trùng lặp</a> trong sổ tay này để biết thêm chi tiết). Những đối tượng không có sự đồng ý tham gia nghiên cứu cũng cần phải bị xóa.</p>
<p>Trong ví dụ này, chúng ta lọc các trường hợp muốn loại bỏ và lưu trữ chúng trong một dataframe riêng - theo cách này, chúng ta có thể mô tả những trường hợp đã bị loại khỏi khảo sát. Sau đó, chúng ta sử dụng hàm <code>anti_join()</code> từ <strong>dplyr</strong> để xóa những trường hợp bị loại bỏ này khỏi dữ liệu khảo sát của chúng ta.</p>
<p><span style="color: red;"><strong><em>NGUY HIỂM:</em></strong> Bạn không thể có giá trị missing trong biến trọng số của mình hoặc bất kỳ biến nào có liên quan đến thiết kế khảo sát của bạn (ví dụ: tuổi, giới tính, biến phân tầng hoặc cụm).</span></p>
<div class="sourceCode" id="cb1242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## store the cases that you drop so you can describe them (e.g. non-consenting </span>
<span class="co">## or wrong village/cluster)</span>
<span class="va">dropped</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">consent</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span> <span class="op">|</span> <span class="va">village_name</span> <span class="op">==</span> <span class="st">"other"</span><span class="op">)</span>

<span class="co">## use the dropped cases to remove the unused rows from the survey data set  </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">anti_join</span><span class="op">(</span><span class="va">survey_data</span>, <span class="va">dropped</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dropped</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Như đã đề cập ở trên, chúng tôi trình bày cách thêm trọng số cho ba thiết kế nghiên cứu khác nhau (phân tầng, phân cụm và cụm phân tầng). Chúng yêu cầu thông tin về dân số gốc và/hoặc các cụm được khảo sát. Chúng tôi sẽ sử dụng code cụm phân tầng cho ví dụ này, nhưng hãy sử dụng code nào thích hợp nhất cho thiết kế nghiên cứu của bạn.</p>
<div class="sourceCode" id="cb1243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># stratified ------------------------------------------------------------------</span>
<span class="co"># create a variable called "surv_weight_strata"</span>
<span class="co"># contains weights for each individual - by age group, sex and health district</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">add_weights_strata</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,
                                         p <span class="op">=</span> <span class="va">population</span>,
                                         surv_weight <span class="op">=</span> <span class="st">"surv_weight_strata"</span>,
                                         surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_strata"</span>,
                                         <span class="va">age_group</span>, <span class="va">sex</span>, <span class="va">health_district</span><span class="op">)</span>

<span class="co">## cluster ---------------------------------------------------------------------</span>

<span class="co"># get the number of people of individuals interviewed per household</span>
<span class="co"># adds a variable with counts of the household (parent) index variable</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">add_count</span><span class="op">(</span><span class="va">index</span>, name <span class="op">=</span> <span class="st">"interviewed"</span><span class="op">)</span>


<span class="co">## create cluster weights</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">add_weights_cluster</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,
                                          cl <span class="op">=</span> <span class="va">cluster_counts</span>,
                                          eligible <span class="op">=</span> <span class="va">member_number</span>,
                                          interviewed <span class="op">=</span> <span class="va">interviewed</span>,
                                          cluster_x <span class="op">=</span> <span class="va">village_name</span>,
                                          cluster_cl <span class="op">=</span> <span class="va">cluster</span>,
                                          household_x <span class="op">=</span> <span class="va">index</span>,
                                          household_cl <span class="op">=</span> <span class="va">households</span>,
                                          surv_weight <span class="op">=</span> <span class="st">"surv_weight_cluster"</span>,
                                          surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_cluster"</span>,
                                          ignore_cluster <span class="op">=</span> <span class="cn">FALSE</span>,
                                          ignore_household <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>


<span class="co"># stratified and cluster ------------------------------------------------------</span>
<span class="co"># create a survey weight for cluster and strata</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>surv_weight_cluster_strata <span class="op">=</span> <span class="va">surv_weight_strata</span> <span class="op">*</span> <span class="va">surv_weight_cluster</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="đối-tượng-theo-thiết-kế-nghiên-cứu" class="section level2" number="26.6">
<h2>
<span class="header-section-number">26.6</span> Đối tượng theo thiết kế nghiên cứu<a class="anchor" aria-label="anchor" href="#%C4%91%E1%BB%91i-t%C6%B0%E1%BB%A3ng-theo-thi%E1%BA%BFt-k%E1%BA%BF-nghi%C3%AAn-c%E1%BB%A9u"><i class="fas fa-link"></i></a>
</h2>
<p>Tạo đối tượng khảo sát theo thiết kế nghiên cứu của bạn. Sử dụng theo cách tương tự như dataframe để tính toán trọng số cho tỷ lệ, v.v. Đảm bảo rằng tất cả các biến cần thiết đã được tạo trước bước này.</p>
<p>Có bốn tùy chọn, hãy đánh dấu thành bình luận những tùy chọn bạn không sử dụng: - Ngẫu nhiên đơn - Phân tầng - Cụm - Cụm phân tầng</p>
<p>Đối với mẫu này - chúng ta sẽ giả vờ rằng chúng ta nhóm cụm các cuộc khảo sát theo hai tầng riêng biệt (khu vực A và B). Vì vậy, để có được ước tính tổng thể, chúng ta cần có trọng số kết hợp của cụm và tầng.</p>
<p>Như đã đề cập trước đây, có hai packages có sẵn để thực hiện việc này. Package cổ điển là <strong>survey</strong> và một package gọn hơn được gọi là <strong>srvyr</strong> giúp tạo các đối tượng và hàm theo phong cách tidyverse. Chúng tôi sẽ trình bày cả hai, nhưng lưu ý rằng hầu hết code trong chương này sẽ sử dụng các đối tượng dựa trên <strong>srvyr</strong>. Một ngoại lệ là package <strong>gtsummary</strong> chỉ chấp nhận các đối tượng từ package <strong>survey</strong>.</p>
<div id="package-survey" class="section level3" number="26.6.1">
<h3>
<span class="header-section-number">26.6.1</span> Package <strong>Survey</strong><a class="anchor" aria-label="anchor" href="#package-survey"><i class="fas fa-link"></i></a>
</h3>
<p>Package <strong>survey</strong> sử dụng hiệu quả code <strong>base</strong> <em>R</em> nên không thể sử dụng các pipes (<code>%&gt;%</code>) hoặc các cú pháp <strong>dplyr</strong> khác. Với package <strong>survey</strong>, chúng tôi sử dụng hàm <code>svydesign()</code> để xác định đối tượng khảo sát với các cụm, trọng số và tầng thích hợp.</p>
<p><span style="color: black;"><strong><em>LƯU Ý:</em></strong> chúng ta cần sử dụng dấu ngã (<code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>) trước các biến, điều này là do package sử dụng cú pháp <strong>base</strong> <em>R</em> để gán các biến dựa trên công thức.</span></p>
<div class="sourceCode" id="cb1244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simple random ---------------------------------------------------------------</span>
<span class="va">base_survey_design_simple</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, <span class="co"># 1 for no cluster ids</span>
                   weights <span class="op">=</span> <span class="cn">NULL</span>,               <span class="co"># No weight added</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span>,                <span class="co"># sampling was simple (no strata)</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>            <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span>

<span class="co">## stratified ------------------------------------------------------------------</span>
<span class="va">base_survey_design_strata</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,  <span class="co"># 1 for no cluster ids</span>
                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,     <span class="co"># sampling was stratified by district</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>             <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span>

<span class="co"># cluster ---------------------------------------------------------------------</span>
<span class="va">base_survey_design_cluster</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>, <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span>,                 <span class="co"># sampling was simple (no strata)</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>              <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span>

<span class="co"># stratified cluster ----------------------------------------------------------</span>
<span class="va">base_survey_design</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>,      <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,             <span class="co"># sampling was stratified by district</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>                     <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span></code></pre></div>
</div>
<div id="package-srvyr" class="section level3" number="26.6.2">
<h3>
<span class="header-section-number">26.6.2</span> Package <strong>Srvyr</strong><a class="anchor" aria-label="anchor" href="#package-srvyr"><i class="fas fa-link"></i></a>
</h3>
<p>Với package <strong>srvyr</strong>, chúng ta có thể sử dụng hàm <code>as_survey_design()</code>, nó có tất cả các đối số tương tự như trên nhưng cho phép dùng các pipes (<code>%&gt;%</code>), và vì vậy chúng ta không cần sử dụng dấu ngã (<code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>).</p>
<div class="sourceCode" id="cb1245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## simple random ---------------------------------------------------------------</span>
<span class="va">survey_design_simple</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 1 for no cluster ids </span>
                   weights <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># No weight added</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># sampling was simple (no strata)</span>
                  <span class="op">)</span>
<span class="co">## stratified ------------------------------------------------------------------</span>
<span class="va">survey_design_strata</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 1 for no cluster ids</span>
                   weights <span class="op">=</span> <span class="va">surv_weight_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># sampling was stratified by district</span>
                  <span class="op">)</span>
<span class="co">## cluster ---------------------------------------------------------------------</span>
<span class="va">survey_design_cluster</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="va">surv_weight_cluster</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># sampling was simple (no strata)</span>
                  <span class="op">)</span>

<span class="co">## stratified cluster ----------------------------------------------------------</span>
<span class="va">survey_design</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="va">surv_weight_cluster_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># sampling was stratified by district</span>
                  <span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="phân-tích-mô-tả-3" class="section level2" number="26.7">
<h2>
<span class="header-section-number">26.7</span> Phân tích mô tả<a class="anchor" aria-label="anchor" href="#ph%C3%A2n-t%C3%ADch-m%C3%B4-t%E1%BA%A3-3"><i class="fas fa-link"></i></a>
</h2>
<p>Phân tích mô tả và trực quan hóa cơ bản được đề cập nhiều trong các chương khác của cuốn sổ tay, vì vậy chúng tôi sẽ không đi sâu vào nó ở đây. Để biết chi tiết, hãy xem các chương về <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a>, <a href="stat-tests.html#stat-tests">Các kiểm định thống kê cơ bản</a>, <a href="tables-presentation.html#tables-presentation">Trình bày bảng</a>, <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a> và <a href="rmarkdown.html#rmarkdown">Báo cáo với R Markdown</a>.</p>
<p>Trong phần này, chúng ta sẽ tập trung vào cách điều tra sai số trong mẫu của bạn và trực quan hóa chúng. Chúng ta cũng sẽ xem xét việc trực quan hóa dòng dân cư trong bối cảnh khảo sát bằng cách sử dụng sơ đồ luồng alluvial/sankey.</p>
<p>Nhìn chung, bạn nên xem xét đưa vào các phân tích mô tả sau:</p>
<ul>
<li>Số cụm, hộ gia đình và cá nhân cuối cùng được đưa vào</li>
<li>Số lượng cá nhân bị loại trừ và lý do loại trừ</li>
<li>Trung vị (biên độ) số hộ gia đình trên một cụm và số cá thể trên một hộ gia đình</li>
</ul>
<div id="sai-số-chọn-mẫu" class="section level3" number="26.7.1">
<h3>
<span class="header-section-number">26.7.1</span> Sai số chọn mẫu<a class="anchor" aria-label="anchor" href="#sai-s%E1%BB%91-ch%E1%BB%8Dn-m%E1%BA%ABu"><i class="fas fa-link"></i></a>
</h3>
<p>So sánh tỷ lệ trong từng nhóm tuổi giữa mẫu của bạn và quần thể gốc. Điều này rất quan trọng để có thể làm nổi bật sai số chọn mẫu tiềm ẩn. Tương tự, bạn có thể lặp lại điều này khi xem xét sự phân bố theo giới tính.</p>
<p>Lưu ý rằng các giá trị p từ phép kiểm định hai nhóm chỉ mang tính chất chỉ dẫn và phần thảo luận mang tính mô tả (hoặc trực quan với tháp tuổi bên dưới) về các phân bố trong mẫu nghiên cứu của bạn so với quần thể gốc là quan trọng. Đó là bởi vì việc tăng cỡ mẫu sẽ hay dẫn đến những khác biệt có thể không liên quan sau khi áp dụng trọng số vào dữ liệu của bạn.</p>
<div class="sourceCode" id="cb1246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## counts and props of the study population</span>
<span class="va">ag</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, 
         n_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>

<span class="co">## counts and props of the source population</span>
<span class="va">propcount</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">tally</span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>

<span class="co">## bind together the columns of two tables, group by age, and perform a </span>
<span class="co">## binomial test to see if n/total is significantly different from population</span>
<span class="co">## proportion.</span>
  <span class="co">## suffix here adds to text to the end of columns in each of the two datasets</span>
<span class="fu">left_join</span><span class="op">(</span><span class="va">ag</span>, <span class="va">propcount</span>, by <span class="op">=</span> <span class="st">"age_group"</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_pop"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">## broom::tidy(binom.test()) makes a data frame out of the binomial test and</span>
  <span class="co">## will add the variables p.value, parameter, conf.low, conf.high, method, and</span>
  <span class="co">## alternative. We will only use p.value here. You can include other</span>
  <span class="co">## columns if you want to report confidence intervals</span>
  <span class="fu">mutate</span><span class="op">(</span>binom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">n_total</span>, <span class="va">proportion_pop</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">binom</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># important for expanding the binom.test data frame</span>
  <span class="fu">mutate</span><span class="op">(</span>proportion_pop <span class="op">=</span> <span class="va">proportion_pop</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">## Adjusting the p-values to correct for false positives </span>
  <span class="co">## (because testing multiple age groups). This will only make </span>
  <span class="co">## a difference if you have many age categories</span>
  <span class="fu">mutate</span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">p.value</span>, method <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
                      
  <span class="co">## Only show p-values over 0.001 (those under report as &lt;0.001)</span>
  <span class="fu">mutate</span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.001</span>, 
                          <span class="st">"&lt;0.001"</span>, 
                          <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p.value</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co">## rename the columns appropriately</span>
  <span class="fu">select</span><span class="op">(</span>
    <span class="st">"Age group"</span> <span class="op">=</span> <span class="va">age_group</span>,
    <span class="st">"Study population (n)"</span> <span class="op">=</span> <span class="va">n</span>,
    <span class="st">"Study population (%)"</span> <span class="op">=</span> <span class="va">proportion</span>,
    <span class="st">"Source population (n)"</span> <span class="op">=</span> <span class="va">n_pop</span>,
    <span class="st">"Source population (%)"</span> <span class="op">=</span> <span class="va">proportion_pop</span>,
    <span class="st">"P-value"</span> <span class="op">=</span> <span class="va">p.value</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 6
## # Groups:   Age group [5]
##   `Age group` `Study population (n)` `Study population (%~ `Source population (~
##   &lt;chr&gt;                        &lt;int&gt;                 &lt;dbl&gt;                 &lt;dbl&gt;
## 1 0-2                             12                0.0256                  1360
## 2 3-14                            42                0.0896                  7244
## 3 15-29                           64                0.136                   5520
## 4 30-44                           52                0.111                   3232
## 5 45+                            299                0.638                   2644
## # ... with 2 more variables: Source population (%) &lt;dbl&gt;, P-value &lt;chr&gt;</code></pre>
</div>
<div id="tháp-dân-số" class="section level3" number="26.7.2">
<h3>
<span class="header-section-number">26.7.2</span> Tháp dân số<a class="anchor" aria-label="anchor" href="#th%C3%A1p-d%C3%A2n-s%E1%BB%91"><i class="fas fa-link"></i></a>
</h3>
<p>Tháp dân số (hoặc tháp tuổi-giới) là một cách dễ dàng để trực quan hóa sự phân bố trong quần thể khảo sát của bạn. Cũng nên xem xét việc tạo <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a> về độ tuổi và giới tính theo tầng khảo sát. Chúng ta sẽ minh họa bằng package <strong>apyramid</strong> vì nó cho phép các tỷ lệ được áp dụng trọng số sử dụng đối tượng theo thiết kế nghiên cứu mà chúng ta đã tạo ở trên. Các tùy chọn khác để tạo <a href="age-pyramid.html#age-pyramid">Tháp dân số</a> được đề cập nhiều hơn trong chương đó của sổ tay. Chúng ta cũng sẽ sử dụng một hàm gọn hơn từ <strong>sitrep</strong> được gọi là <code>plot_age_pyramid()</code> để lưu một vài dòng code để tạo ra một biểu đồ theo tỷ lệ.</p>
<p>Giống như với phép kiểm định sự khác biệt giữa hai nhóm chuẩn được thảo luận ở trên trong phần sai số chọn mẫu, ở đây chúng ta quan tâm đến việc trực quan hóa liệu quần thể mẫu của chúng ta có khác biệt đáng kể so với quần thể gốc hay không, và liệu trọng số có sửa chữa được sự khác biệt này hay không. Để làm điều này, chúng ta sẽ sử dụng package <strong>patchwork</strong> để hiển thị các biểu đồ tạo bởi <strong>ggplot</strong> song song với nhau; chi tiết xem phần kết hợp các đồ thị trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> của sổ tay này. Chúng ta sẽ trực quan hóa quần thể gốc, quần thể khảo sát không trọng số và quần thể khảo sát có trọng số. Bạn cũng có thể xem xét trực quan theo từng tầng của khảo sát - bằng cách sử dụng đối số <code>stack_by  = "health_district"</code> trong ví dụ của chúng tôi ở đây (xem <code>?plot_age_pyramid</code> để biết chi tiết).</p>
<p><span style="color: black;"><strong><em>Lưu ý:</em></strong> Trục x và y được lật ngược trong tháp</span></p>
<div class="sourceCode" id="cb1248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## define x-axis limits and labels ---------------------------------------------</span>
<span class="co">## (update these numbers to be the values for your graph)</span>
<span class="va">max_prop</span> <span class="op">&lt;-</span> <span class="fl">35</span>      <span class="co"># choose the highest proportion you want to show </span>
<span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">5</span>           <span class="co"># choose the space you want beween labels </span>

<span class="co">## this part defines vector using the above numbers with axis breaks</span>
<span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span> <span class="op">-</span> <span class="va">step</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, 
    <span class="fl">0</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">step</span> <span class="op">/</span> <span class="fl">100</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>
    <span class="op">)</span>

<span class="co">## this part defines vector using the above numbers with axis limits</span>
<span class="va">limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>

<span class="co">## this part defines vector using the above numbers with axis labels</span>
<span class="va">labels</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span>, <span class="va">step</span>, <span class="op">-</span><span class="va">step</span><span class="op">)</span>, 
      <span class="fl">0</span>, 
      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">step</span>, <span class="va">max_prop</span>, <span class="va">step</span><span class="op">)</span>
    <span class="op">)</span>


<span class="co">## create plots individually  --------------------------------------------------</span>

<span class="co">## plot the source population </span>
<span class="co">## nb: this needs to be collapsed for the overall population (i.e. removing health districts)</span>
<span class="va">source_population</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op">%&gt;%</span>
  <span class="co">## ensure that age and sex are factors</span>
  <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span>, 
                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-2"</span>, 
                                       <span class="st">"3-14"</span>, 
                                       <span class="st">"15-29"</span>,
                                       <span class="st">"30-44"</span>, 
                                       <span class="st">"45+"</span><span class="op">)</span><span class="op">)</span>, 
         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## add the counts for each health district together </span>
  <span class="fu">summarise</span><span class="op">(</span>population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## remove the grouping so can calculate overall proportion</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">population</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## plot pyramid </span>
  <span class="fu">age_pyramid</span><span class="op">(</span>
            age_group <span class="op">=</span> <span class="va">age_group</span>, 
            split_by <span class="op">=</span> <span class="va">sex</span>, 
            count <span class="op">=</span> <span class="va">proportion</span>, 
            proportional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## only show the y axis label (otherwise repeated in all three plots)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Source population"</span>, 
       y <span class="op">=</span> <span class="st">""</span>, 
       x <span class="op">=</span> <span class="st">"Age group (years)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## make the x axis the same for all plots </span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, 
    limits <span class="op">=</span> <span class="va">limits</span>, 
    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span>
  
  
<span class="co">## plot the unweighted sample population </span>
<span class="va">sample_population</span> <span class="op">&lt;-</span> <span class="fu">plot_age_pyramid</span><span class="op">(</span><span class="va">survey_data</span>, 
                 age_group <span class="op">=</span> <span class="st">"age_group"</span>, 
                 split_by <span class="op">=</span> <span class="st">"sex"</span>,
                 proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## only show the x axis label (otherwise repeated in all three plots)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Unweighted sample population"</span>, 
       y <span class="op">=</span> <span class="st">"Proportion (%)"</span>, 
       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## make the x axis the same for all plots </span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, 
    limits <span class="op">=</span> <span class="va">limits</span>, 
    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span>


<span class="co">## plot the weighted sample population </span>
<span class="va">weighted_population</span> <span class="op">&lt;-</span> <span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="co">## make sure the variables are factors</span>
  <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span>, 
         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">plot_age_pyramid</span><span class="op">(</span>
    age_group <span class="op">=</span> <span class="st">"age_group"</span>,
    split_by <span class="op">=</span> <span class="st">"sex"</span>, 
    proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## only show the x axis label (otherwise repeated in all three plots)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weighted sample population"</span>, 
       y <span class="op">=</span> <span class="st">""</span>, 
       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="co">## make the x axis the same for all plots </span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, 
    limits <span class="op">=</span> <span class="va">limits</span>, 
    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span>

<span class="co">## combine all three plots  ----------------------------------------------------</span>
<span class="co">## combine three plots next to eachother using + </span>
<span class="va">source_population</span> <span class="op">+</span> <span class="va">sample_population</span> <span class="op">+</span> <span class="va">weighted_population</span> <span class="op">+</span> 
  <span class="co">## only show one legend and define theme </span>
  <span class="co">## note the use of &amp; for combining theme with plot_layout()</span>
  <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span> 
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span>
        legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,                <span class="co"># remove title</span>
        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,                <span class="co"># change text size</span>
        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># turn x-axis text</span>
       <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/weighted_age_pyramid-1.png" width="1440"></div>
</div>
<div id="sơ-đồ-alluvialsankey" class="section level3" number="26.7.3">
<h3>
<span class="header-section-number">26.7.3</span> Sơ đồ alluvial/sankey<a class="anchor" aria-label="anchor" href="#s%C6%A1-%C4%91%E1%BB%93-alluvialsankey"><i class="fas fa-link"></i></a>
</h3>
<p>Trực quan điểm bắt đầu và kết quả của từng cá nhân có thể rất hữu ích để có được cái nhìn tổng quan. Có một ứng dụng khá rõ ràng cho quần thể di động, tuy nhiên có rất nhiều ứng dụng khác như nhóm thuần tập hoặc bất kỳ tình huống nào khác trong đó có sự chuyển đổi ở các trạng thái của các cá nhân. Các sơ đồ này có một số tên khác nhau bao gồm các tập hợp alluvial, sankey và parallel - chi tiết có trong chương sổ tay về <a href="diagrams.html#diagrams">Sơ đồ và biểu đồ</a>.</p>
<div class="sourceCode" id="cb1249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## summarize data</span>
<span class="va">flow_table</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">startcause</span>, <span class="va">endcause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># get counts </span>
  <span class="fu">gather_set_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"startcause"</span>, <span class="st">"endcause"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># change format for plotting</span>
  <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"startcause"</span>, <span class="st">"endcause"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># set startcause as first level</span>
         x <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span><span class="va">x</span>, 
                        <span class="st">"Start \n cause"</span> <span class="op">=</span> <span class="st">"startcause"</span>,   <span class="co"># add line break (\n) after start</span>
                        <span class="st">"End \n cause"</span>   <span class="op">=</span> <span class="st">"endcause"</span><span class="op">)</span>
        <span class="op">)</span>


<span class="co">## plot your dataset </span>
  <span class="co">## on the x axis is the start and end causes</span>
  <span class="co">## gather_set_data generates an ID for each possible combination</span>
  <span class="co">## splitting by y gives the possible start/end combos</span>
  <span class="co">## value as n gives it as counts (could also be changed to proportion)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">flow_table</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, id <span class="op">=</span> <span class="va">id</span>, split <span class="op">=</span> <span class="va">y</span>, value <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## colour lines by sex </span>
  <span class="fu">geom_parallel_sets</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, axis.width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## fill in the label boxes grey</span>
  <span class="fu">geom_parallel_sets_axes</span><span class="op">(</span>axis.width <span class="op">=</span> <span class="fl">0.15</span>, fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## change text colour and angle (needs to be adjusted)</span>
  <span class="fu">geom_parallel_sets_labels</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, angle <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## adjusted y and x axes (probably needs more vertical space)</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## remove axis labels</span>
  <span class="fu">theme</span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span><span class="op">)</span>,
    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span><span class="op">)</span>,
    axis.line <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span>
    legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,                <span class="co"># remove title</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/visualise_population_flow-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="tỷ-lệ-được-áp-dụng-trọng-số" class="section level2" number="26.8">
<h2>
<span class="header-section-number">26.8</span> Tỷ lệ được áp dụng trọng số<a class="anchor" aria-label="anchor" href="#t%E1%BB%B7-l%E1%BB%87-%C4%91%C6%B0%E1%BB%A3c-%C3%A1p-d%E1%BB%A5ng-tr%E1%BB%8Dng-s%E1%BB%91"><i class="fas fa-link"></i></a>
</h2>
<p>Phần này sẽ trình bày chi tiết cách tạo bảng cho số lượng và tỷ lệ được áp dụng trọng số, với khoảng tin cậy và hệ số thiết kế liên quan. Có bốn tùy chọn khác nhau sử dụng các hàm từ các packages sau: <strong>survey</strong>, <strong>srvyr</strong>, <strong>sitrep</strong> và <strong>gtsummary</strong>. Để tạo ra một bảng dịch tễ học tiêu chuẩn với code tối giản, chúng tôi khuyên bạn nên dùng hàm <strong>sitrep</strong> - là một hàm có code gọn hơn của <strong>srvyr</strong>; Tuy nhiên, lưu ý rằng hàm này chưa có trên CRAN và có thể thay đổi trong tương lai. Mặt khác, code của <strong>survey</strong> có thể là code ổn định nhất trong thời gian dài, trong khi <strong>srvyr</strong> sẽ phù hợp nhất đối với các luồng công việc sử dụng tidyverse. Mặc dù các hàm <strong>gtsummary</strong> có rất nhiều tiềm năng, nhưng chúng vẫn đang được thử nghiệm và chưa hoàn thiện tại thời điểm viết chương này.</p>
<div id="package-survey-1" class="section level3" number="26.8.1">
<h3>
<span class="header-section-number">26.8.1</span> Package <strong>survey</strong><a class="anchor" aria-label="anchor" href="#package-survey-1"><i class="fas fa-link"></i></a>
</h3>
<p>Chúng ta có thể sử dụng hàm <code>svyciprop()</code> từ <strong>survey</strong> để lấy tỷ lệ có trọng số và khoảng tin cậy 95% đi kèm. Một hệ số thiết kế thích hợp có thể được trích xuất bằng cách sử dụng hàm <code>svymean()</code> chứ không phải hàm <code>svyprop()</code>. Cần lưu ý rằng <code>svyprop()</code> dường như chỉ chấp nhận các biến có giá trị từ 0 đến 1 (hoặc TRUE/FALSE), vì vậy các biến phân loại sẽ không hoạt động.</p>
<p><span style="color: black;"><strong><em>LƯU Ý:</em></strong> Các hàm từ <strong>survey</strong> cũng chấp nhận các đối tượng thiết kế từ <strong>srvyr</strong>, nhưng ở đây chúng tôi đã sử dụng đối tượng thiết kế từ package <strong>survey</strong> với mục đích tạo sự nhất quán</span></p>
<div class="sourceCode" id="cb1250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## produce weighted counts </span>
<span class="fu">svytable</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span><span class="op">)</span></code></pre></div>
<pre><code>## died
##      FALSE       TRUE 
## 1406244.43   76213.01</code></pre>
<div class="sourceCode" id="cb1252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## produce weighted proportions</span>
<span class="fu">svyciprop</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>##               2.5% 97.5%
## died 0.0514 0.0208  0.12</code></pre>
<div class="sourceCode" id="cb1254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get the design effect </span>
<span class="fu">svymean</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span>, deff <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">deff</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## diedFALSE  diedTRUE 
##  3.755508  3.755508</code></pre>
<p>Chúng ta có thể kết hợp các hàm từ <strong>survey</strong> được hiển thị ở trên với một hàm mà chúng ta tự định nghĩa như bên dưới, được gọi là <code>svy_prop</code>; và sau đó chúng ta có thể sử dụng hàm đó cùng với hàm <code>map()</code> từ package <strong>purrr</strong> để lặp qua một số biến và tạo một bảng. Xem chương <a href="iteration.html#iteration">Lặp, vòng lặp, và danh sách</a> để biết chi tiết về <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define function to calculate weighted counts, proportions, CI and design effect</span>
<span class="co"># x is the variable in quotation marks </span>
<span class="co"># design is your survey design object</span>

<span class="va">svy_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co">## put the variable of interest in a formula </span>
  <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="co">## only keep the TRUE column of counts from svytable</span>
  <span class="va">weighted_counts</span> <span class="op">&lt;-</span> <span class="fu">svytable</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
  <span class="co">## calculate proportions (multiply by 100 to get percentages)</span>
  <span class="va">weighted_props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="co">## extract the confidence intervals and multiply to get percentages</span>
  <span class="va">weighted_confint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">weighted_props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="co">## use svymean to calculate design effect and only keep the TRUE column</span>
  <span class="va">design_eff</span> <span class="op">&lt;-</span> <span class="fu">deff</span><span class="op">(</span><span class="fu">svymean</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="cn">TRUE</span><span class="op">]</span><span class="op">]</span>
  
  <span class="co">## combine in to one data frame</span>
  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
    <span class="st">"Variable"</span>        <span class="op">=</span> <span class="va">x</span>,
    <span class="st">"Count"</span>           <span class="op">=</span> <span class="va">weighted_counts</span>,
    <span class="st">"Proportion"</span>      <span class="op">=</span> <span class="va">weighted_props</span>,
    <span class="va">weighted_confint</span>, 
    <span class="st">"Design effect"</span>   <span class="op">=</span> <span class="va">design_eff</span>
    <span class="op">)</span>
  
  <span class="co">## return table as a dataframe</span>
  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">full_table</span>, 
             <span class="co">## remove the variable names from rows (is a separate column now)</span>
             row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  
  <span class="co">## change numerics back to numeric</span>
  <span class="va">full_table</span><span class="op">[</span> , <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">full_table</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>
  
  <span class="co">## return dataframe</span>
  <span class="va">full_table</span>
<span class="op">}</span>

<span class="co">## iterate over several variables to create a table </span>
<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
  <span class="co">## define variables of interest</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, 
  <span class="co">## state function using and arguments for that function (design)</span>
  <span class="va">svy_prop</span>, design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## collapse list in to a single data frame</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## round </span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   Variable    Count Proportion X2.5. X97.5. Design.effect
## 1     left 701199.1       47.3  39.2   55.5           2.4
## 2     died  76213.0        5.1   2.1   12.1           3.8
## 3  arrived 761799.0       51.4  40.9   61.7           3.9</code></pre>
</div>
<div id="package-srvyr-1" class="section level3" number="26.8.2">
<h3>
<span class="header-section-number">26.8.2</span> Package <strong>srvyr</strong><a class="anchor" aria-label="anchor" href="#package-srvyr-1"><i class="fas fa-link"></i></a>
</h3>
<p>Với <strong>srvyr</strong> chúng ta có thể sử dụng cú pháp của package <strong>dplyr</strong> để tạo một bảng. Lưu ý rằng hàm <code>survey_mean()</code> được sử dụng, đối số tỷ lệ được chỉ định và hàm tương tự cũng được sử dụng để tính toán hệ số thiết kế. Điều này là do <strong>srvyr</strong> bao gồm cả hai hàm <code>svyciprop()</code> và <code>svymean()</code> của package <strong>survey</strong> được sử dụng trong phần trên.</p>
<p><span style="color: black;"><strong><em>LƯU Ý:</em></strong> Có vẻ như không thể lấy tỷ lệ từ các biến phân loại bằng <strong>srvyr</strong>, nếu bạn cần điều này, hãy xem phần bên dưới sử dụng <strong>sitrep</strong></span></p>
<div class="sourceCode" id="cb1258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## use the srvyr design object</span>
<span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    <span class="co">## produce the weighted counts </span>
    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">died</span><span class="op">)</span>, 
    <span class="co">## produce weighted proportions and confidence intervals </span>
    <span class="co">## multiply by 100 to get a percentage </span>
    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, 
                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, 
                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
    <span class="co">## produce the design effect </span>
    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## only keep the rows of interest</span>
  <span class="co">## (drop standard errors and repeat proportion calculation)</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span></code></pre></div>
<pre><code>##     counts    props props_low props_upp deff_deff
## 1 76213.01 5.140991  2.082773  12.13328  3.755508</code></pre>
<p>Ở đây, chúng ta cũng có thể viết một hàm để sau đó lặp qua nhiều biến bằng cách sử dụng package <strong>purrr</strong>. Xem chương <a href="iteration.html#iteration">Lặp, vòng lặp, và danh sách</a> trong sổ tay này để biết chi tiết về <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define function to calculate weighted counts, proportions, CI and design effect</span>
<span class="co"># design is your survey design object</span>
<span class="co"># x is the variable in quotation marks </span>


<span class="va">srvyr_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu">summarise</span><span class="op">(</span>
    <span class="co">## using the survey design object</span>
    <span class="va">design</span>, 
    <span class="co">## produce the weighted counts </span>
    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, 
    <span class="co">## produce weighted proportions and confidence intervals </span>
    <span class="co">## multiply by 100 to get a percentage </span>
    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, 
                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, 
                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
    <span class="co">## produce the design effect </span>
    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## add in the variable name</span>
  <span class="fu">mutate</span><span class="op">(</span>variable <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## only keep the rows of interest</span>
  <span class="co">## (drop standard errors and repeat proportion calculation)</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">variable</span>, <span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span>
  
<span class="op">}</span>
  

<span class="co">## iterate over several variables to create a table </span>
<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
  <span class="co">## define variables of interest</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, 
  <span class="co">## state function using and arguments for that function (design)</span>
  <span class="op">~</span><span class="fu">srvyr_prop</span><span class="op">(</span><span class="va">.x</span>, design <span class="op">=</span> <span class="va">survey_design</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## collapse list in to a single data frame</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##   variable    counts     props props_low props_upp deff_deff
## 1     left 701199.14 47.299782 39.235598  55.50736  2.379761
## 2     died  76213.01  5.140991  2.082773  12.13328  3.755508
## 3  arrived 761799.05 51.387583 40.927349  61.72766  3.925504</code></pre>
</div>
<div id="package-sitrep" class="section level3" number="26.8.3">
<h3>
<span class="header-section-number">26.8.3</span> Package <strong>sitrep</strong><a class="anchor" aria-label="anchor" href="#package-sitrep"><i class="fas fa-link"></i></a>
</h3>
<p>Hàm <code>tab_survey()</code> từ <strong>sitrep</strong> là một hàm gọn hơn cho <strong>srvyr</strong>, cho phép bạn tạo các bảng có trọng số với code tối giản. Nó cũng cho phép bạn tính toán tỷ lệ có trọng số cho các biến phân loại.</p>
<div class="sourceCode" id="cb1262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## using the survey design object</span>
<span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="co">## pass the names of variables of interest unquoted</span>
  <span class="fu">tab_survey</span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span>, <span class="va">education_level</span>,
             deff <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># calculate the design effect</span>
             pretty <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># merge the proportion and 95%CI</span>
             <span class="op">)</span></code></pre></div>
<pre><code>## Warning: removing 257 missing value(s) from `education_level`</code></pre>
<pre><code>## # A tibble: 9 x 5
##   variable        value            n  deff ci                
##   &lt;chr&gt;           &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             
## 1 arrived         TRUE       761799.  3.93 51.4% (40.9--61.7)
## 2 arrived         FALSE      720658.  3.93 48.6% (38.3--59.1)
## 3 left            TRUE       701199.  2.38 47.3% (39.2--55.5)
## 4 left            FALSE      781258.  2.38 52.7% (44.5--60.8)
## 5 died            TRUE        76213.  3.76 5.1% (2.1--12.1)  
## 6 died            FALSE     1406244.  3.76 94.9% (87.9--97.9)
## 7 education_level higher     171644.  4.70 42.4% (26.9--59.7)
## 8 education_level primary    102609.  2.37 25.4% (16.2--37.3)
## 9 education_level secondary  130201.  6.68 32.2% (16.5--53.3)</code></pre>
</div>
<div id="package-gtsummary" class="section level3" number="26.8.4">
<h3>
<span class="header-section-number">26.8.4</span> Package <strong>gtsummary</strong><a class="anchor" aria-label="anchor" href="#package-gtsummary"><i class="fas fa-link"></i></a>
</h3>
<p>Với <strong>gtsummary</strong>, dường như vẫn chưa có hàm sẵn có để thêm khoảng tin cậy hoặc hệ số thiết kế. Ở đây chúng tôi trình bày cách định nghĩa một hàm để thêm khoảng tin cậy và sau đó thêm khoảng tin cậy vào bảng được tạo bằng <strong>gtsummary</strong> với hàm <code>tbl_svysummary()</code>.</p>
<div class="sourceCode" id="cb1265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">confidence_intervals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable</span>, <span class="va">by</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co">## extract the confidence intervals and multiply to get percentages</span>
  <span class="va">props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">variable</span><span class="op">)</span><span class="op">)</span>,
              <span class="va">data</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co">## extract the confidence intervals </span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">## make numeric and multiply for percentage</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>           <span class="co">## round to one digit</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>                           <span class="co">## extract the numbers from matrix</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>          <span class="co">## combine to single character</span>
<span class="op">}</span>

<span class="co">## using the survey package design object</span>
<span class="fu">tbl_svysummary</span><span class="op">(</span><span class="va">base_survey_design</span>, 
               include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span><span class="op">)</span>,   <span class="co">## define variables want to include</span>
               statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"{n} ({p}%)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">## define stats of interest</span>
  <span class="fu">add_n</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">## add the weighted total </span>
  <span class="fu">add_stat</span><span class="op">(</span>fns <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="va">confidence_intervals</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">## add CIs</span>
  <span class="co">## modify the column headers</span>
  <span class="fu">modify_header</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="va">n</span> <span class="op">~</span> <span class="st">"**Weighted total (N)**"</span>,
      <span class="va">stat_0</span> <span class="op">~</span> <span class="st">"**Weighted Count**"</span>,
      <span class="va">add_stat_1</span> <span class="op">~</span> <span class="st">"**95%CI**"</span>
    <span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#steyhhsgfm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#steyhhsgfm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#steyhhsgfm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#steyhhsgfm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#steyhhsgfm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#steyhhsgfm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#steyhhsgfm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#steyhhsgfm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#steyhhsgfm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#steyhhsgfm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#steyhhsgfm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#steyhhsgfm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#steyhhsgfm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#steyhhsgfm .gt_from_md > :first-child {
  margin-top: 0;
}

#steyhhsgfm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#steyhhsgfm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#steyhhsgfm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#steyhhsgfm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#steyhhsgfm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#steyhhsgfm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#steyhhsgfm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#steyhhsgfm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#steyhhsgfm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#steyhhsgfm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#steyhhsgfm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#steyhhsgfm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#steyhhsgfm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#steyhhsgfm .gt_left {
  text-align: left;
}

#steyhhsgfm .gt_center {
  text-align: center;
}

#steyhhsgfm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#steyhhsgfm .gt_font_normal {
  font-weight: normal;
}

#steyhhsgfm .gt_font_bold {
  font-weight: bold;
}

#steyhhsgfm .gt_font_italic {
  font-style: italic;
}

#steyhhsgfm .gt_super {
  font-size: 65%;
}

#steyhhsgfm .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="steyhhsgfm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Weighted total (N)</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">
<strong>Weighted Count</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95%CI</strong></th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">arrived</td>
      <td class="gt_row gt_center">1,482,457</td>
      <td class="gt_row gt_center">761,799 (51%)</td>
      <td class="gt_row gt_center">40.9-61.7</td>
    </tr>
<tr>
<td class="gt_row gt_left">left</td>
      <td class="gt_row gt_center">1,482,457</td>
      <td class="gt_row gt_center">701,199 (47%)</td>
      <td class="gt_row gt_center">39.2-55.5</td>
    </tr>
<tr>
<td class="gt_row gt_left">died</td>
      <td class="gt_row gt_center">1,482,457</td>
      <td class="gt_row gt_center">76,213 (5.1%)</td>
      <td class="gt_row gt_center">2.1-12.1</td>
    </tr>
</tbody>
<tfoot><tr class="gt_footnotes">
<td colspan="4">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks"><em>1</em>
          </sup>
           
          n (%)
          <br></p>
      </td>
    </tr></tfoot>
</table></div></div>
<!-- ======================================================= -->
</div>
</div>
<div id="tỷ-suất-được-áp-dụng-trọng-số" class="section level2" number="26.9">
<h2>
<span class="header-section-number">26.9</span> Tỷ suất được áp dụng trọng số<a class="anchor" aria-label="anchor" href="#t%E1%BB%B7-su%E1%BA%A5t-%C4%91%C6%B0%E1%BB%A3c-%C3%A1p-d%E1%BB%A5ng-tr%E1%BB%8Dng-s%E1%BB%91"><i class="fas fa-link"></i></a>
</h2>
<p>Tương tự đối với các tỷ lệ được áp dụng trọng số (chẳng hạn như tỷ lệ tử vong), bạn có thể sử dụng package <strong>survey</strong> hoặc <strong>srvyr</strong>. Tương tự, bạn có thể viết các hàm (tương tự như ở trên) để lặp qua một số biến. Bạn cũng có thể tạo một hàm cho <strong>gtsummary</strong> như trên nhưng hiện tại nó không có chức năng sẵn có.</p>
<div id="package-survey-2" class="section level3" number="26.9.1">
<h3>
<span class="header-section-number">26.9.1</span> Package <strong>survey</strong><a class="anchor" aria-label="anchor" href="#package-survey-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu">svyratio</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, 
         denominator <span class="op">=</span> <span class="op">~</span><span class="va">obstime</span>, 
         design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span>

<span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
  <span class="va">ratio</span><span class="op">$</span><span class="va">ratio</span> <span class="op">*</span> <span class="fl">10000</span>, 
  <span class="va">ci</span> <span class="op">*</span> <span class="fl">10000</span>
<span class="op">)</span></code></pre></div>
<pre><code>##       obstime    2.5 %   97.5 %
## died 5.981922 1.194294 10.76955</code></pre>
</div>
<div id="package-srvyr-2" class="section level3" number="26.9.2">
<h3>
<span class="header-section-number">26.9.2</span> Package <strong>srvyr</strong><a class="anchor" aria-label="anchor" href="#package-srvyr-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="co">## survey ratio used to account for observation time </span>
  <span class="fu">summarise</span><span class="op">(</span>
    mortality <span class="op">=</span> <span class="fu">survey_ratio</span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">died</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span>, 
      <span class="va">obstime</span>, 
      vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<pre><code>##   mortality mortality_low mortality_upp
## 1  5.981922     0.3490176      11.61483</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="tài-nguyên-học-liệu-9" class="section level2" number="26.10">
<h2>
<span class="header-section-number">26.10</span> Tài nguyên học liệu<a class="anchor" aria-label="anchor" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-9"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://stats.idre.ucla.edu/r/seminars/survey-data-analysis-with-r/">UCLA stats page</a></p>
<p><a href="http://asdfree.com/">Analyze survey data free</a></p>
<p><a href="http://gdfe.co/srvyr/">srvyr packge</a></p>
<p><a href="http://www.danieldsjoberg.com/gtsummary/reference/index.html">gtsummary package</a></p>
<p><a href="https://github.com/EPIET/RapidAssessmentSurveys">EPIET survey case studies</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="contact-tracing.html"><span class="header-section-number">25</span> Truy vết tiếp xúc</a></div>
<div class="next"><a href="survival-analysis.html"><span class="header-section-number">27</span> Phân tích sống còn</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-analysis"><span class="header-section-number">26</span> Phân tích khảo sát</a></li>
<li><a class="nav-link" href="#t%E1%BB%95ng-quan-4"><span class="header-section-number">26.1</span> Tổng quan</a></li>
<li>
<a class="nav-link" href="#chu%E1%BA%A9n-b%E1%BB%8B-16"><span class="header-section-number">26.2</span> Chuẩn bị</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#packages-2">Packages</a></li>
<li><a class="nav-link" href="#n%E1%BA%A1p-d%E1%BB%AF-li%E1%BB%87u">Nạp dữ liệu</a></li>
<li><a class="nav-link" href="#l%C3%A0m-s%E1%BA%A1ch-d%E1%BB%AF-li%E1%BB%87u-2">Làm sạch dữ liệu</a></li>
</ul>
</li>
<li><a class="nav-link" href="#d%E1%BB%AF-li%E1%BB%87u-kh%E1%BA%A3o-s%C3%A1t"><span class="header-section-number">26.3</span> Dữ liệu khảo sát</a></li>
<li><a class="nav-link" href="#th%E1%BB%9Di-gian-quan-s%C3%A1t"><span class="header-section-number">26.4</span> Thời gian quan sát</a></li>
<li><a class="nav-link" href="#%C3%A1p-d%E1%BB%A5ng-tr%E1%BB%8Dng-s%E1%BB%91"><span class="header-section-number">26.5</span> Áp dụng trọng số</a></li>
<li>
<a class="nav-link" href="#%C4%91%E1%BB%91i-t%C6%B0%E1%BB%A3ng-theo-thi%E1%BA%BFt-k%E1%BA%BF-nghi%C3%AAn-c%E1%BB%A9u"><span class="header-section-number">26.6</span> Đối tượng theo thiết kế nghiên cứu</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#package-survey"><span class="header-section-number">26.6.1</span> Package Survey</a></li>
<li><a class="nav-link" href="#package-srvyr"><span class="header-section-number">26.6.2</span> Package Srvyr</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ph%C3%A2n-t%C3%ADch-m%C3%B4-t%E1%BA%A3-3"><span class="header-section-number">26.7</span> Phân tích mô tả</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sai-s%E1%BB%91-ch%E1%BB%8Dn-m%E1%BA%ABu"><span class="header-section-number">26.7.1</span> Sai số chọn mẫu</a></li>
<li><a class="nav-link" href="#th%C3%A1p-d%C3%A2n-s%E1%BB%91"><span class="header-section-number">26.7.2</span> Tháp dân số</a></li>
<li><a class="nav-link" href="#s%C6%A1-%C4%91%E1%BB%93-alluvialsankey"><span class="header-section-number">26.7.3</span> Sơ đồ alluvial/sankey</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#t%E1%BB%B7-l%E1%BB%87-%C4%91%C6%B0%E1%BB%A3c-%C3%A1p-d%E1%BB%A5ng-tr%E1%BB%8Dng-s%E1%BB%91"><span class="header-section-number">26.8</span> Tỷ lệ được áp dụng trọng số</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#package-survey-1"><span class="header-section-number">26.8.1</span> Package survey</a></li>
<li><a class="nav-link" href="#package-srvyr-1"><span class="header-section-number">26.8.2</span> Package srvyr</a></li>
<li><a class="nav-link" href="#package-sitrep"><span class="header-section-number">26.8.3</span> Package sitrep</a></li>
<li><a class="nav-link" href="#package-gtsummary"><span class="header-section-number">26.8.4</span> Package gtsummary</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#t%E1%BB%B7-su%E1%BA%A5t-%C4%91%C6%B0%E1%BB%A3c-%C3%A1p-d%E1%BB%A5ng-tr%E1%BB%8Dng-s%E1%BB%91"><span class="header-section-number">26.9</span> Tỷ suất được áp dụng trọng số</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#package-survey-2"><span class="header-section-number">26.9.1</span> Package survey</a></li>
<li><a class="nav-link" href="#package-srvyr-2"><span class="header-section-number">26.9.2</span> Package srvyr</a></li>
</ul>
</li>
<li><a class="nav-link" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-9"><span class="header-section-number">26.10</span> Tài nguyên học liệu</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2021-09-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
