<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>30 ggplot cơ bản | Cẩm nang dịch tễ học với R</title>
<meta name="author" content="the handbook team">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6.4/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.16/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<script src="libs/tabwid-1.0.0/tabwid.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-1.52.2/plotly-basic-1.52.2.min.js"></script><script src="libs/plotly-cartesian-1.52.2/plotly-cartesian-1.52.2.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-8.1.2/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-8.1.2/highcharts.js"></script><script src="libs/highcharts-8.1.2/highcharts-3d.js"></script><script src="libs/highcharts-8.1.2/highcharts-more.js"></script><script src="libs/highcharts-8.1.2/modules/stock.js"></script><script src="libs/highcharts-8.1.2/modules/map.js"></script><script src="libs/highcharts-8.1.2/modules/annotations.js"></script><script src="libs/highcharts-8.1.2/modules/data.js"></script><script src="libs/highcharts-8.1.2/modules/drilldown.js"></script><script src="libs/highcharts-8.1.2/modules/item-series.js"></script><script src="libs/highcharts-8.1.2/modules/offline-exporting.js"></script><script src="libs/highcharts-8.1.2/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-8.1.2/modules/exporting.js"></script><script src="libs/highcharts-8.1.2/modules/export-data.js"></script><script src="libs/highcharts-8.1.2/modules/funnel.js"></script><script src="libs/highcharts-8.1.2/modules/heatmap.js"></script><script src="libs/highcharts-8.1.2/modules/treemap.js"></script><script src="libs/highcharts-8.1.2/modules/sankey.js"></script><script src="libs/highcharts-8.1.2/modules/dependency-wheel.js"></script><script src="libs/highcharts-8.1.2/modules/organization.js"></script><script src="libs/highcharts-8.1.2/modules/solid-gauge.js"></script><script src="libs/highcharts-8.1.2/modules/streamgraph.js"></script><script src="libs/highcharts-8.1.2/modules/sunburst.js"></script><script src="libs/highcharts-8.1.2/modules/vector.js"></script><script src="libs/highcharts-8.1.2/modules/wordcloud.js"></script><script src="libs/highcharts-8.1.2/modules/xrange.js"></script><script src="libs/highcharts-8.1.2/modules/tilemap.js"></script><script src="libs/highcharts-8.1.2/modules/venn.js"></script><script src="libs/highcharts-8.1.2/modules/gantt.js"></script><script src="libs/highcharts-8.1.2/modules/timeline.js"></script><script src="libs/highcharts-8.1.2/modules/parallel-coordinates.js"></script><script src="libs/highcharts-8.1.2/modules/bullet.js"></script><script src="libs/highcharts-8.1.2/modules/coloraxis.js"></script><script src="libs/highcharts-8.1.2/modules/dumbbell.js"></script><script src="libs/highcharts-8.1.2/modules/lollipop.js"></script><script src="libs/highcharts-8.1.2/modules/series-label.js"></script><script src="libs/highcharts-8.1.2/plugins/motion.js"></script><script src="libs/highcharts-8.1.2/custom/reset.js"></script><script src="libs/highcharts-8.1.2/modules/boost.js"></script><script src="libs/highchart-binding-0.8.2/highchart.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Về cuốn sách này</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> Biên tập và ghi chú kỹ thuật</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> Tải sách và dữ liệu</a></li>
<li class="book-part">Nhập môn về R</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R Cơ bản</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Chuyển đổi sang R</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> Package đề xuất</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Dự án R</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> Nhập xuất dữ liệu</a></li>
<li class="book-part">Quản lý dữ liệu</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> Làm sạch số liệu và các hàm quan trọng</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> Làm việc với ngày tháng</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> Ký tự và chuỗi</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factors</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> Xoay trục dữ liệu</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> Nhóm dữ liệu</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> Nối dữ liệu</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> Loại bỏ trùng lặp</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> Lặp, vòng lặp, và danh sách</a></li>
<li class="book-part">Phân tích dữ liệu</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> Bảng mô tả</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> Các kiểm định thống kê cơ bản</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> Hồi quy đơn và đa biến</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Dữ liệu Missing</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> Tỷ suất chuẩn hóa</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> Đường trung bình động</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> Chuỗi thời gian và phát hiện ổ dịch</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> Mô hình hóa dịch bệnh</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> Truy vết tiếp xúc</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Phân tích khảo sát</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Phân tích sống còn</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS cơ bản</a></li>
<li class="book-part">Trực quan hóa dữ liệu</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> Trình bày bảng</a></li>
<li><a class="active" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot cơ bản</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Các tips với ggplot</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> Đường cong dịch bệnh</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> Tháp dân số và thang đo Likert</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> Biểu đồ nhiệt</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> Sơ đồ và biểu đồ</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> Biểu đồ kết hợp</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Chuỗi lây nhiễm</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> Cây phả hệ</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Biểu đồ tương tác</a></li>
<li class="book-part">Báo cáo và dashboards</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> Báo cáo với R Markdown</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> Tổ chức báo cáo định kỳ</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> Dashboards với R Markdown</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Dashboards với Shiny</a></li>
<li class="book-part">Tổng hợp</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> Viết hàm</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> Tương tác với thư mục làm việc</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Version control với Git và Github</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> Các lỗi thường gặp</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> Nhờ sự trợ giúp</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> R trên ổ cứng mạng</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot-basics" class="section level1" number="30">
<h1>
<span class="header-section-number">30</span> ggplot cơ bản<a class="anchor" aria-label="anchor" href="#ggplot-basics"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/ggplot_basics_top.png" width="100%" style="display: block; margin: auto;"></div>
<p><strong>ggplot2</strong> là một package dùng để trực quan hóa dữ liệu phổ biến nhất trong R. Các hàm <code>ggplot()</code> là nền tảng của package này, và toàn bộ cách tiếp cận này thường được gọi là <em>“ggplot”</em> với các số liệu kết quả đôi khi được gọi trìu mến là “ggplots”. Chữ “gg” bắt nguồn từ chữ “<strong>g</strong>rammar of <strong>g</strong>raphics” (ngữ pháp đồ thị) dùng để xây dựng các biểu đồ. <strong>ggplot2</strong> được hưởng lợi từ nhiều package R bổ sung giúp nâng cao hơn nữa chức năng của nó.</p>
<p>Cú pháp của nó khác biệt đáng kể so với vẽ biểu đồ bằng <strong>base</strong> <code>R</code>, cũng như có một đường cong học tập gắn với nó. Sử dụng <strong>ggplot2</strong> thông thường yêu cầu người sử dụng phải định dạng lại dữ liệu của họ để tương thích với <strong>tidyverse</strong>, giúp cho việc sử dụng các packages này cùng nhau một cách có hiệu quả.</p>
<p>Trong chương này, chúng tôi sẽ trình bày các nguyên tắc cơ bản về vẽ biểu đồ bằng <strong>ggplot2</strong>. Xem chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> để biết các gợi ý và các kỹ thuật nâng cao giúp cho biểu đồ của bạn thực sự trông đẹp mắt.</p>
<p>Có một số hướng dẫn <strong>ggplot2</strong> mở rộng được liên kết trong phần tài nguyên học liệu. Bạn cũng có thể tải xuống <a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">trực quan hóa dữ liệu với ggplot cheatsheet</a> từ trang web của RStudio. Nếu bạn muốn có cảm hứng cho các cách trực quan hóa dữ liệu của mình một cách sáng tạo, chúng tôi khuyên bạn nên ghé thăm các trang web như <a href="https://www.r-graph-gallery.com/">R graph gallery</a> và <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
<div id="chuẩn-bị-20" class="section level2" number="30.1">
<h2>
<span class="header-section-number">30.1</span> Chuẩn bị<a class="anchor" aria-label="anchor" href="#chu%E1%BA%A9n-b%E1%BB%8B-20"><i class="fas fa-link"></i></a>
</h2>
<div id="gọi-packages-9" class="section level3 unnumbered">
<h3>Gọi packages<a class="anchor" aria-label="anchor" href="#g%E1%BB%8Di-packages-9"><i class="fas fa-link"></i></a>
</h3>
<p>Đoạn code này hiển thị việc gọi các package cần thiết cho các phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh việc sử dụng hàm <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> từ package <strong>pacman</strong>, giúp cài đặt các package cần thiết <em>và</em> gọi chúng ra để sử dụng. Bạn cũng có thể gọi các packages đã cài đặt với hàm <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> của <strong>base</strong> R. Xem thêm chương <a href="basics.html#basics">R cơ bản</a> để có thêm thông tin về các packages trong R.</p>
<div class="sourceCode" id="cb1412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">tidyverse</span>,      <span class="co"># includes ggplot2 and other data management tools</span>
  <span class="va">rio</span>,            <span class="co"># import/export</span>
  <span class="va">here</span>,           <span class="co"># file locator</span>
  <span class="va">stringr</span>         <span class="co"># working with characters   </span>
<span class="op">)</span></code></pre></div>
</div>
<div id="nhập-dữ-liệu-15" class="section level3 unnumbered">
<h3>Nhập dữ liệu<a class="anchor" aria-label="anchor" href="#nh%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u-15"><i class="fas fa-link"></i></a>
</h3>
<p>Để bắt đầu, chúng ta nhập bộ dữ liệu có tên linelist đã làm sạch bao gồm các trường hợp từ vụ dịch Ebola mô phỏng. Để tiện theo dõi, <a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">bấm để tải dữ liệu linelist “đã được làm sạch” </a> (dưới dạng tệp .rds). Nhập dữ liệu bằng hàm <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> từ package <strong>rio</strong> (nó xử lý nhiều loại tệp như .xlsx, .csv, .rds - xem thêm chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết thêm chi tiết).</p>
<div class="sourceCode" id="cb1413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></code></pre></div>
<p>50 hàng đầu tiên của bộ dữ liệu được hiển thị như bên dưới. Chúng ta sẽ tập trung và hai biến liên tục là <code>age</code>, <code>wt_kg</code> (cân nặng được tính bằng kilogram), <code>ct_blood</code> (giá trị CT), và<code>days_onset_hosp</code> (sự khác biệt giữa ngày khởi phát và nhập viện).</p>
<div id="htmlwidget-d10ebf2f76812341a1f3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d10ebf2f76812341a1f3">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"disabled\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="làm-sạch-chung" class="section level3 unnumbered">
<h3>Làm sạch chung<a class="anchor" aria-label="anchor" href="#l%C3%A0m-s%E1%BA%A1ch-chung"><i class="fas fa-link"></i></a>
</h3>
<p>Khi chuẩn bị dữ liệu để vẽ biểu đồ, tốt nhất là làm cho dữ liệu tuân thủ <a href="https://r4ds.had.co.nz/tidy-data.html">tiêu chuẩn dữ liệu “gọn gàng”</a> nhất có thể. Để đạt được điều này, bạn có thể tham khảo chương <a href="cleaning.html#cleaning">Làm sạch số liệu và các hàm quan trọng</a> trong cuốn sổ tay này.</p>
<p>Một số cách đơn giản mà chúng ta có thể chuẩn bị dữ liệu của mình để tốt hơn cho việc vẽ biểu đồ, có thể bao gồm việc làm cho nội dung của dữ liệu hiển thị tốt hơn - điều này không nhất thiết phải tương đương với việc bạn chuẩn bị dữ liệu tốt hơn để thao tác với dữ liệu. Ví dụ:</p>
<ul>
<li>Thay thế giá trị <code>NA</code> trong cột kiểu ký tự thành “Unknown”<br>
</li>
<li>Cân nhắc chuyển đổi cột thành dạng <em>factor</em> để các giá trị của chúng được quy định một có thứ tự<br>
</li>
<li>Làm sạch một số cột để các giá trị “thân thiện với dữ liệu” của chúng với dấu gạch dưới, v.v. được thay đổi thành văn bản bình thường hoặc chữ hoa tiêu đề (xem chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>)</li>
</ul>
<p>Sau đây là một số ví dụ:</p>
<div class="sourceCode" id="cb1414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make display version of columns with more friendly names</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    gender_disp <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">~</span> <span class="st">"Male"</span>,        <span class="co"># m to Male </span>
                            <span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span> <span class="op">~</span> <span class="st">"Female"</span>,      <span class="co"># f to Female,</span>
                            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Unknown"</span><span class="op">)</span>,    <span class="co"># NA to Unknown</span>
    
    outcome_disp <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span>          <span class="co"># replace NA outcome with "unknown"</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="xoay-trục-dài-hơn" class="section level3 unnumbered">
<h3>Xoay trục dài hơn<a class="anchor" aria-label="anchor" href="#xoay-tr%E1%BB%A5c-d%C3%A0i-h%C6%A1n"><i class="fas fa-link"></i></a>
</h3>
<p>Về cấu trúc dữ liệu, đối với <strong>ggplot2</strong> chúng ta thường muốn xoay trục dữ liệu sang định dạng <em>dài hơn</em>. Xem thêm ở chương <a href="pivoting.html#pivoting">Xoay trục dữ liệu</a>.</p>
<div class="inline-figure"><img src="images/pivoting/pivot_longer_new.png" width="100%" style="display: block; margin: auto;"></div>
<p>Ví dụ, chúng ta muốn vẽ biểu đồ dữ liệu đang ở định dạng “ngang”, chẳng hạn từng trường hợp trong bộ dữ liệu <code>linelist</code> và các triệu chứng của chúng. Dưới đây chúng ta sẽ tạo một bộ dữ liệu nhỏ từ linelist gọi là <code>symptoms_data</code> chỉ chứa <code>case_id</code> và các cột triệu chứng.</p>
<div class="sourceCode" id="cb1415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symptoms_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Đây là 50 dòng đầu tiên của bộ dữ liệu mới được tạo ra - hãy xem cách chúng được định dạng lại với mỗi triệu chứng là một cột:</p>
<div id="htmlwidget-686a5f41bfd41e9ff59b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-686a5f41bfd41e9ff59b">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Nếu chúng ta muốn lập biểu đồ số trường hợp có các triệu chứng cụ thể, chúng ta bị giới hạn bởi thực tế là mỗi triệu chứng là một cột khác nhau. Tuy nhiên, chúng ta có thể <em>xoay</em> các cột triệu chứng sang một định dạng dài hơn như sau:</p>
<div class="sourceCode" id="cb1416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symptoms_data_long</span> <span class="op">&lt;-</span> <span class="va">symptoms_data</span> <span class="op">%&gt;%</span>    <span class="co"># begin with "mini" linelist called symptoms_data</span>
  
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                       <span class="co"># pivot all columns except case_id (all the symptoms columns)</span>
    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,             <span class="co"># assign name for new column that holds the symptoms</span>
    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># assign name for new column that holds the values (yes/no)</span>
  
  <span class="fu">mutate</span><span class="op">(</span>symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="co"># convert NA to "unknown"</span></code></pre></div>
<p>Dưới đây là danh sách 50 dòng đầu tiên. Lưu ý rằng với mỗi trường hợp sẽ có 5 dòng - mỗi dòng tương ứng với một triệu chứng có thể xảy ra. Các cột mới có tên <code>symptom_name</code> và <code>symptom_is_present</code> là kết quả của việc xoay trục dữ liệu. Lưu ý rằng định dạng này có thể không hữu ích cho các hoạt động khác, nhưng rất hữu ích cho việc vẽ biểu đồ.</p>
<div id="htmlwidget-e03bc6c7118af224f45d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e03bc6c7118af224f45d">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","5fe599","5fe599","5fe599","5fe599","8689b7","8689b7","8689b7","8689b7","8689b7","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","b8812a","b8812a","b8812a","b8812a","b8812a","893f25","893f25","893f25","893f25","893f25","be99c8","be99c8","be99c8","be99c8","be99c8","07e3e8","07e3e8","07e3e8","07e3e8","07e3e8","369449","369449","369449","369449","369449","f393b4","f393b4","f393b4","f393b4","f393b4","1389ca","1389ca","1389ca","1389ca","1389ca"],["fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit"],["no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","no","no","no","no","no","no","no","yes","no","yes","no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","no","no","yes","no","yes","no","no","yes","no","yes","no","no","yes","no","no"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>symptom_name<\/th>\n      <th>symptom_is_present<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="các-khái-niệm-cơ-bản-của-ggplot" class="section level2" number="30.2">
<h2>
<span class="header-section-number">30.2</span> Các khái niệm cơ bản của ggplot<a class="anchor" aria-label="anchor" href="#c%C3%A1c-kh%C3%A1i-ni%E1%BB%87m-c%C6%A1-b%E1%BA%A3n-c%E1%BB%A7a-ggplot"><i class="fas fa-link"></i></a>
</h2>
<p><strong>“Ngữ pháp đồ thị” - ggplot2</strong></p>
<p>Vẽ đồ thị với <strong>ggplot2</strong> dựa trên việc “thêm” các lớp đồ thị và các phần tử thiết kế chồng lên nhau, với mỗi lệnh được thêm vào các lệnh trước bằng một dấu cộng (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>). Kết quả là một đối tượng biểu đồ nhiều lớp có thể được lưu, sửa đổi, in, xuất ra, v.v.</p>
<p>Các đối tượng ggplot có thể rất phức tạp, nhưng thứ tự cơ bản của các lớp thường sẽ giống như sau:</p>
<ol style="list-style-type: decimal">
<li>Bắt đầu với lớp nền bằng lệnh <code>ggplot()</code> - lệnh này “mở” ggplot và cho phép các hàm tiếp theo được thêm vào với dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>. Thông thường, tập dữ liệu cũng được chỉ định trong lệnh này<br>
</li>
<li>Thêm các lớp “geom” - các hàm này trực quan hóa dữ liệu dưới dạng <em>geometries - hình học</em> (<em>shapes - hình dạng</em>), ví dụ: biểu đồ cột, biểu đồ đường, biểu đồ phân tán, histogram (hoặc là sự kết hợp giữa chúng!). Tất cả các hàm này đều bắt đầu với tiền tố <code>geom_</code>.<br>
</li>
<li>Thêm các yếu tố thiết kế vào đồ thị, chẳng hạn như nhãn trục, tiêu đề, phông chữ, kích thước, phối màu, chú giải hoặc xoay trục</li>
</ol>
<p>Một ví dụ đơn giản về bộ khung code như dưới đây. Chúng tôi sẽ giải thích từng cấu phần trong các phần bên dưới.</p>
<div class="sourceCode" id="cb1417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot data from my_data columns as red points</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">my_data</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># use the dataset "my_data"</span>
  <span class="fu">geom_point</span><span class="op">(</span>                             <span class="co"># add a layer of points (dots)</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">col1</span>, y <span class="op">=</span> <span class="va">col2</span><span class="op">)</span>,    <span class="co"># "map" data column to axes</span>
    color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># other specification for the geom</span>
  <span class="fu">labs</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                 <span class="co"># here you add titles, axes labels, etc.</span>
  <span class="fu">theme</span><span class="op">(</span><span class="op">)</span>                                 <span class="co"># here you adjust color, font, size etc of non-data plot elements (axes, title, etc.) </span></code></pre></div>
</div>
<div id="ggplot" class="section level2" number="30.3">
<h2>
<span class="header-section-number">30.3</span> <code>ggplot()</code><a class="anchor" aria-label="anchor" href="#ggplot"><i class="fas fa-link"></i></a>
</h2>
<p>Lệnh mở đầu của bất kỳ biểu đồ ggplot2 nào cũng là <code>ggplot()</code>. Lệnh này chỉ đơn giản là tạo ra một khung trống để thêm các lớp. Nó “mở ra” con đường cho các lớp tiếp theo được thêm vào với dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>.</p>
<p>Thông thường, lệnh <code>ggplot()</code> bao gồm đối số <code>data =</code> cho biểu đồ. Việc này giúp thiết lập bộ dữ liệu mặc định được sử dụng cho các lớp tiếp theo của biểu đồ.</p>
<p>Lệnh này sẽ kết thúc bằng một dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sau dấu ngoặc đơn đóng cuối cùng của hàm. Điều này giúp lệnh “mở” trở lại. ggplot sẽ chỉ thực thi/xuất hiện khi lệnh đầy đủ bao gồm một lớp cuối cùng mà <em>không có</em> dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> ở cuối.</p>
<div class="sourceCode" id="cb1418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This will create plot that is a blank canvas</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></code></pre></div>
</div>
<div id="geoms" class="section level2" number="30.4">
<h2>
<span class="header-section-number">30.4</span> Geoms<a class="anchor" aria-label="anchor" href="#geoms"><i class="fas fa-link"></i></a>
</h2>
<p>Một khung trống chắc chắn là không đủ - chúng ta cần tạo thêm các hình học (dạng) từ dữ liệu (vd: biểu đồ cột, histograms, biểu đồ phân tán, box plots).</p>
<p>Điều này được thực hiện bằng cách thêm các lớp “geoms” vào lệnh <code>ggplot()</code> ban đầu. Có rất nhiều hàm <strong>ggplot2</strong> có thể tạo ra các “geoms”. Mỗi hàm này bắt đầu bằng “geom_”, vì vậy chúng tôi sẽ gọi chúng một cách chung chung là <code>geom_XXXX()</code>. Có hơn 40 loại geoms trong <strong>ggplot2</strong> và rất nhiều cái khác được tạo ra bởi cộng đồng. Xem chúng tại <a href="https://exts.ggplot2.tidyverse.org/gallery/">thư viện ggplot2</a>. Một số geom phổ biến được liệt kê dưới đây:</p>
<ul>
<li>Histograms - <code>geom_histogram()</code><br>
</li>
<li>Biểu đồ cột - <code>geom_bar()</code> hoặc <code>geom_col()</code> (xem <a href="ggplot-basics.html#ggplot_basics_bars">mục “Biểu đồ cột”</a>)<br>
</li>
<li>Box plots - <code>geom_boxplot()</code><br>
</li>
<li>Điểm (vd: biểu đồ phân tán) - <code>geom_point()</code><br>
</li>
<li>Biểu đồ đường - <code>geom_line()</code> hoặc <code>geom_path()</code><br>
</li>
<li>Đường xu hướng - <code>geom_smooth()</code>
</li>
</ul>
<p>Trong một biểu đồ, bạn có thể hiển thị một hoặc nhiều geoms. Chúng sẽ được thêm vào các lệnh <strong>ggplot2</strong> trước đó bằng dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, và chúng được vẽ theo thứ tự sao cho các geoms sau được vẽ lên phía trên của geoms trước đó.</p>
</div>
<div id="ggplot_basics_mapping" class="section level2" number="30.5">
<h2>
<span class="header-section-number">30.5</span> Chọn dữ liệu cho biểu đồ<a class="anchor" aria-label="anchor" href="#ggplot_basics_mapping"><i class="fas fa-link"></i></a>
</h2>
<p>Hầu hết các hàm geom phải được cho biết <em>cái gì được sử dụng</em> để vẽ biểu đồ - vì vậy bạn phải cung cấp cách <em>map (gán) các biến số trong dữ liệu của bạn</em> tới các thành phần của biểu đồ như là các trục, màu đối tượng, kích thước đối tượng, v.v. Đối với hầu hết các geoms, các thành phần <em>thiết yếu</em> phải được gán tới các cột trong dữ liệu là trục x, và (nếu cần) là trục y.</p>
<p>Việc “mapping” được thực hiện bằng đối số <code>mapping =</code> của hàm. Giá trị bạn cung cấp tới <code>mapping</code> phải được gói trong hàm <code>aes()</code>, vì vậy bạn sẽ viết một cái gì đó kiểu như <code>mapping = aes(x = col1, y = col2)</code>, như được trình bày bên dưới.</p>
<p>Dưới đây, trong lệnh <code>ggplot()</code>, dữ liệu được thiết lập là các trường hợp trong bộ <code>linelist</code>. Trong đối số <code>mapping = aes()</code>, cột <code>age</code> được gán cho trục x, và cột <code>wt_kg</code> được gán cho trục y.</p>
<p>Sau dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, các lệnh vẽ biểu đồ được tiếp tục. Một đối tượng được tạo bằng hàm “geom” thông qua <code>geom_point()</code>. Geom này <em>kế thừa</em> các thông số được gán từ lệnh <code>ggplot()</code> bên trên - nó biết các trục được gán và tiếp tục trực quan hóa mối quan hệ giữa chúng dưới dạng <em>các điểm</em> trên khung vẽ.</p>
<div class="sourceCode" id="cb1419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1034-1.png" width="672"></div>
<p>Một ví dụ khác, lệnh sau sử dụng bộ số liệu tương tự, chỉ có một sự khác biệt nhỏ về cách mapping và hàm geom. Hàm <code>geom_histogram()</code> chỉ yêu cầu gán cột cho trục x, bởi vì trục số lượng y được tạo ra một cách tự động.</p>
<div class="sourceCode" id="cb1420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1035-1.png" width="672"></div>
<div id="thẩm-mỹ-đồ-thị" class="section level3 unnumbered">
<h3>Thẩm mỹ đồ thị<a class="anchor" aria-label="anchor" href="#th%E1%BA%A9m-m%E1%BB%B9-%C4%91%E1%BB%93-th%E1%BB%8B"><i class="fas fa-link"></i></a>
</h3>
<p>Trong ggplot, thuật ngữ “thẩm mỹ đồ thị” có một ý nghĩa đặc biệt. Nó đề cập đến một thuộc tính trực quan của <em>dữ liệu được vẽ</em>. Lưu ý rằng “thẩm mỹ” ở đây đề cập đến <em>dữ liệu đưuợc vẽ bằng các geoms/shapes</em> - không phải các thành phần hiển thị xung quanh như là tiêu đề, nhãn của trục, màu nền, mà bạn có thể liên kết với từ “thẩm mỹ” trong tiếng Anh thông dụng. Trong ggplot, những chi tiết đó được gọi là “chủ đề” và được điều chỉnh trong lệnh <code>theme()</code>(xem <a href="ggplot-basics.html#ggplot_basics_themes">phần này</a>).</p>
<p>Do đó, <em>thẩm mỹ</em> của đối tượng biểu đồ có thể là màu sắc, kích thước, độ trong suốt, vị trí, v.v. của <em>dữ liệu được vẽ</em>. Không phải tất cả các geoms sẽ có các tùy chọn thẩm mỹ giống nhau, nhưng một số tùy chọn được áp dụng với phần lớn các geoms. Dưới đây là một số ví dụ:</p>
<ul>
<li>
<code>shape =</code> Hiển thị một điểm với hàm <code>geom_point()</code> dưới dạng dấu chấm, ngôi sao, hình tam giác hoặc hình vuông…<br>
</li>
<li>
<code>fill =</code> Màu sắc bên trong (vd: của cột hoặc boxplot)<br>
</li>
<li>
<code>color =</code> Đường bên ngoài của cột, boxplot, v.v., hoặc màu của điểm nếu sử dụng hàm <code>geom_point()</code><br>
</li>
<li>
<code>size =</code> Kích thước (vd: độ dày của đường, kích thước của điểm)<br>
</li>
<li>
<code>alpha =</code> Độ trong suốt (1 = bình thường, 0 = vô hình)<br>
</li>
<li>
<code>binwidth =</code> Độ rộng các bins trong biểu đồ histogram<br>
</li>
<li>
<code>width =</code> Độ rộng của các cột trong “biểu đồ cột”<br>
</li>
<li>
<code>linetype =</code> Kiểu của đường (vd: liền, nét đứt, chấm chấm)</li>
</ul>
<p>Thẩm mỹ của đối tượng biểu đồ có thể được gán giá trị theo hai cách:</p>
<ol style="list-style-type: decimal">
<li>Gán một giá trị tĩnh (vd: <code>color = "blue"</code>) để áp dụng cho tất cả các quan sát được vẽ biểu đồ<br>
</li>
<li>Gán cho một cột của dữ liệu (vd: <code>color = hospital</code>) để hiển thị từng quan sát phụ thuộc vào giá trị của nó trong cột đó</li>
</ol>
<!-- *These non-axis aesthetics can be assigned static values (e.g. `size = 1`) or can be mapped to a column (e.g. `size = age`).* If you want the aesthetic to be assigned a static value, the assignment is placed *outside* the `mapping = aes()`. If you want the aesthetic to be scaled/depend on the value in each row of data, the assignment is made *inside* the `mapping = aes()`.   -->
</div>
<div id="gán-một-giá-trị-tĩnh" class="section level3 unnumbered">
<h3>Gán một giá trị tĩnh<a class="anchor" aria-label="anchor" href="#g%C3%A1n-m%E1%BB%99t-gi%C3%A1-tr%E1%BB%8B-t%C4%A9nh"><i class="fas fa-link"></i></a>
</h3>
<p>Nếu bạn muốn yếu tố thẩm mỹ cho đối tượng biểu đồ là tĩnh, nghĩa là - giống nhau đối với mọi quan sát trong dữ liệu, bạn viết phép gán của nó bên trong geom nhưng <em>ở bên ngoài</em> của bất cứ đối số <code>mapping = aes()</code> nào. Các phép gán này có thể trông như này <code>size = 1</code> hoặc <code>color = "blue"</code>. Sau đây là hai ví dụ:</p>
<ul>
<li>Trong ví dụ đầu tiên, đối số <code>mapping = aes()</code> ở bên trong hàm <code>ggplot()</code> và các trục được gán tới cột age và weight trong bộ dữ liệu. Các yếu tố thẩm mỹ như là <code>color =</code>, <code>size =</code>, và <code>alpha =</code> (độ trong suốt) được gán các giá trị tĩnh. Để rõ ràng, điều này được thực hiện trong hàm <code>geom_point()</code>, vì bạn có thể thêm các geom khác sau đó mà sẽ nhận các giá trị khác nhau cho các yếu tố thẩm mỹ của biểu đồ.<br>
</li>
<li>Trong ví dụ thứ hai, biểu đồ histogram chỉ yêu cầu trục x được gán với một cột. Các thông số của biểu đồ histogram như <code>binwidth =</code>, <code>color =</code>, <code>fill =</code> (màu sắc bên trong), và <code>alpha =</code> một lần nữa được đặt trong geom thành các giá trị tĩnh.</li>
</ul>
<div class="sourceCode" id="cb1421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># set data and axes mapping</span>
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>         <span class="co"># set static point aesthetics</span>

<span class="co"># histogram</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>       <span class="co"># set data and axes</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>              <span class="co"># display histogram</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,                <span class="co"># width of bins</span>
    color <span class="op">=</span> <span class="st">"red"</span>,               <span class="co"># bin line color</span>
    fill <span class="op">=</span> <span class="st">"blue"</span>,               <span class="co"># bin interior color</span>
    alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>                 <span class="co"># bin transparency</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1036-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1036-2.png" width="50%"></p>
</div>
<div id="vẽ-theo-tỷ-lệ-giá-trị-của-cột" class="section level3 unnumbered">
<h3>Vẽ theo tỷ lệ giá trị của cột<a class="anchor" aria-label="anchor" href="#v%E1%BA%BD-theo-t%E1%BB%B7-l%E1%BB%87-gi%C3%A1-tr%E1%BB%8B-c%E1%BB%A7a-c%E1%BB%99t"><i class="fas fa-link"></i></a>
</h3>
<p>Một cách khác đó là vẽ theo tỷ lệ giá trị của cột các đối tượng thẩm mỹ của biểu đồ. Theo cách tiếp cận này, việc hiển thị các đối tượng thẩm mỹ sẽ phụ thuộc vào giá trị của quan sát trong cột dữ liệu đó. Nếu các giá trị cột là liên tục, thang đo hiển thị (chú giải) cho thẩm mỹ đó sẽ là liên tục. Nếu các giá trị cột là rời rạc, chú giải sẽ hiển thị từng giá trị và dữ liệu được vẽ biểu đồ sẽ xuất hiện dưới dạng “được nhóm” (đọc thêm ở mục <a href="ggplot-basics.html#ggplotgroups">Nhóm</a> trong chương này).</p>
<p>Để đạt được điều này, bạn gán yếu tố thẩm mỹ của biểu đồ với một <em>tên cột</em> (không trong dấu ngoặc kép). Điều này phải được thực hiện <em>bên trong một hàm <code>mapping = aes()</code></em> (lưu ý: có một số vị trí trong code mà bạn có thể thực hiện các phép gán, như được thảo luận <a href="##ggplot_basics_map_loc">bên dưới</a>).</p>
<p>Hai ví dụ như sau.</p>
<ul>
<li>Ở ví dụ đầu tiên, yếu tố thẩm mỹ <code>color =</code> (của mỗi điểm) được gán cho cột <code>age</code> - và thang đo liên tục được xuất hiện dưới dạng chú thích! Hiện tại bạn chỉ cần quan tâm tới sự xuất hiện của thanh này - chúng ta sẽ học cách chỉnh sửa nó trong các phần sau.<br>
</li>
<li>Trong ví dụ thứ hai, hai yếu tố thẩm mỹ được gán cho hai cột tương ứng (<code>color =</code> và <code>size =</code>), trong khi <code>shape =</code> và <code>alpha =</code> được gán cho các giá trị tĩnh bên ngoài đối số <code>mapping = aes()</code>.</li>
</ul>
<div class="sourceCode" id="cb1422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># set data</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>     <span class="co"># map aesthetics to column values</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># map x-axis to age            </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># map y-axis to weight</span>
         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span>
       <span class="op">)</span><span class="op">+</span>     <span class="co"># map color to age</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span>         <span class="co"># display data as points </span>

<span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># set data</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>     <span class="co"># map aesthetics to column values</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># map x-axis to age            </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># map y-axis to weight</span>
         color <span class="op">=</span> <span class="va">age</span>,       <span class="co"># map color to age</span>
         size <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># map size to age</span>
  <span class="fu">geom_point</span><span class="op">(</span>             <span class="co"># display data as points</span>
    shape <span class="op">=</span> <span class="st">"diamond"</span>,      <span class="co"># points display as diamonds</span>
    alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>            <span class="co"># point transparency at 30%</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1037-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1037-2.png" width="50%"></p>
<p>Lưu ý: Các phép gán trục luôn được gán cho các cột trong dữ liệu (không phải cho các giá trị tĩnh) và điều này luôn được thực hiện với <code>mapping = aes()</code>.</p>
<p>Điều quan trọng là phải theo dõi các lớp của biểu đồ và các đối tượng thẩm mỹ khi vẽ các biểu đồ phức tạp - ví dụ biểu đồ được cấu thành từ nhiều geoms. ITrong ví dụ dưới đây, <code>size =</code> được gán hai lần - một lần cho <code>geom_point()</code> và một lần cho <code>geom_smooth()</code> - cả hai lần đều là giá trị tĩnh.</p>
<div class="sourceCode" id="cb1423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>           <span class="co"># map aesthetics to columns</span>
         x <span class="op">=</span> <span class="va">age</span>,
         y <span class="op">=</span> <span class="va">wt_kg</span>,
         color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span>
       <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span>                   <span class="co"># add points for each row of data</span>
    size <span class="op">=</span> <span class="fl">1</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_smooth</span><span class="op">(</span>                  <span class="co"># add a trend line </span>
    method <span class="op">=</span> <span class="st">"lm"</span>,              <span class="co"># with linear method</span>
    size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>                   <span class="co"># size (width of line) of 2</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1038-1.png" width="672"></div>
</div>
<div id="ggplot_basics_map_loc" class="section level3 unnumbered">
<h3>Thực hiện phép gán ở đâu<a class="anchor" aria-label="anchor" href="#ggplot_basics_map_loc"><i class="fas fa-link"></i></a>
</h3>
<p>Việc gán các yếu tố thẩm mỹ bên trong đối số <code>mapping = aes()</code> có thể được viết ở một số chỗ trong các lệnh vẽ biểu đồ và thậm chí có thể được viết nhiều lần. Nó có thể được viết trong lệnh <code>ggplot()</code> trên cùng, và/hoặc cho từng geom riêng lẻ bên dưới. Các kiểu viết bao gồm:</p>
<ul>
<li>Các phép gán được thực hiện ở lệnh <code>ggplot()</code> trên cùng sẽ được mặc định kế thừa ở bất kỳ các geom bên dưới, giống như cách mà <code>x =</code> và <code>y =</code> được kế thừa</li>
<li>Các phép gán được thực hiện trong một geom chỉ áp dụng cho geom đó</li>
</ul>
<p>Tương tự, <code>data =</code> được chỉ định cho lệnh <code>ggplot()</code> ở trên đầu sẽ áp dụng mặc định cho tất cả các geom bên dưới, nhưng bạn vẫn có thể chỉ định data riêng cho từng geom (nhưng sẽ khó hơn).</p>
<p>Do đó, mỗi lệnh sau sẽ tạo ra cùng một biểu đồ giống nhau:</p>
<div class="sourceCode" id="cb1424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># These commands will produce the exact same plot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="ggplotgroups" class="section level3 unnumbered">
<h3>Nhóm<a class="anchor" aria-label="anchor" href="#ggplotgroups"><i class="fas fa-link"></i></a>
</h3>
<p>Bạn có thể dễ dàng nhóm dữ liệu và “vẽ biểu đồ theo nhóm”. Trên thực tế, bạn đã làm điều này rồi!</p>
<p>Gán cột “phân nhóm” với yếu tố thẩm mỹ biều đồ phù hợp, bên trong đối số <code>mapping = aes()</code>. Ở bên trên, chúng ta đã minh họa nó bằng cách sử dụng các giá trị liên tục khi gán điểm <code>size =</code> tới cột <code>age</code>. Tuy nhiên, cách này cũng hoạt động theo cùng một cơ chế đối với các cột rời rạc/phân loại.</p>
<p>Ví dụ, nếu bạn muốn các điểm được hiển thị theo giới, bạn sẽ đặt <code>mapping = aes(color = gender)</code>. Một chú giải tự động hiện lên. Phép gán này có thể được thực hiện bên trong <code>mapping = aes()</code> ở lệnh <code>ggplot()</code> đầu tiên (và được thừa kế bởi các geom), hoặc nó thể được đặt trong một <code>mapping = aes()</code> riêng biệt bên trong geom. Cả hai cách tiếp cận được trình bày dưới đây:</p>
<div class="sourceCode" id="cb1425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1040-1.png" width="672"></div>
<div class="sourceCode" id="cb1426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This alternative code produces the same plot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p>Lưu ý rằng tùy thuộc vào loại geom bạn sử dụng, bạn sẽ cần sử dụng các đối số khác nhau để nhóm dữ liệu. Đối với <code>geom_point()</code>, bạn sẽ thường sử dụng nhất các tham số như <code>color =</code>, <code>shape =</code> hoặc <code>size =</code>. Trong khi đó đối với <code>geom_bar()</code>, bạn thường sử dụng nhất tham số <code>fill =</code>. Điều này chỉ phụ thuộc vào loại geom và yếu tố trang trí nào bạn muốn thể hiện sự phân nhóm.</p>
<p>Cách cơ bản nhất để nhóm dữ liệu là chỉ sử dụng đối số <code>group =</code> bên trong <code>mapping = aes()</code>. Tuy nhiên, cách này tự nó sẽ không làm thay đổi màu sắc, hình dạng hoặc tạo ra chú thích. Tuy nhiên dữ liệu được nhóm lại, do đó hiển thị thống kê có thể bị ảnh hưởng.</p>
<p>Để thay đổi thứ tự của các nhóm trong biểu đồ, xem chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> hoặc chương <a href="factors.html#factors">Factors</a>. Ngoài ra cũng có rất nhiều ví dụ về các biểu đồ được nhóm trong các phần bên dưới đối với dữ liệu dạng liên tục và danh mục.</p>
</div>
</div>
<div id="ggplot_basics_facet" class="section level2" number="30.6">
<h2>
<span class="header-section-number">30.6</span> Facets / Chia nhỏ biểu đồ<a class="anchor" aria-label="anchor" href="#ggplot_basics_facet"><i class="fas fa-link"></i></a>
</h2>
<p>Facets, hay “chia nhỏ biểu đồ”, được sử dụng để chia một biểu đồ thành nhiều phần nhỏ, với mỗi phần (“facet”) đại diện cho một nhóm của dữ liệu. Các biểu đồ giống nhau được tạo nhiều lần, mỗi cái sử dụng một phân nhóm của cùng một bộ dữ liệu.</p>
<p>Faceting là một chức năng đi kèm với <strong>ggplot2</strong>, vì vậy các chú giải và trục của các biểu đồ nhỏ được căn chỉnh tự động. Có các package khác được thảo luận trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> được sử dụng để kết hợp các biểu đồ hoàn toàn khác nhau (<strong>cowplot</strong> và <strong>patchwork</strong>) thành một biểu đồ.</p>
<p>Faceting được thực hiện bằng các hàm <strong>ggplot2</strong> sau đây:</p>
<ol style="list-style-type: decimal">
<li>
<code>facet_wrap()</code> Để hiện thị các biểu đồ khác nhau cho từng thứ bậc của một biến số <em>đơn lẻ</em>. Một ví dụ như thể hiện các đường cong dịch bệnh khác nhau cho từng bệnh viện trong khu vực. Các facets được sắp xếp theo thứ tự bảng chữ cái, trừ khi biến có kiểu factor với các thứ bậc đã được xác định.<br>
</li>
</ol>
<ul>
<li>Bạn có thể sử dụng một số tùy chọn nhất định để xác định bố cục của các facets, vd: <code>nrow = 1</code> hoặc <code>ncol = 1</code> để kiểm soát số hàng hoặc cột mà chúng được sắp xếp.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>
<code>facet_grid()</code> Áp dụng khi bạn muốn đưa một biến thứ hai vào sắp xếp các biểu đồ con. Ở đây mỗi ô thể hiện sự giao nhau của các giá trị giữa <em>hai cột</em>. Ví dụ, các đường cong dịch bệnh cho từng sự kết hợp của bệnh viện-nhóm tuổi với các bệnh viện dọc theo phía đỉnh (các cột) và các nhóm tuổi dọc theo hai bên (các hàng).<br>
</li>
</ol>
<ul>
<li>
<code>nrow</code> và <code>ncol</code> không được áp dụng, bởi vì các phân nhóm được trình bày dưới dạng lưới</li>
</ul>
<p>Mỗi hàm này chấp nhận một cú pháp công thức để chỉ định cột được faceting. Cả hai đều chấp nhận tối đa hai cột, mỗi cột ở một bên dấu ngã <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>.</p>
<ul>
<li><p>Đối với <code>facet_wrap()</code>, bạn sẽ thường chỉ viết một cột trước dấu ngã <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> chẳng hạn như <code>facet_wrap(~hospital)</code>. Tuy nhiên, bạn vẫn có thể viết hai cột, ví dụ <code>facet_wrap(outcome ~ hospital)</code> - mỗi kết hợp duy nhất sẽ hiển thị trong một ô riêng biệt, nhưng chúng sẽ không được sắp xếp trong một lưới. Các tiêu đề sẽ hiển thị các thuật ngữ kết hợp và chúng sẽ không phải là logic cụ thể cho các cột so với các hàng. Nếu bạn đang chỉ cung cấp một biến số để faceting, dấu chấm <code>.</code> được sử dụng như để giữ chỗ cho phía bên kia của công thức - hãy xem các ví dụ về code.</p></li>
<li><p>Đối với <code>facet_grid()</code> bạn cũng có thể chỉ định một hoặc hai cột tới công thức (grid <code>rows ~ columns</code>). Nếu bạn chỉ muốn chỉ định một cột, hãy đặt một dấu chấm <code>.</code> ở một phía của dấu ngã chẳng hạn như <code>facet_grid(. ~ hospital)</code> hoặc <code>facet_grid(hospital ~ .)</code>.</p></li>
</ul>
<p>Facets có thể chứa một lượng lớn thông tin - vì vậy bạn nên đảm bảo những biến số được lựa chọn để facets không có quá nhiều thứ bậc. Dưới đây là một số ví dụ nhanh với tập dữ liệu sốt rét (xem chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a>) bao gồm số lượng trường hợp sốt rét hàng ngày của các cơ sở theo nhóm tuổi..</p>
<p>Sau đây chúng ta nhập số liệu vào và thực hiện một số biến đổi để đơn giản hóa:</p>
<div class="sourceCode" id="cb1427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># These data are daily counts of malaria cases, by facility-day</span>
<span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># import</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">submitted_date</span>, <span class="op">-</span><span class="va">Province</span>, <span class="op">-</span><span class="va">newid</span><span class="op">)</span>                                 <span class="co"># remove unneeded columns</span></code></pre></div>
<p>50 hàng đầu tiên của dữ liệu sốt rét được trình bày như bên dưới. Lưu ý rằng có một cột tên là <code>malaria_tot</code>, ngoài ra còn có các cột khác chứa thông tin về số lượng trường hợp theo nhóm tuổi (chúng sẽ được sử dụng trong ví dụ thứ hai với <code>facet_grid()</code>).</p>
<div id="htmlwidget-840ae6460a78cbc56174" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-840ae6460a78cbc56174">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1596499200000\" data-max=\"1597190400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"81\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"56\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"96\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"233\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 2","Facility 3","Facility 4","Facility 5","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 7","Facility 8","Facility 9","Facility 10","Facility 11","Facility 12","Facility 13","Facility 14","Facility 15","Facility 16","Facility 17","Facility 18","Facility 19","Facility 19","Facility 20","Facility 21","Facility 19","Facility 22","Facility 23","Facility 23","Facility 24","Facility 25","Facility 26","Facility 27","Facility 28","Facility 29","Facility 30","Facility 30","Facility 31","Facility 31","Facility 32","Facility 33","Facility 33","Facility 7","Facility 30","Facility 30","Facility 30","Facility 30","Facility 34","Facility 35"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-09","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-09","2020-08-11","2020-08-11","2020-08-12","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-06","2020-08-04","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-07","2020-08-09","2020-08-10","2020-08-11","2020-08-11","2020-08-10"],["Spring","Bolo","Dingo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Bolo","Spring","Bolo","Spring","Dingo","Bolo","Dingo","Barnard","Barnard","Barnard","Bolo","Bolo","Bolo","Barnard","Bolo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Spring","Dingo","Bolo","Bolo","Dingo","Dingo","Spring","Barnard","Barnard","Spring","Bolo","Bolo","Bolo","Bolo","Dingo","Spring"],[11,11,8,16,9,3,4,15,11,19,12,7,27,0,17,36,0,5,6,9,4,7,12,4,14,28,5,11,8,8,21,7,3,7,9,19,28,9,11,7,26,0,4,8,5,25,21,9,4,81],[12,10,5,16,2,1,0,14,11,15,7,1,8,10,15,36,0,1,3,9,4,0,2,7,9,18,3,4,7,7,0,3,2,4,7,4,14,8,2,10,35,2,4,9,9,14,25,20,9,56],[23,5,5,17,6,4,3,13,13,15,13,20,18,24,28,62,0,10,2,16,1,6,18,41,14,5,24,13,16,16,41,13,5,11,33,23,54,10,11,16,30,8,2,11,29,31,38,26,17,96],[46,26,18,49,17,8,7,42,35,49,32,28,53,34,60,134,0,16,11,34,9,13,32,52,37,51,32,28,31,31,62,23,10,22,49,46,96,27,24,33,91,10,10,28,43,70,84,55,30,233]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_rdt_0-4<\/th>\n      <th>malaria_rdt_5-14<\/th>\n      <th>malaria_rdt_15<\/th>\n      <th>malaria_tot<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="facet_wrap" class="section level3 unnumbered">
<h3>
<code>facet_wrap()</code><a class="anchor" aria-label="anchor" href="#facet_wrap"><i class="fas fa-link"></i></a>
</h3>
<p>Tại thời điểm này, hãy chỉ tập trung vào các cột <code>malaria_tot</code> và <code>District</code>, tạm thời bỏ qua cột số lượng ca bệnh theo tuổi. Chúng ta sẽ vẽ các đường cong dịch bệnh với hàm <code>geom_col()</code>, giúp tạo ra một cột cho từng ngày với độ cao được xác định từ giá trị của cột <code>malaria_tot</code> (dữ liệu đã là số lượng hàng ngày, vì vậy chúng tôi sử dụng hàm <code>geom_col()</code> - xem mục <a href="ggplot-basics.html#ggplot_basics_bars">“Biểu đồ cột” bên dưới</a>).</p>
<p>Khi chúng ta thêm lệnh <code>facet_wrap()</code>, hãy thêm dấu ngã kèm với cột dùng để facet bên trong lệnh (trong trường hợp này là <code>District</code>). Bạn có thể đặt một cột khác ở bên trái của dấu ngã, - điều này sẽ tạo ra một facet cho từng sự kết hợp - nhưng chúng tôi khuyên bạn nên làm điều đó bằng hàm <code>facet_grid()</code>. Trong ví dụ này, chỉ một facet được tạo ra cho giá trị duy nhất của cột <code>District</code>.</p>
<div class="sourceCode" id="cb1428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A plot with facets by district</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># plot the count data as columns</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                              <span class="co"># simplify the background panels</span>
  <span class="fu">labs</span><span class="op">(</span>                                         <span class="co"># add plot labels, title, etc.</span>
    x <span class="op">=</span> <span class="st">"Date of report"</span>,
    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">District</span><span class="op">)</span>                       <span class="co"># the facets are created</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1044-1.png" width="672"></div>
</div>
<div id="facet_grid" class="section level3 unnumbered">
<h3>
<code>facet_grid()</code><a class="anchor" aria-label="anchor" href="#facet_grid"><i class="fas fa-link"></i></a>
</h3>
<p>Chúng ta có thể sử dụng cách tiếp cận <code>facet_grid()</code> đối với hai biến. Giả sử chúng ta muốn thêm <code>District</code> and age vào biểu đồ của mình. Trước hết, chúng ta cần thực hiện một số biến đổi dữ liệu trên các cột tuổi để đưa những dữ liệu này sang định dạng “dài” được ggplot ưu tiên. Tất cả các nhóm tuổi đều có các cột riêng - chúng ta cần chúng nhập vào một cột duy nhất có tên <code>age_group</code> và một cột khasc có tên <code>num_cases</code>. Xem chương <a href="pivoting.html#pivoting">Xoay trục dữ liệu</a> để hiểu thêm về quy trình này.</p>
<div class="sourceCode" id="cb1429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">malaria_age</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">malaria_tot</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"malaria_rdt_"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># choose columns to pivot longer</span>
    names_to <span class="op">=</span> <span class="st">"age_group"</span>,      <span class="co"># column names become age group</span>
    values_to <span class="op">=</span> <span class="st">"num_cases"</span>      <span class="co"># values to a single column (num_cases)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    age_group <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"malaria_rdt_"</span>, <span class="st">""</span><span class="op">)</span>,
    age_group <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"5-14"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>50 hàng đầu tiên của dữ liệu trông giống như sau:</p>
<div id="htmlwidget-72a36071f09cb04c557c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-72a36071f09cb04c557c">{"x":{"filter":"top","filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"1596844800000\" data-max=\"1597104000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-14&quot;,&quot;15&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none; position: absolute; width: 200px;\">\n      <div data-min=\"0\" data-max=\"62\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 1","Facility 1","Facility 2","Facility 2","Facility 2","Facility 3","Facility 3","Facility 3","Facility 4","Facility 4","Facility 4","Facility 5","Facility 5","Facility 5","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 7","Facility 7","Facility 7","Facility 8","Facility 8","Facility 8","Facility 9","Facility 9","Facility 9","Facility 10","Facility 10","Facility 10","Facility 11","Facility 11","Facility 11","Facility 12","Facility 12","Facility 12","Facility 13","Facility 13"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-09","2020-08-09","2020-08-09","2020-08-08","2020-08-08","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11"],["Spring","Spring","Spring","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Dingo","Dingo","Dingo","Bolo","Bolo"],["0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14"],[11,12,23,11,10,5,8,5,5,16,16,17,9,2,6,3,1,4,4,0,3,15,14,13,11,11,13,19,15,15,12,7,13,7,1,20,27,8,18,0,10,24,17,15,28,36,36,62,0,0]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>age_group<\/th>\n      <th>num_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Khi bạn chuyển hai biến số tới <code>facet_grid()</code>, cách đơn giản nhất là sử dụng ký hiệu công thức (vd: <code>x ~ y</code>), trong đó x là hàng và y là cột. Dưới đây là biểu đồ, sử dụng <code>facet_grid()</code> để hiển thị các biểu đồ cho mỗi kết hợp của các cột <code>age_group</code> và <code>District</code>.</p>
<div class="sourceCode" id="cb1430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_age</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">num_cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkred"</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Date of report"</span>,
    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district and age group"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">District</span> <span class="op">~</span> <span class="va">age_group</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1047-1.png" width="672"></div>
</div>
<div id="giới-hạn-trục-tự-do-hoặc-cố-định" class="section level3 unnumbered">
<h3>Giới hạn trục tự do hoặc cố định<a class="anchor" aria-label="anchor" href="#gi%E1%BB%9Bi-h%E1%BA%A1n-tr%E1%BB%A5c-t%E1%BB%B1-do-ho%E1%BA%B7c-c%E1%BB%91-%C4%91%E1%BB%8Bnh"><i class="fas fa-link"></i></a>
</h3>
<p>Theo mặc định, các tỷ lệ trục được hiển thị khi faceting là giống nhau (cố định) trên tất cả các facets. Điều này rất hữu ích cho việc so sánh chéo, nhưng không phải lúc nào cũng thích hợp.</p>
<p>Khi sử dụng <code>facet_wrap()</code> hoặc <code>facet_grid()</code>, chúng ta có thể thêm <code>scales = "free_y"</code> để “free” hoặc giải phóng trục y của các biểu đồ nhỏ chia tỷ lệ thích hợp với tập con dữ liệu của chúng. Điều này đặc biệt hữu ích nếu số lượng thực tế là nhỏ đối với một trong các danh mục phụ và khó có thể nhìn thấy xu hướng. Thay vì “free_y”, chúng ta cũng có thể viết “free_x” để làm tương tự đối với trục x (vd: biến ngày thág) hoặc “free” đối với cả hai trục. Lưu ý rằng trong <code>facet_grid</code>, tỷ lệ y sẽ giống nhau đối với các facets trong cùng một hàng và tỷ lệ x sẽ giống nhau đối với các facets trong cùng một cột.</p>
<p>Khi chỉ sử dụng <code>facet_grid</code>, chúng ta có thể thêm <code>space = "free_y"</code> hoặc <code>space = "free_x"</code> để chiều cao hoặc chiều rộng thực tế của facet được tính theo giá trị của biều đồ bên trong. Điều này chỉ hoạt động nếu <code>scales = "free"</code> (y hoặc x) đã được áp dụng.</p>
<div class="sourceCode" id="cb1431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Free y-axis</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># plot the count data as columns</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                              <span class="co"># simplify the background panels</span>
  <span class="fu">labs</span><span class="op">(</span>                                         <span class="co"># add plot labels, title, etc.</span>
    x <span class="op">=</span> <span class="st">"Date of report"</span>,
    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district - 'free' x and y axes"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">District</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>        <span class="co"># the facets are created</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1048-1.png" width="672"></div>
<!-- ```{r fig.show='hold', message=FALSE, warning=FALSE, out.width=c('50%', '50%')} -->
<!-- # A) Facet hospitalsation date by hospital, free y axis -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # filter removes unknown hospital -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "A) Histogram with free y axis scales")+ -->
<!--   facet_grid(hospital~., # Facet with hospital as the row  -->
<!--              scales = "free_y") # Free the y scale of each facet -->
<!-- # B) Facet hospitalisation date by hospital, free y axis and vertical spacing -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # filter removes unknown hospital -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "B) Histogram with free y axis scales and spacing")+ -->
<!--   facet_grid(hospital~., # Facet with hospital as the row  -->
<!--              scales = "free_y", # Free the y scale of each facet -->
<!--              space = "free_y") # Free the vertical spacing of each facet to optimise space -->
<!-- ``` -->
</div>
<div id="trật-tự-thức-bậc-của-factor-trong-facets" class="section level3 unnumbered">
<h3>Trật tự thức bậc của Factor trong facets<a class="anchor" aria-label="anchor" href="#tr%E1%BA%ADt-t%E1%BB%B1-th%E1%BB%A9c-b%E1%BA%ADc-c%E1%BB%A7a-factor-trong-facets"><i class="fas fa-link"></i></a>
</h3>
<p>Xem <a href="https://juliasilge.com/blog/reorder-within/">bài viết</a> này về cách làm thế nào để sắp xếp lại thức bậc của biến factor <em>bên trong</em> facets.</p>
</div>
</div>
<div id="lưu-trữ-biểu-đồ" class="section level2" number="30.7">
<h2>
<span class="header-section-number">30.7</span> Lưu trữ biểu đồ<a class="anchor" aria-label="anchor" href="#l%C6%B0u-tr%E1%BB%AF-bi%E1%BB%83u-%C4%91%E1%BB%93"><i class="fas fa-link"></i></a>
</h2>
<div id="lưu-biểu-đồ-1" class="section level3 unnumbered">
<h3>Lưu biểu đồ<a class="anchor" aria-label="anchor" href="#l%C6%B0u-bi%E1%BB%83u-%C4%91%E1%BB%93-1"><i class="fas fa-link"></i></a>
</h3>
<p>Mặc định khi bạn chạy lệnh <code>ggplot()</code>, biểu đồ sẽ được in ở cửa số Plots của RStudio. Tuy nhiên, bạn cũng có thể lưu biểu đồ dưới dạng một đối tượng bằng cách sử dụng toán tử gán <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> và đặt tên cho nó. Biểu đồ sẽ không được in ra trừ khi bạn gọi tên của đối tượng. Bạn cũng có thể in nó bằng cách đưa tên biểu đồ vào hàm <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, nhưng điều này chỉ cần thiết trong một số trường hợp nhất định chẳng hạn như khi biểu đồ được tạo bên trong một <em>vòng lặp for</em> để in nhiều biểu đồ cùng một lúc (xem chương <a href="iteration.html#iteration">Lặp, vòng lặp, và danh sách</a>).</p>
<div class="sourceCode" id="cb1432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define plot</span>
<span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="co"># print</span>
<span class="va">age_by_wt</span>    </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1049-1.png" width="672"></div>
</div>
<div id="chỉnh-sửa-biều-đồ-đã-lưu" class="section level3 unnumbered">
<h3>Chỉnh sửa biều đồ đã lưu<a class="anchor" aria-label="anchor" href="#ch%E1%BB%89nh-s%E1%BB%ADa-bi%E1%BB%81u-%C4%91%E1%BB%93-%C4%91%C3%A3-l%C6%B0u"><i class="fas fa-link"></i></a>
</h3>
<p>Một điểm hay của <strong>ggplot2</strong> là bạn có thể gán tên cho một biểu đồ (như bên trên), và sau đó thêm các lớp mới bắt đầu bằng tên của nó. Bạn không cần phải lặp lại tất cả các lệnh đã tạo ra biểu đồ ban đầu!</p>
<p>Ví dụ: để sửa đổi biểu đồ <code>age_by_wt</code> đã được định nghĩa ở bên trên, thêm một trục dọc tại tuổi bằng 50, chúng ta chỉ cần thêm dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> và bắt đầu thêm các lớp bổ sung vào biểu đồ.</p>
<div class="sourceCode" id="cb1433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1050-1.png" width="672"></div>
</div>
<div id="xuất-biểu-đồ" class="section level3 unnumbered">
<h3>Xuất biểu đồ<a class="anchor" aria-label="anchor" href="#xu%E1%BA%A5t-bi%E1%BB%83u-%C4%91%E1%BB%93"><i class="fas fa-link"></i></a>
</h3>
<p>Việc xuất biểu đồ được thực hiện dễ dàng với hàm <code>ggsave()</code> của package <strong>ggplot2</strong>. Nó có thể hoạt động theo hai cách:</p>
<ul>
<li>
<p>Chỉ định tên của đối tượng biểu đồ, sau đó là đường dẫn tệp và tên có phần mở rộng</p>
<ul>
<li>Ví dụ: <code>ggsave(my_plot, here("plots", "my_plot.png"))</code><br>
</li>
</ul>
</li>
<li>
<p>Chạy lệnh chỉ với một đường dẫn tệp, để lưu biểu đồ gần nhất được in ra</p>
<ul>
<li>Ví dụ: <code>ggsave(here("plots", "my_plot.png"))</code>
</li>
</ul>
</li>
</ul>
<p>Bạn có thể xuất dưới dạng tệp png, pdf, jpeg, tiff, bmp, svg, hoặc một số định dạng khác, bằng cách chỉ định phần mở rộng tệp trong đường dẫn tệp.</p>
<p>Bạn cũng có thể chỉ định các đối số <code>width =</code>, <code>height =</code>, và <code>units =</code> (“in”, “cm”, hoặc “mm”). Bạn cũng có thể chỉ định <code>dpi =</code> để điều chỉnh độ phân giâỉ của biểu đồ (vd: dpi = 300). Xem hướng dẫn chi tiết về hàm bằng cách gõ <code>?ggsave</code> hoặc đọc <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">tài liệu online này</a>.</p>
<p>Hãy nhớ rằng bạn có thể sử dụng cú pháp <code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> để cung cấp đường dẫn tệp mong muốn. Xem chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết thêm thông tin.</p>
</div>
</div>
<div id="nhãn" class="section level2" number="30.8">
<h2>
<span class="header-section-number">30.8</span> Nhãn<a class="anchor" aria-label="anchor" href="#nh%C3%A3n"><i class="fas fa-link"></i></a>
</h2>
<p>Chắc chắn là bạn sẽ muốn thêm hoặc điều chỉnh nhãn của biểu đồ. Việc này được thực hiện dễ dàng nhất với hàm <code>labs()</code> bằng cách thêm dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> như cách bạn thêm các geoms.</p>
<p>Bên trong hàm <code>labs()</code>, bạn có thể cung cấp các chuỗi ký tự cho các đối số sau:</p>
<ul>
<li>
<code>x =</code> và <code>y =</code> Tiêu đề trục x và trục y (nhãn)<br>
</li>
<li>
<code>title =</code> Tiêu đề chính của biểu đồ<br>
</li>
<li>
<code>subtitle =</code> Tiêu đề phụ của biểu đồ, nhỏ hơn và đặt bên dưới tiêu đề chính<br>
</li>
<li>
<code>caption =</code> Caption của biểu đồ, mặc định ở góc phải dưới</li>
</ul>
<p>Dưới đây là biểu đồ chúng ta đã tạo lúc trước, nhưng có thêm các nhãn:</p>
<div class="sourceCode" id="cb1434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># set data</span>
  mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>     <span class="co"># map aesthetics to column values</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># map x-axis to age            </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># map y-axis to weight</span>
         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     <span class="co"># map color to age</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>           <span class="co"># display data as points</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Age and weight distribution"</span>,
    subtitle <span class="op">=</span> <span class="st">"Fictional Ebola outbreak, 2014"</span>,
    x <span class="op">=</span> <span class="st">"Age in years"</span>,
    y <span class="op">=</span> <span class="st">"Weight in kilos"</span>,
    color <span class="op">=</span> <span class="st">"Age"</span>,
    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Data as of {max(linelist$date_hospitalisation, na.rm=T)}"</span><span class="op">)</span><span class="op">)</span>

<span class="va">age_by_wt</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1051-1.png" width="672"></div>
<p>Hãy để ý chúng ta đã sử dụng hàm <code>str_glue()</code> từ package <strong>stringr</strong> để tạo một code R động bên trong văn bản khi gán giá trị cho caption. Caption sẽ hiển thị “Dữ liệu kể từ:” phản ánh ngày nhập viện gần nhất trong bộ dữ liệu linelist. Đọc thêm ở chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>.</p>
<p>Một chú ý khi bạn muốn thêm tiêu đề cho <em>chú giải</em>: Đó là không có đối số “legend title”, vì bạn có thể có nhiều thang đo trong chú giải của mình. Bên trong lệnh <code>labs()</code>, bạn có thể viết đối số cho yếu tố thẩm mỹ được sử dụng để tạo chú giải, và cung cấp tiêu đề cho nó theo cách này. Trong ví dụ bên trên, chúng ta đã gán <code>color = age</code> để tạo chú giải. Do đó, chúng ta cũng cung cấp đối số <code>color =</code> ttrong hàm <code>labs()</code> và gán tiêu đề chú giải mong muốn (“Age” với chữ A được viết hoa). Nếu bạn tạo chú thích bằng đối số <code>aes(fill = COLUMN)</code>, thì trong lệnh <code>labs()</code> bạn nên viết <code>fill =</code> để điều chỉnh tiêu đề cho chú thích. Xem thêm mục thang đo màu sắc trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> để biết thêm chi tiết về cách chỉnh sửa chú giải và cách tiếp cận thay thế bằng cách sử dụng các hàm <code>scales_()</code>.</p>
</div>
<div id="ggplot_basics_themes" class="section level2" number="30.9">
<h2>
<span class="header-section-number">30.9</span> Chủ đề<a class="anchor" aria-label="anchor" href="#ggplot_basics_themes"><i class="fas fa-link"></i></a>
</h2>
<p>Một trong những phần hay nhất của <strong>ggplot2</strong> là mức độ kiểm soát của bạn đối với biểu đồ - bạn có thể định nghĩa bất kỳ điều gì! Như đã đề cập ở trên, thiết kế của biểu đồ <em>không</em> liên quan tới dạng biểu đồ mà được điều chỉnh bên trong hàm <code>theme()</code>. Ví dụ, màu nền của biểu đồ, sự xuất hiện/biến mất của đường lưới, cũng như phông chữ/cỡ chữ/màu sắc/căn lề của văn bản (tiêu đề chính, tiêu đề phụ, captions, chữ trên các trục…). Những điều chỉnh này có thể được thực hiện theo hai cách:</p>
<ul>
<li>Thêm một <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><em>chủ đề hoàn chỉnh</em></a> bằng hàm <code>theme_()</code> để điều chỉnh toàn bộ các thành phần biểu đồ - các chủ đề hoàn chỉnh này bao gồm <code>theme_classic()</code>, <code>theme_minimal()</code>, <code>theme_dark()</code>, <code>theme_light()</code> <code>theme_grey()</code>, <code>theme_bw()</code>
</li>
<li>Điều chỉnh từng khía cạnh đơn lẻ của biểu đồ với hàm <code>theme()</code>
</li>
</ul>
<div id="chủ-đề-hoàn-chỉnh" class="section level3 unnumbered">
<h3>Chủ đề hoàn chỉnh<a class="anchor" aria-label="anchor" href="#ch%E1%BB%A7-%C4%91%E1%BB%81-ho%C3%A0n-ch%E1%BB%89nh"><i class="fas fa-link"></i></a>
</h3>
<p>Vì chúng khá đơn giản, chúng tôi sẽ trình bày các hàm chủ đề hoàn chỉnh bên dưới và sẽ không mô tả thêm ở đây. Lưu ý rằng bất kỳ điều chỉnh nhỏ nào bằng hàm <code>theme()</code> nên được thực hiện <em>sau khi</em> áp dụng một chủ đề hoàn chỉnh.</p>
<p>Viết chúng với dấu ngoặc đơn trống.</p>
<div class="sourceCode" id="cb1435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme classic"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme bw"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme minimal"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme gray"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_gray</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1052-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1052-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1052-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1052-4.png" width="50%"></p>
</div>
<div id="tùy-chỉnh-chủ-đề" class="section level3 unnumbered">
<h3>Tùy chỉnh chủ đề<a class="anchor" aria-label="anchor" href="#t%C3%B9y-ch%E1%BB%89nh-ch%E1%BB%A7-%C4%91%E1%BB%81"><i class="fas fa-link"></i></a>
</h3>
<p>Hàm <code>theme()</code> có thể nhận một số lượng lớn các đối số, mỗi đối số sẽ chỉnh sửa một khía cạnh rất cụ thể của biểu đồ. Chúng tôi sẽ không trình bày tất cả các đối số, nhưng sẽ tập trung mô tả công thức chung cho chúng và chỉ cho bạn cách tìm tên đối số mà bạn cần. Cú pháp cơ bản là:</p>
<ol style="list-style-type: decimal">
<li>Bên trong hàm <code>theme()</code>, hãy viết tên đối số cho phần tử biểu đồ mà bạn muốn chỉnh sửa, chẳng hạn như <code>plot.title =</code><br>
</li>
<li>Cung cấp một hàm <code>element_()</code> tới đối số<br>
</li>
</ol>
<ul>
<li>Thường sử dụng nhất là <code>element_text()</code>, một số khác bao gồm <code>element_rect()</code> chọn màu nền cho canvas, hoặc <code>element_blank()</code> để xóa các phần tử biểu đồ<br>
</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Bên trong hàm <code>element_()</code>, xác định giá trị đối số cần gán để điều chỉnh theo ý bạn mong muốn</li>
</ol>
<p>Vì trình bày bên trên vẫn khá trừu tượng, nên đây là một số ví dụ.</p>
<p>Lưu ý là biểu đồ dưới đây trông không thật sự đẹp, nhưng nó giúp bạn thấy nhiều cách khác nhau để bạn có thể điều chỉnh biểu đồ của mình.</p>
<ul>
<li>Chúng ta bắt đầu với biểu đồ có tên <code>age_by_wt</code> đã được tạo ra bên trên và thêm hàm <code>theme_classic()</code><br>
</li>
<li>Để điều chỉnh đẹp hơn, chúng ta thêm hàm <code>theme()</code> và bao gồm một đối số cho từng phần tử biểu đồ muốn điều chỉnh</li>
</ul>
<p>Sẽ rất tốt nếu bạn sắp xếp các đối số theo một trật tự logic. Hãy xem ví dụ sau:</p>
<ul>
<li>
<code>legend.position =</code> là đặc biệt nhất vì nó chỉ chấp nhận các giá trị đơn giản như “bottom”, “top”, “left”, và “right”. các đối số liên quan đến văn bản yêu cầu bạn đặt các chi tiết <em>bên trong</em> hàm <code>element_text()</code>.<br>
</li>
<li>Cỡ chư tiêu đề với <code>element_text(size = 30)</code><br>
</li>
<li>Căn lề caption với <code>element_text(hjust = 0)</code> (từ trái qua phải)<br>
</li>
<li>Tiêu đề phụ được in nghiêng với <code>element_text(face = "italic")</code>
</li>
</ul>
<div class="sourceCode" id="cb1436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span> <span class="op">+</span> 
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                 <span class="co"># pre-defined theme adjustments</span>
  <span class="fu">theme</span><span class="op">(</span>
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span>
    
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,          <span class="co"># size of title to 30</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,        <span class="co"># left-align caption</span>
    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># italicize subtitle</span>
    
    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">15</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, <span class="co"># adjusts only x-axis text</span>
    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,         <span class="co"># adjusts only y-axis text</span>
    
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>           <span class="co"># adjusts both axes titles</span>
    <span class="op">)</span>     </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1053-1.png" width="672"></div>
<p>Sau đây là một số đối số phổ biến của hàm <code>theme()</code>. Bạn sẽ nhận ra một số xu hướng chung, chẳng hạn như thêm <code>.x</code> hoặc <code>.y</code> để chỉ áp dụng thay đổi cho một trục.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="32%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th><code>Đối số theme()</code></th>
<th>Những gì nó điều chỉnh</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>plot.title = element_text()</code></td>
<td>Tiêu đề chính</td>
</tr>
<tr class="even">
<td><code>plot.subtitle = element_text()</code></td>
<td>Tiêu đề phụ</td>
</tr>
<tr class="odd">
<td><code>plot.caption = element_text()</code></td>
<td>Liên quan tới caption (kiểu font, màu sắc, kích cỡ, góc độ, vjust, hjust…)</td>
</tr>
<tr class="even">
<td><code>axis.title = element_text()</code></td>
<td>Tiêu đề trục (cả trục x và y) (kích cỡ, góc độ, màu sắc…)</td>
</tr>
<tr class="odd">
<td><code>axis.title.x = element_text()</code></td>
<td>Chỉ tiêu đề trục x (sử dụng <code>.y</code> để chỉ áp dụng với trục y)</td>
</tr>
<tr class="even">
<td><code>axis.text = element_text()</code></td>
<td>Văn bản trên trục (cả trục x và y)</td>
</tr>
<tr class="odd">
<td><code>axis.text.x = element_text()</code></td>
<td>Chỉ văn bản trục x (sử dụng <code>.y</code> để chỉ áp dụng với trục y)</td>
</tr>
<tr class="even">
<td><code>axis.ticks = element_blank()</code></td>
<td>Loại bỏ ticks của trục</td>
</tr>
<tr class="odd">
<td><code>axis.line = element_line()</code></td>
<td>Đường trục (màu sắc, kích thước, kiểu đường: nét đứt, nét liền mảnh, v.v.)</td>
</tr>
<tr class="even">
<td><code>strip.text = element_text()</code></td>
<td>Văn bản trong Facet strip (màu sắc, kích thước, góc độ…)</td>
</tr>
<tr class="odd">
<td><code>strip.background = element_rect()</code></td>
<td>facet strip (tô màu, màu sắc, kích thước…)</td>
</tr>
</tbody>
</table></div>
<p>Nhưng còn rất nhiều các đối số khác! Làm thế nào tôi có thể nhớ tất cả chúng? Đừng lo lắng - bạn không thể nhớ hết chúng được đâu. May mắn thay, có một vài công cụ có thể thể giúp bạn:</p>
<p>Tài liệu hướng dẫn của <strong>tidyverse</strong> phần <a href="https://ggplot2.tidyverse.org/reference/theme.html">tùy chỉnh chủ đề</a>, có chứa một danh sách đầy đủ các đối số.</p>
<p><span style="color: darkgreen;"><strong><em>MẸO:</em></strong> Chạy lệnh <code>theme_get()</code> từ <strong>ggplot2</strong> để in tất cả hơn 90 đối số của hàm <code>theme()</code> ra console.</span></p>
<p><span style="color: darkgreen;"><strong><em>MẸO:</em></strong> Nếu bạn muốn xóa một phần tử của biểu đồ, bạn cũng có thể làm điều đó bằng hàm <code>theme()</code>. Chỉ cần đặt <code>element_blank()</code> tới đối số để nó biến mất hoàn toàn. Đối với chú thích, thiết lập <code>legend.position = "none".</code></span></p>
</div>
</div>
<div id="màu-sắc" class="section level2" number="30.10">
<h2>
<span class="header-section-number">30.10</span> Màu sắc<a class="anchor" aria-label="anchor" href="#m%C3%A0u-s%E1%BA%AFc"><i class="fas fa-link"></i></a>
</h2>
<p>Xem mục <a href="ggplot-tips.html#ggplot_tips_colors">thang đo cho màu sắc trong chương Các tips với ggplot</a>.</p>
</div>
<div id="piping-tới-ggplot2" class="section level2" number="30.11">
<h2>
<span class="header-section-number">30.11</span> Piping tới <strong>ggplot2</strong><a class="anchor" aria-label="anchor" href="#piping-t%E1%BB%9Bi-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Khi sử dụng pipes để làm sạch và chuyển đổi dữ liệu của bạn, bạn có thể dễ dàng chuyển dữ liệu đã chuyển đổi tới <code>ggplot()</code>.</p>
<p>Các pipes sẽ chuyển dữ liệu từ hàm-tới-hàm và sẽ chuyển tới dấu <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> một khi hàm <code>ggplot()</code> được gọi. Lưu ý rằng trong trường hợp này, không cần chỉ định đối số <code>data =</code>, bởi vì nó đã được tự động xác định khi bạn piping dữ liệu.</p>
<p>Dưới đây là cách mà nó hoạt động:</p>
<div class="sourceCode" id="cb1437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>                                                     <span class="co"># begin with linelist</span>
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># select columns</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>                                                  <span class="co"># pivot longer</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                                  
    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,
    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>                                                        <span class="co"># replace missing values</span>
    symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">ggplot</span><span class="op">(</span>                                                        <span class="co"># begin ggplot!</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">symptom_name</span>, fill <span class="op">=</span> <span class="va">symptom_is_present</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>                    
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Symptom"</span>,
    y <span class="op">=</span> <span class="st">"Symptom status (proportion)"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1054-1.png" width="672"></div>
</div>
<div id="vẽ-biểu-đồ-dữ-liệu-liên-tục" class="section level2" number="30.12">
<h2>
<span class="header-section-number">30.12</span> Vẽ biểu đồ dữ liệu liên tục<a class="anchor" aria-label="anchor" href="#v%E1%BA%BD-bi%E1%BB%83u-%C4%91%E1%BB%93-d%E1%BB%AF-li%E1%BB%87u-li%C3%AAn-t%E1%BB%A5c"><i class="fas fa-link"></i></a>
</h2>
<p>Xuyên xuốt chương này, bạn đã gặp rất nhiều ví dụ về cách vẽ biểu đồ dữ liệu liên tục. Ở đây chúng tôi tổng hợp ngắn gọn chúng và trình bày một vài biến thể.<br>
Các ví dụ bao gồm:</p>
<ul>
<li>
<p>Vẽ biểu đồ cho một biến liên tục:</p>
<ul>
<li>
<strong>Histogram</strong>, một biểu đồ thường dùng để trình bày sự phân bố của một biến số liên tục.</li>
<li>
<strong>Box plot</strong> (còn được gọi là box và whisker), để hiện thị khoảng phân vị 25%, 50%, và 75%, phần cuối của phân phối, và các giá trị ngoại lai (outliers) (<a href="https://www.data-to-viz.com/caveat/boxplot.html">những hạn chế quan trọng</a>).<br>
</li>
<li>
<strong>Jitter plot</strong>, để hiển thị tất cả các giá trị dưới dạng các điểm ‘lộn xộn’ để chúng có thể (hầu hết) được nhìn thấy, ngay cả khi hai điểm có cùng giá trị.<br>
</li>
<li>
<strong>Violin plot</strong>, hiển thị sự phân bố của một biến liên tục dựa trên chiều rộng đối xứng của đàn ‘violin’.</li>
<li>
<strong>Sina plot</strong>, là sự kết hợp của jitter và violin plots, trong đó các điểm riêng lẻ được hiển thị nhưng ở hình dạng đối xứng của sự phân bố (thông qua package <strong>ggforce</strong>).<br>
</li>
</ul>
</li>
<li><p><strong>Biểu đồ phân tán (Scatter plot)</strong> cho hai biến liên tục.<br></p></li>
<li><p><strong>Biểu đồ nhiệt</strong> dành cho ba biến liên tục (xem chương <a href="interactive-plots.html#bi%E1%BB%83u-%C4%91%E1%BB%93-nhi%E1%BB%87t">Biểu đồ nhiệt</a> )</p></li>
</ul>
<div id="histograms" class="section level3 unnumbered">
<h3>Histograms<a class="anchor" aria-label="anchor" href="#histograms"><i class="fas fa-link"></i></a>
</h3>
<p>Histograms có thể trông giống như biểu đồ cột, nhưng sự khác biệt là nó đo lường sự phân phối của một biến <em>liên tục</em>. Không có khoảng cách giữa các “thanh” và chỉ có một biến số được cung cấp cho hàm <code>geom_histogram()</code>.</p>
<p>Dưới đây là code để tạo một <strong>histograms</strong>, mà sẽ nhóm dữ liệu liên tục thành các dải và hiển thị trong các thanh liền kề có độ cao khác nhau. Việc này được thực hiện bằng hàm <code>geom_histogram()</code>. Xem <a href="ggplot-basics.html#ggplot_basics_bars">mục “Biểu đồ cột”</a> trong chương này để hiểu sự khác biệt giữa các hàm <code>geom_histogram()</code>, <code>geom_bar()</code>, và <code>geom_col()</code>.</p>
<p>Chúng ta sẽ hiển thị sự phân bố độ tuổi của các trường hợp. Bên trong đối số <code>mapping = aes()</code>, chỉ định cột bạn muốn xem phân phối. Bạn có thể gán cột này cho trục x hoặc trục y.</p>
<p>Các hàng sẽ được chỉ định tới các “bins” dựa trên số tuổi của chúng, và các bins này sẽ được đồ thị hóa bằng các cột. Nếu bạn chỉ định số lượng bins bnằg đối số <code>bins =</code>, các điểm ngắt được cách đều giữa các giá trị tối thiểu và tối đa của biểu đồ. Nếu <code>bins =</code> không được chỉ định, một số lượng bins thích hợp sẽ được chọn và một thông báo sẽ hiện ra ngay sau biểu đồ:</p>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p>Nếu bạn không muốn chỉ định số lượng bins tới <code>bins =</code>, bạn có thể chỉ định <code>binwidth =</code> theo đơn vị của trục. Chúng tôi đưa ra một vài ví dụ trình bày sự khác biệt giữa bins và bin widths:</p>
<div class="sourceCode" id="cb1439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Regular histogram</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Default histogram (30 bins)"</span><span class="op">)</span>

<span class="co"># B) More bins</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Set to 50 bins"</span><span class="op">)</span>

<span class="co"># C) Fewer bins</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"C) Set to 5 bins"</span><span class="op">)</span>


<span class="co"># D) More bins</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"D) binwidth of 1"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1055-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-4.png" width="50%"></p>
<p>Để vẽ đường mật độ phân bố, bạn có thể sử dụng hàm <code>geom_density()</code>:</p>
<div class="sourceCode" id="cb1440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Frequency with proportion axis, smoothed</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional density"</span><span class="op">)</span>

<span class="co"># Stacked frequency with proportion axis, smoothed</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"'Stacked' proportional densities"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1056-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1056-2.png" width="50%"></p>
<p>Để vẽ một biểu đồ histogram “chồng” (của một biến liên tục trong dữ liệu),bạn có thể làm như sau:</p>
<ol style="list-style-type: decimal">
<li>Dùng hàm <code>geom_histogram()</code> với đối số <code>fill =</code> bên trong <code>aes()</code> và gán tới cột được dùng để nhóm, hoặc<br>
</li>
<li>Dùng hàm <code>geom_freqpoly()</code>, có thể sẽ dễ đọc hơn (bạn vẫn có thể đặt <code>binwidth =</code>)<br>
</li>
<li>Để xem tỷ lệ của tất cả các giá trị, hãy thiết lập <code>y = after_stat(density)</code> (sử dụng chính xác cú pháp này - không thay đổi đối với dữ liệu của bạn). Lưu ý: các tỷ lệ này sẽ hiển thị theo <em>từng nhóm</em>.</li>
</ol>
<p>Các kết quả được trình bày bên dưới (*lưu ý cách sử dụng của <code>color =</code> và. <code>fill =</code>):</p>
<div class="sourceCode" id="cb1441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># "Stacked" histogram</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"'Stacked' histogram"</span><span class="op">)</span>

<span class="co"># Frequency </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_freqpoly</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Freqpoly"</span><span class="op">)</span>

<span class="co"># Frequency with proportion axis</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_freqpoly</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional freqpoly"</span><span class="op">)</span>

<span class="co"># Frequency with proportion axis, smoothed</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional, smoothed with geom_density()"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1057-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-4.png" width="50%"></p>
<p>Nếu bạn muốn nghịch vui một chút, hãy thử hàm <code>geom_density_ridges</code> từ package <strong>ggridges</strong> (<a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html">vignette tại đây</a>.</p>
<p>Đọc thêm về histograms tại tài liệu về <strong>tidyverse</strong> <a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">chương về geom_histogram()</a>.</p>
</div>
<div id="box-plots" class="section level3 unnumbered">
<h3>Box plots<a class="anchor" aria-label="anchor" href="#box-plots"><i class="fas fa-link"></i></a>
</h3>
<p>Box plots rất phổ biến, nhưng có những hạn chế quan trọng. Chúng có thể che khuất phân phối thực tế - vd: phân phối hai mode (bimodal distribution). Xem trang <a href="https://www.r-graph-gallery.com/boxplot.html">R graph gallery</a> và trang <a href="https://www.data-to-viz.com/caveat/boxplot.html">data-to-viz article</a> để biết thêm chi tiết. Tuy nhiên, chúng hiển thị tốt các khoảng tứ phân vị và các giá trị ngoại lai - vì vậy chúng có thể được phủ lên trên các loại biểu đồ khác thể hiện sự phân bố chi tiết hơn.</p>
<p>Dưới đây, chúng ta ôn lại về các thành phần khác nhau của boxplot:</p>
<div class="inline-figure"><img src="images/boxplot.png" width="100%" style="display: block; margin: auto;"></div>
<p>Khi sử dụng <code>geom_boxplot()</code> để tạo biểu đồ box plot, bạn thường chỉ map duy nhất một trục (x hoặc y) bên trong <code>aes()</code>. Trục được chỉ định sẽ xác định xem các ô nằm ngang hay dọc.</p>
<p>Trong hầu hết các geoms, bạn tạo ra một biểu đồ theo từng nhóm bằng cách mapping các thuộc tính thẩm mỹ như <code>color =</code> hoặc <code>fill =</code> tới cột bên trong <code>aes()</code>. Tuy nhiên, biểu đồ box plots làm điều này bằng cách gán cột phân nhóm cho trục chưa được gán (x hoặc y). Dưới đây là code cho một boxplot của <em>tất cả</em> các giá trị tuổi trong bộ dữ liệu, và code còn lại là để hiển thị từng box plot cho từng nhóm giới tính (không-missing) trong dữ liệu. Lưu ý là giá trị missing <code>NA</code> sẽ xuất hiện dưới dạng một box plot riêng rẽ trừ khi nó được loại bỏ. Ở ví dụ này chúng tôi cũng thiết lập <code>fill</code> tới cột <code>outcome</code>, do đó mà mỗi biểu đồ sẽ có màu khác nhau- nhưng điều này không quan trọng.</p>
<div class="sourceCode" id="cb1442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Overall boxplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_boxplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># only y axis mapped (not x)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Overall boxplot"</span><span class="op">)</span>

<span class="co"># B) Box plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>, x <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                     
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># remove legend (redundant)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Boxplot by gender"</span><span class="op">)</span>      </code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1059-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1059-2.png" width="50%"></p>
<p>Code để thêm một box plot vào các cạnh của biểu đồ phân tán (còn gọi là “marginal” plots), vui lòng xem chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>.</p>
</div>
<div id="violin-jitter-và-sina-plots" class="section level3 unnumbered">
<h3>Violin, jitter, và sina plots<a class="anchor" aria-label="anchor" href="#violin-jitter-v%C3%A0-sina-plots"><i class="fas fa-link"></i></a>
</h3>
<p>Dưới đây là code để tạo <strong>violin plots</strong> (<code>geom_violin</code>) và <strong>jitter plots</strong> (<code>geom_jitter</code>) để hiển thị phân bố của biến. Bạn có thể chỉ định các màu sắc được xác định từ dữ liệu bằng cách chèn các tùy chọn này vào bên trong <code>aes()</code>.</p>
<div class="sourceCode" id="cb1443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Jitter plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>,      <span class="co"># remove missing values</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,                     <span class="co"># Continuous variable</span>
           x <span class="op">=</span> <span class="va">outcome</span>,                           <span class="co"># Grouping variable</span>
           color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># Color variable</span>
  <span class="fu">geom_jitter</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                  <span class="co"># Create the violin plot</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) jitter plot by gender"</span><span class="op">)</span>     



<span class="co"># B) Violin plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>,       <span class="co"># remove missing values</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,                      <span class="co"># Continuous variable</span>
           x <span class="op">=</span> <span class="va">outcome</span>,                            <span class="co"># Grouping variable</span>
           fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># fill variable (color)</span>
  <span class="fu">geom_violin</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                   <span class="co"># create the violin plot</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) violin plot by gender"</span><span class="op">)</span>    </code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1060-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1060-2.png" width="50%"></p>
<p>Bạn cũng có thể kết hợp hai biểu đồ này làm một nhờ hàm <code>geom_sina()</code> từ package <strong>ggforce</strong>. Biểu đồ sina vẽ các điểm phân bố trên hình dạng của biểu đồ violin. Khi được phủ lên biểu đồ violin (bằng cách điều chỉnh độ trong suốt), nó giúp việc diễn giải một cách trực quan hơn.</p>
<div class="sourceCode" id="cb1444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Sina plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>, 
  <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,           <span class="co"># numeric variable</span>
      x <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>    <span class="co"># group variable</span>
  <span class="fu">geom_violin</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>, <span class="co"># fill (color of violin background)</span>
    color <span class="op">=</span> <span class="st">"white"</span>,     <span class="co"># white outline</span>
    alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>        <span class="co"># transparency</span>
  <span class="fu">geom_sina</span><span class="op">(</span>
    size<span class="op">=</span><span class="fl">1</span>,                <span class="co"># Change the size of the jitter</span>
    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># color (color of dots)</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>       <span class="co"># Define fill for violin background by death/recover</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span> <span class="op">=</span> <span class="st">"#bf5300"</span>, 
              <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#11118c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_color_manual</span><span class="op">(</span>      <span class="co"># Define colours for points by death/recover</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span> <span class="op">=</span> <span class="st">"#bf5300"</span>, 
              <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#11118c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                                <span class="co"># Remove the gray background</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>                <span class="co"># Remove unnecessary legend</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) violin and sina plot by gender, with extra formatting"</span><span class="op">)</span>      </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1061-1.png" width="672"></div>
</div>
<div id="hai-biến-liên-tục" class="section level3 unnumbered">
<h3>Hai biến liên tục<a class="anchor" aria-label="anchor" href="#hai-bi%E1%BA%BFn-li%C3%AAn-t%E1%BB%A5c"><i class="fas fa-link"></i></a>
</h3>
<p>Theo cú pháp tương tự, <code>geom_point()</code> sẽ cho phép bạn vẽ biểu đồ hai biến liên tục dưới dạng một biểu đồ <strong>phân tán</strong>. Điều này hữu ích để hiển thị các giá trị thực tế hơn là phân phối của chúng. Một biểu đồ phân tán cơ bản của tuổi so với cân nặng được trình bày ở hình (A). Ở hình (B), chúng ta lại sử dụng <code>facet_grid()</code> để hiển thị mối quan hệ giữa hai biến liên tục trong bộ dữ liệu linelist.</p>
<div class="sourceCode" id="cb1445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Basic scatter plot of weight and age</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Scatter plot of weight and age"</span><span class="op">)</span>

<span class="co"># Scatter plot of weight and age by gender and Ebola outcome</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">gender</span>, <span class="va">outcome</span><span class="op">)</span>, <span class="co"># filter retains non-missing gender/outcome</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Scatter plot of weight and age faceted by gender and outcome"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">gender</span> <span class="op">~</span> <span class="va">outcome</span><span class="op">)</span> </code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1062-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1062-2.png" width="50%"></p>
</div>
<div id="ba-biến-liên-tục" class="section level3 unnumbered">
<h3>Ba biến liên tục<a class="anchor" aria-label="anchor" href="#ba-bi%E1%BA%BFn-li%C3%AAn-t%E1%BB%A5c"><i class="fas fa-link"></i></a>
</h3>
<p>Bạn có thể hiển thị ba biến liên tục bằng cách sử dụng đối số <code>fill =</code> để tạo một <em>biểu đồ nhiệt</em>. Màu của mỗi “ô” sẽ phản ánh giá trị của biên liên tục thứ ba trong bộ dữ liệu. Xem chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> để biết thêm chi tiết và một số ví dụ.</p>
<p>Có nhiều cách để tạo biểu đồ 3D trong R, nhưng đối với dịch tễ học ứng dụng, chúng thường khó giải thích và do đó ít hữu ích hơn trong việc ra quyết định.</p>
</div>
</div>
<div id="vẽ-biểu-đồ-cho-biến-danh-mục" class="section level2" number="30.13">
<h2>
<span class="header-section-number">30.13</span> Vẽ biểu đồ cho biến danh mục<a class="anchor" aria-label="anchor" href="#v%E1%BA%BD-bi%E1%BB%83u-%C4%91%E1%BB%93-cho-bi%E1%BA%BFn-danh-m%E1%BB%A5c"><i class="fas fa-link"></i></a>
</h2>
<p>Dữ liệu dạng danh mục có thể là các giá trị ký tự, có thể là logic (TRUE/FALSE), hoặc factors (Xem chương <a href="factors.html#factors">Factors</a>).</p>
<div id="chuẩn-bị-21" class="section level3 unnumbered">
<h3>Chuẩn bị<a class="anchor" aria-label="anchor" href="#chu%E1%BA%A9n-b%E1%BB%8B-21"><i class="fas fa-link"></i></a>
</h3>
<div id="cấu-trúc-dữ-liệu" class="section level4 unnumbered">
<h4>Cấu trúc dữ liệu<a class="anchor" aria-label="anchor" href="#c%E1%BA%A5u-tr%C3%BAc-d%E1%BB%AF-li%E1%BB%87u"><i class="fas fa-link"></i></a>
</h4>
<p>Điều đầu tiên cần hiểu về dữ liệu dạng danh mục đó là kiểm tra xem nó đang tồn tại ở dạng dữ liệu thô như các trường hợp trong bộ dữ liệu linelist, hay dưới dạng dữ liệu tóm tắt hoặc tổng hợp chứa các số lượng hoặc tỷ lệ. Trạng thái dữ liệu của bạn sẽ quyết định hàm vẽ biểu đồ nào được sử dụng:</p>
<ul>
<li>Nếu dữ liệu của bạn là các quan sát thô với một hàng cho mỗi quan sát, bạn có thể sử dụng hàm <code>geom_bar()</code><br>
</li>
<li>Nếu dữ liệu của bạn đã được tổng hợp thành số lượng hoặc tỷ lệ, bạn có thể sử dụng hàm <code>geom_col()</code>
</li>
</ul>
</div>
<div id="kiểu-của-cột-và-thứ-tự-các-giá-trị" class="section level4 unnumbered">
<h4>Kiểu của cột và thứ tự các giá trị<a class="anchor" aria-label="anchor" href="#ki%E1%BB%83u-c%E1%BB%A7a-c%E1%BB%99t-v%C3%A0-th%E1%BB%A9-t%E1%BB%B1-c%C3%A1c-gi%C3%A1-tr%E1%BB%8B"><i class="fas fa-link"></i></a>
</h4>
<p>Sau đó, kiểm tra kiểu dữ liệu của cột mà bạn muốn vẽ. Chúng ta xem xét cột <code>hospital</code>, đầu tiên bằng hàm <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> từ <strong>base</strong> R, sau đó là với hàm <code>tabyl()</code> từ package <strong>janitor</strong>.</p>
<div class="sourceCode" id="cb1446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># View class of hospital column - we can see it is a character</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<div class="sourceCode" id="cb1448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Look at values and proportions within hospital column</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>##                              hospital    n    percent
##                      Central Hospital  454 0.07710598
##                     Military Hospital  896 0.15217391
##                               Missing 1469 0.24949049
##                                 Other  885 0.15030571
##                         Port Hospital 1762 0.29925272
##  St. Mark's Maternity Hospital (SMMH)  422 0.07167120</code></pre>
<p>Chúng ta có thể thấy các giá trị bên trong là các ký tự, vì chúng là tên bệnh viện và theo mặc định, chúng được sắp xếp theo thứ tự bảng chữ cái. Ngoài ra còn có các giá trị ‘other’ và ‘missing’, thứ mà chúng ta muốn nó sẽ là danh mục cuối cùng khi trình bày. Vì thế chúng ta cần chuyển cột này sang dạng factor và sắp xếp lại chúng. Xem chương <a href="factors.html#factors">Factors</a> để biết chi tiết cách thực hiện.</p>
<div class="sourceCode" id="cb1450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert to factor and define level order so "Other" and "Missing" are last</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, 
      <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,
      <span class="st">"Port Hospital"</span>, 
      <span class="st">"Central Hospital"</span>,
      <span class="st">"Military Hospital"</span>,
      <span class="st">"Other"</span>,
      <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "St. Mark's Maternity Hospital (SMMH)" "Port Hospital"                        "Central Hospital"                     "Military Hospital"                   
## [5] "Other"                                "Missing"</code></pre>
</div>
</div>
<div id="ggplot_basics_bars" class="section level3 unnumbered">
<h3>
<code>geom_bar()</code><a class="anchor" aria-label="anchor" href="#ggplot_basics_bars"><i class="fas fa-link"></i></a>
</h3>
<p>Sử dụng <code>geom_bar()</code> nếu bạn muốn chiều cao cột (hoặc chiều cao của các cột trong biểu đồ cột chồng) phản ánh <em>số lượng hàng có liên quan trong dữ liệu</em>. Các thanh này sẽ có khoảng trống giữa chúng, trừ khi <code>width =</code> được điều chỉnh.</p>
<ul>
<li>Chỉ cung cấp phép gán cột trên một trục (thường là trục x). Nếu bạn cung cấp cả trục x và y, bạn sẽ nhận được thông báo <code>Error: stat_count() can only have an x or y aesthetic.</code><br>
</li>
<li>Bạn có thể tạo biểu đồ cột chồng bằng cách thêm <code>fill =</code> cột được chỉ định bên trong <code>mapping = aes()</code><br>
</li>
<li>Trục đối diện sẽ có tiêu đề là “số lượng” theo mặc định, bởi vì nó đại diện cho số hàng</li>
</ul>
<p>Dưới đây, chúng ta đã chỉ định cột outcome tới trục y, nhưng nó cũng có thể dễ dàng thực hiện trên trục x. Nếu bạn có các giá trị ký tự dài hơn, đôi khi sẽ dễ nhìn hơn nếu bạn lật các thanh sang một bên và đặt chú giải ở dưới cùng. Điều này có thể ảnh hưởng đến cách sắp xếp các thứ bậc trong biến factor - trong trường hợp này, chúng tôi đảo ngược chúng với hàm <code>fct_rev()</code> để đặt giá trị missing và other ở dưới cùng.</p>
<div class="sourceCode" id="cb1453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Outcomes in all cases</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Number of cases by hospital"</span>,
       y <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>


<span class="co"># B) Outcomes in all cases by hosptial</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Number of recovered and dead Ebola cases, by hospital"</span>,
       y <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1066-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1066-2.png" width="50%"></p>
</div>
<div id="geom_col" class="section level3 unnumbered">
<h3>
<code>geom_col()</code><a class="anchor" aria-label="anchor" href="#geom_col"><i class="fas fa-link"></i></a>
</h3>
<p>Sử dụng <code>geom_col()</code> nếu bạn muốn chiều cao cột (hoặc chiều cao của các cột trong biểu đồ cột chồng) các <em>giá trị</em> được tính toán trước tồn tại trong dữ liệu. Thông thường, đây là các số lượng hoặc tỷ lệ đã được tóm tắt hoặc “tổng hợp”.</p>
<p>Cung cấp phép gán cột cho <em>cả hai</em> trục tới hàm <code>geom_col()</code>. Thông thường, cột trục x của bạn là biến rời rạc và cột trục y của bạn là biến dạng số.</p>
<p>Giả sử chúng ta có một bộ dữ liệu có tên <code>outcomes</code>:</p>
<pre><code>## # A tibble: 2 x 3
##   outcome     n proportion
##   &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
## 1 Death    1022       56.2
## 2 Recover   796       43.8</code></pre>
<p>Dưới đây là code sử dụng hàm <code>geom_col</code> để tạo biểu đồ cột đơn giản trình bày phân bố các outcome của bệnh nhân Ebola. Với <code>geom_col</code>, cả x và y đều cần được chỉ định. Ở đây x là biến phân loại dọc theo trục x và y là cột chứa tỷ lệ <code>proportion</code>.</p>
<div class="sourceCode" id="cb1455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Outcomes in all cases</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">outcomes</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span>, y <span class="op">=</span> <span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Number of recovered and dead Ebola cases"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1068-1.png" width="432"></div>
<p>Để trình bày kết quả tách theo từng bệnh viện, chúng ta cần bảng phải chứa nhiều thông tin hơn, và ở định dạng “dài”. Chúng ta tạo bảng này với các tần số là sự kết hợp của các danh mục của biến <code>outcome</code> và <code>hospital</code> (xem chương <a href="grouping.html#grouping">Nhóm dữ liệu</a> để biết thêm các mẹo).</p>
<div class="sourceCode" id="cb1456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcomes2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># get counts by hospital and outcome</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># Group so proportions are out of hospital total</span>
  <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="co"># calculate proportions of hospital total</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">outcomes2</span><span class="op">)</span> <span class="co"># Preview data</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   hospital [3]
##   hospital                             outcome     n proportion
##   &lt;fct&gt;                                &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
## 1 St. Mark's Maternity Hospital (SMMH) Death     199       61.2
## 2 St. Mark's Maternity Hospital (SMMH) Recover   126       38.8
## 3 Port Hospital                        Death     785       57.6
## 4 Port Hospital                        Recover   579       42.4
## 5 Central Hospital                     Death     193       53.9
## 6 Central Hospital                     Recover   165       46.1</code></pre>
<p>Sau đó, chúng ta vẽ biểu đồ ggplot với một số định dạng được bổ sung:</p>
<ul>
<li>
<strong>Lật trục</strong>: Hoán đổi vị trị trục với <code>coord_flip()</code> để chúng ta có thể đọc tên các bệnh viện.</li>
<li>
<strong>Columns side-by-side</strong>: Added a <code>position = "dodge"</code> argument so that the bars for death and recover are presented side by side rather than stacked. Lưu ý mặc định là các cột xếp chồng lên nhau.</li>
<li>
<strong>Độ rộng cột</strong>: Chỉ định ‘chiều rộng’, do đó các cột mỏng bằng một nửa chiều rộng đầy đủ có thể.</li>
<li>
<strong>Thứ tự cột</strong>: Đảo lại các danh mục trên trục y để ‘Other’ và ‘Missing’ ở dưới cùng, với hàm <code>scale_x_discrete(limits=rev)</code>. Lưu ý rằng chúng ta sử dụng cách này thay vì <code>scale_y_discrete</code> bởi vì hospital được nhắc tới trong đối số <code>x</code> của <code>aes()</code>, ngay cả khi một cách trực quan nó nằm trên trục y. Chúng ta làm vậy bởi vì ggplot dường như trình bày các danh mục từ sau lên trước trừ khi chúng ta yêu cầu nó không làm vậy.<br>
</li>
<li>
<strong>Các chi tiết khác</strong>: Nhãn/tiêu đề và màu sắc được thêm tương ứng vào bên trong lệnh <code>labs</code> và <code>scale_fill_color</code>.</li>
</ul>
<div class="sourceCode" id="cb1458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Outcomes in all cases by hospital</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">outcomes2</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_col</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">proportion</span>,                 <span class="co"># show pre-calculated proportion values</span>
      y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>,          <span class="co"># reverse level order so missing/other at bottom</span>
      fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>,                <span class="co"># stacked by outcome</span>
    width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>                    <span class="co"># thinner bars (out of 1)</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># Minimal theme </span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Number of recovered and dead Ebola cases, by hospital"</span>,
       fill <span class="op">=</span> <span class="st">"Outcome"</span>,             <span class="co"># legend title</span>
       y <span class="op">=</span> <span class="st">"Count"</span>,                  <span class="co"># y axis title</span>
       x <span class="op">=</span> <span class="st">"Hospital of admission"</span><span class="op">)</span><span class="op">+</span> <span class="co"># x axis title</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>                 <span class="co"># adding colors manually</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span><span class="op">=</span> <span class="st">"#3B1c8C"</span>,
               <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#21908D"</span> <span class="op">)</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1070-1.png" width="768"></div>
<p>Lưu ý rằng tỷ lệ là nhị phân, do đó chúng ta có thể loại bỏ các giá trị ‘recover’ và chỉ hiện thị tỷ lệ những người tử vong. Việc này chỉ nhằm cho mục đích minh họa.</p>
<p>Nếu sử dụng <code>geom_col()</code> cho dữ liệu ngày tháng (vd: đường cong dịch bệnh từ dữ liệu tổng hợp) - bạn sẽ muốn điều chỉnh đối số <code>width =</code> để loại bỏ “khoảng trống” giữa các cột. nếu sử dụng số liệu cập nhật hàng ngày, hãy thiết lập <code>width = 1</code>. Nếu là hàng tuần, <code>width = 7</code>. Không thể thiết lập cho tháng vì mỗi tháng có số ngày khác nhau.</p>
</div>
<div id="geom_histogram" class="section level3 unnumbered">
<h3>
<code>geom_histogram()</code><a class="anchor" aria-label="anchor" href="#geom_histogram"><i class="fas fa-link"></i></a>
</h3>
<p>Histograms có thể trông giống biểu đồ cột, nhưng khác biệt vì nó đo lường sự phân bố của một biến <em>liên tục</em>. Không có khoảng cách giữa các “cột”, và chỉ có một cột được cung cấp cho hàm <code>geom_histogram()</code>. Có các đối số cụ thể cho biểu đồ chẳng hạn như <code>bin_width =</code> và <code>breaks =</code> ể chỉ định cách dữ liệu nên được xếp. Phần bên trên về dữ liệu liên tục và chương <a href="epicurves.html#epicurves">Đường cong dịch bệnh</a> sẽ cung cấp thêm các hi tiết.</p>
</div>
</div>
<div id="tài-nguyên-học-liệu-12" class="section level2" number="30.14">
<h2>
<span class="header-section-number">30.14</span> Tài nguyên học liệu<a class="anchor" aria-label="anchor" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-12"><i class="fas fa-link"></i></a>
</h2>
<p>Có rất nhiều trợ giúp trực tuyến, đặc biệt là với ggplot. Xem:</p>
<ul>
<li><a href="http://r-statistics.co/ggplot2-cheatsheet.html">ggplot2 cheat sheet</a></li>
<li><a href="https://biostats.w.uib.no/the-ggplot2-cheat-sheet-by-rstudio/">another cheat sheet</a></li>
<li>
<a href="https://ggplot2.tidyverse.org/reference/">tidyverse ggplot basics page</a><br>
</li>
<li>
<a href="http://www.sthda.com/english/articles/32-r-graphics-essentials/131-plot-two-continuous-variables-scatter-graph-and-alternatives/">plotting continuous variables</a><br>
</li>
<li>R for Data Science trang về <a href="https://r4ds.had.co.nz/data-visualisation.html">data visualization</a>
</li>
<li><a href="https://r4ds.had.co.nz/graphics-for-communication.html">graphics for communicaton</a></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tables-presentation.html"><span class="header-section-number">29</span> Trình bày bảng</a></div>
<div class="next"><a href="ggplot-tips.html"><span class="header-section-number">31</span> Các tips với ggplot</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot-basics"><span class="header-section-number">30</span> ggplot cơ bản</a></li>
<li>
<a class="nav-link" href="#chu%E1%BA%A9n-b%E1%BB%8B-20"><span class="header-section-number">30.1</span> Chuẩn bị</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#g%E1%BB%8Di-packages-9">Gọi packages</a></li>
<li><a class="nav-link" href="#nh%E1%BA%ADp-d%E1%BB%AF-li%E1%BB%87u-15">Nhập dữ liệu</a></li>
<li><a class="nav-link" href="#l%C3%A0m-s%E1%BA%A1ch-chung">Làm sạch chung</a></li>
<li><a class="nav-link" href="#xoay-tr%E1%BB%A5c-d%C3%A0i-h%C6%A1n">Xoay trục dài hơn</a></li>
</ul>
</li>
<li><a class="nav-link" href="#c%C3%A1c-kh%C3%A1i-ni%E1%BB%87m-c%C6%A1-b%E1%BA%A3n-c%E1%BB%A7a-ggplot"><span class="header-section-number">30.2</span> Các khái niệm cơ bản của ggplot</a></li>
<li><a class="nav-link" href="#ggplot"><span class="header-section-number">30.3</span> ggplot()</a></li>
<li><a class="nav-link" href="#geoms"><span class="header-section-number">30.4</span> Geoms</a></li>
<li>
<a class="nav-link" href="#ggplot_basics_mapping"><span class="header-section-number">30.5</span> Chọn dữ liệu cho biểu đồ</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#th%E1%BA%A9m-m%E1%BB%B9-%C4%91%E1%BB%93-th%E1%BB%8B">Thẩm mỹ đồ thị</a></li>
<li><a class="nav-link" href="#g%C3%A1n-m%E1%BB%99t-gi%C3%A1-tr%E1%BB%8B-t%C4%A9nh">Gán một giá trị tĩnh</a></li>
<li><a class="nav-link" href="#v%E1%BA%BD-theo-t%E1%BB%B7-l%E1%BB%87-gi%C3%A1-tr%E1%BB%8B-c%E1%BB%A7a-c%E1%BB%99t">Vẽ theo tỷ lệ giá trị của cột</a></li>
<li><a class="nav-link" href="#ggplot_basics_map_loc">Thực hiện phép gán ở đâu</a></li>
<li><a class="nav-link" href="#ggplotgroups">Nhóm</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ggplot_basics_facet"><span class="header-section-number">30.6</span> Facets / Chia nhỏ biểu đồ</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#facet_wrap">facet_wrap()</a></li>
<li><a class="nav-link" href="#facet_grid">facet_grid()</a></li>
<li><a class="nav-link" href="#gi%E1%BB%9Bi-h%E1%BA%A1n-tr%E1%BB%A5c-t%E1%BB%B1-do-ho%E1%BA%B7c-c%E1%BB%91-%C4%91%E1%BB%8Bnh">Giới hạn trục tự do hoặc cố định</a></li>
<li><a class="nav-link" href="#tr%E1%BA%ADt-t%E1%BB%B1-th%E1%BB%A9c-b%E1%BA%ADc-c%E1%BB%A7a-factor-trong-facets">Trật tự thức bậc của Factor trong facets</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#l%C6%B0u-tr%E1%BB%AF-bi%E1%BB%83u-%C4%91%E1%BB%93"><span class="header-section-number">30.7</span> Lưu trữ biểu đồ</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#l%C6%B0u-bi%E1%BB%83u-%C4%91%E1%BB%93-1">Lưu biểu đồ</a></li>
<li><a class="nav-link" href="#ch%E1%BB%89nh-s%E1%BB%ADa-bi%E1%BB%81u-%C4%91%E1%BB%93-%C4%91%C3%A3-l%C6%B0u">Chỉnh sửa biều đồ đã lưu</a></li>
<li><a class="nav-link" href="#xu%E1%BA%A5t-bi%E1%BB%83u-%C4%91%E1%BB%93">Xuất biểu đồ</a></li>
</ul>
</li>
<li><a class="nav-link" href="#nh%C3%A3n"><span class="header-section-number">30.8</span> Nhãn</a></li>
<li>
<a class="nav-link" href="#ggplot_basics_themes"><span class="header-section-number">30.9</span> Chủ đề</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ch%E1%BB%A7-%C4%91%E1%BB%81-ho%C3%A0n-ch%E1%BB%89nh">Chủ đề hoàn chỉnh</a></li>
<li><a class="nav-link" href="#t%C3%B9y-ch%E1%BB%89nh-ch%E1%BB%A7-%C4%91%E1%BB%81">Tùy chỉnh chủ đề</a></li>
</ul>
</li>
<li><a class="nav-link" href="#m%C3%A0u-s%E1%BA%AFc"><span class="header-section-number">30.10</span> Màu sắc</a></li>
<li><a class="nav-link" href="#piping-t%E1%BB%9Bi-ggplot2"><span class="header-section-number">30.11</span> Piping tới ggplot2</a></li>
<li>
<a class="nav-link" href="#v%E1%BA%BD-bi%E1%BB%83u-%C4%91%E1%BB%93-d%E1%BB%AF-li%E1%BB%87u-li%C3%AAn-t%E1%BB%A5c"><span class="header-section-number">30.12</span> Vẽ biểu đồ dữ liệu liên tục</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#histograms">Histograms</a></li>
<li><a class="nav-link" href="#box-plots">Box plots</a></li>
<li><a class="nav-link" href="#violin-jitter-v%C3%A0-sina-plots">Violin, jitter, và sina plots</a></li>
<li><a class="nav-link" href="#hai-bi%E1%BA%BFn-li%C3%AAn-t%E1%BB%A5c">Hai biến liên tục</a></li>
<li><a class="nav-link" href="#ba-bi%E1%BA%BFn-li%C3%AAn-t%E1%BB%A5c">Ba biến liên tục</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#v%E1%BA%BD-bi%E1%BB%83u-%C4%91%E1%BB%93-cho-bi%E1%BA%BFn-danh-m%E1%BB%A5c"><span class="header-section-number">30.13</span> Vẽ biểu đồ cho biến danh mục</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#chu%E1%BA%A9n-b%E1%BB%8B-21">Chuẩn bị</a></li>
<li><a class="nav-link" href="#ggplot_basics_bars">geom_bar()</a></li>
<li><a class="nav-link" href="#geom_col">geom_col()</a></li>
<li><a class="nav-link" href="#geom_histogram">geom_histogram()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#t%C3%A0i-nguy%C3%AAn-h%E1%BB%8Dc-li%E1%BB%87u-12"><span class="header-section-number">30.14</span> Tài nguyên học liệu</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2021-09-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
